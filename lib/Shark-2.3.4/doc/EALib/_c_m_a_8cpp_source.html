<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>EALib: CMA.cpp Source File</title>
<script type="text/javaScript" src="search/search.js"></script>
<link href="../css/main.css" rel="stylesheet" type="text/css"/>
</head>
<body id="type-b">

<div id="wrap">
<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
<div id="poweredby">
<img style="width: 95%;" src="../images/SharkLogo.png"/>
</div>		
  
<ul id="nav">
  <li class="first"><a href="../index.html">About Shark</a></li>
  <li><a href="#">Sourceforge</a>
  
  <ul>
    <li class="first"><a href="http://shark-project.sourceforge.net">Project Summary</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/files/">Downloads</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/develop">Subversion Repository</a></li>
  </ul>
  
</li>
<li class="first"><a href="../GettingStarted.html">Getting Started</a>
<li class="first"><a href="../Tutorials.html">Tutorials</a>
<li class="first"><a href="../FAQ.html">FAQ</a>

<li class="first"><a href="#">Main Modules</a>
<ul>
  <li class="first"><a href="../ReClaM/index.html">ReClaM</a>
  <li class="first"><a href="../EALib/index.html">EALib</a>
  <li class="first"><a href="../MOO-EALib/index.html">MOO-EALib</a>
  <li class="first"><a href="../Fuzzy/index.html">Fuzzy</a>
</ul>
</li>
<li class="first"><a href="#">Tools</a>
<ul>
  <li class="first"><a href="../Mixture/index.html">Mixture</a>
  <li><a href="../Array/index.html">Array</a>
  <li><a href="../Rng/index.html">Rng</a>
  <li><a href="../LinAlg/index.html">LinAlg</a>
  <li class="last"><a href="../FileUtil/index.html">FileUtil</a>		    
</ul>
</li>
</ul>
</div>

<!--<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
  <ul id="nav">
    <li><a href="../index.html"><span>Shark&nbsp;Main&nbsp;Page</span></a></li>
    <li><a href="../Array/index.html"><span>Array</span></a></li>
    <li><a href="../Rng/index.html"><span>Rng</span></a></li>
    <li><a href="../LinAlg/index.html"><span>LinAlg</span></a></li>
    <li><a href="../FileUtil/index.html"><span>FileUtil</span></a></li>
    <li><a href="../EALib/index.html"><span>EALib</span></a></li>
    <li><a href="../MOO-EALib/index.html"><span>MOO-EALib</span></a></li>
    <li class="active"><a href="../ReClaM/index.html"><span>ReClaM</span></a></li>
    <li><a href="../Fuzzy/index.html"><span>Fuzzy</span></a></li>
    <li><a href="../Mixture/index.html"><span>Mixture</span></a></li>
    <li><a href="../tutorials/index.html"><span>Tutorials</span></a></li>
    <li><a href="../faq/index.html"><span>FAQ</span></a></li>
  </ul>
 </div> -->
<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>CMA.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_c_m_a_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//===========================================================================</span>
<a name="l00048"></a>00048 <span class="comment"></span><span class="comment">//===========================================================================</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;EALib/CMA.h&gt;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// static</span>
<a name="l00056"></a><a class="code" href="class_c_m_a.html#a2d8b1dce1e74891713cee53e3fc8b45a">00056</a> <span class="keywordtype">unsigned</span> <a class="code" href="class_c_m_a.html#a2d8b1dce1e74891713cee53e3fc8b45a">CMA::suggestLambda</a>(<span class="keywordtype">unsigned</span> dimension) {
<a name="l00057"></a>00057     <span class="keywordtype">unsigned</span> <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a> = unsigned(4. + floor(3. * log((<span class="keywordtype">double</span>) dimension)));
<a name="l00058"></a>00058     <span class="comment">// heuristics for small search spaces</span>
<a name="l00059"></a>00059     <span class="keywordflow">if</span> (lambda &gt; dimension) lambda = dimension; <span class="comment">// CI&#39;s golden rule :-)</span>
<a name="l00060"></a>00060     <span class="keywordflow">if</span> (lambda &lt; 5) lambda = 5; <span class="comment">// Hansen &amp; Ostermeier&#39;s lower bound</span>
<a name="l00061"></a>00061     <span class="keywordflow">return</span> <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>;
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">// static</span>
<a name="l00065"></a><a class="code" href="class_c_m_a.html#af50a5a2b0ccbc61e450101753ccb0939">00065</a> <span class="keywordtype">unsigned</span> <a class="code" href="class_c_m_a.html#af50a5a2b0ccbc61e450101753ccb0939">CMA::suggestMu</a>(<span class="keywordtype">unsigned</span> lambda, <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">RecombType</a> recomb) {
<a name="l00066"></a>00066     <span class="keywordflow">if</span> (recomb == <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98a3cd2e498400eae44265f0750a680183d">equal</a>) <span class="keywordflow">return</span>  unsigned(floor(lambda / 4.));
<a name="l00067"></a>00067     <span class="keywordflow">return</span>  unsigned(floor(lambda / 2.));
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">00070</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">CMA::init</a>(<span class="keywordtype">unsigned</span> dimension,
<a name="l00071"></a>00071                              std::vector&lt;double &gt; var, <span class="keywordtype">double</span> _sigma,
<a name="l00072"></a>00072                              <a class="code" href="class_population.html" title="Base class for populations of individuals in an evolutionary algorithm.">Population</a> &amp;p,
<a name="l00073"></a>00073                              <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">RecombType</a> recomb,
<a name="l00074"></a>00074                              <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">UpdateType</a> cupdate) {
<a name="l00075"></a>00075     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keywordtype">unsigned</span> mu = p.<a class="code" href="class_population.html#afd59ccfaf65813549e6ea756ef0fb54b">size</a>();
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>     = dimension;
<a name="l00080"></a>00080     <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a> = _sigma;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>.resize(mu);
<a name="l00083"></a>00083     <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>.<a class="code" href="class_chromosome_t__base.html#af222e374790b377bce4ce137b9c8b679">resize</a>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00084"></a>00084     <a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>.<a class="code" href="class_chromosome_t__base.html#af222e374790b377bce4ce137b9c8b679">resize</a>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00085"></a>00085     <a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00086"></a>00086     <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00087"></a>00087     <a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00088"></a>00088     <a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>, <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00089"></a>00089     <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>, <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00090"></a>00090     <a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>, <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00091"></a>00091     <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00092"></a>00092     <a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a>.resize(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00093"></a>00093     <a class="code" href="class_c_m_a.html#afef181a0482be3e11d0160a7e493a7fb">meanz</a>.<a class="code" href="class_chromosome_t__base.html#af222e374790b377bce4ce137b9c8b679">resize</a>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="keywordflow">switch</span> (recomb) {
<a name="l00096"></a>00096     <span class="keywordflow">case</span> <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98a3cd2e498400eae44265f0750a680183d">equal</a>:
<a name="l00097"></a>00097         <span class="keywordflow">for</span> (i = 0; i &lt; mu; i++) <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i) = 1;
<a name="l00098"></a>00098         <span class="keywordflow">break</span>;
<a name="l00099"></a>00099     <span class="keywordflow">case</span> <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98af7f61fe6ab041bceb8562c3612df7050">linear</a>:
<a name="l00100"></a>00100         <span class="keywordflow">for</span> (i = 0; i &lt; mu; i++) <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i) = mu - i;
<a name="l00101"></a>00101         <span class="keywordflow">break</span>;
<a name="l00102"></a>00102     <span class="keywordflow">case</span> <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98aa3acd891bb849a8da227635545623a04">superlinear</a>:
<a name="l00103"></a>00103         <span class="keywordflow">for</span> (i = 0; i &lt; mu; i++) <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i) = log(mu + 1.) - log(1. + i);
<a name="l00104"></a>00104         <span class="keywordflow">break</span>;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="keywordtype">double</span> wSum    = 0;
<a name="l00108"></a>00108     <span class="keywordtype">double</span> wSumSqr = 0;
<a name="l00109"></a>00109     <span class="keywordflow">for</span> (i = 0; i &lt; mu; i++) {
<a name="l00110"></a>00110         wSum += <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i);
<a name="l00111"></a>00111         wSumSqr += Shark::sqr(<a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i));
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a> /= wSum; <span class="comment">// normalizing weights</span>
<a name="l00114"></a>00114     wSumSqr /= Shark::sqr(wSum);
<a name="l00115"></a>00115     <a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>   = 1 / wSumSqr;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">// step size control</span>
<a name="l00118"></a>00118     <a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>      = (<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a> + 2.)/(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a> + <a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a> + 3.);
<a name="l00119"></a>00119     <a class="code" href="class_c_m_a.html#a43976b2c44e7a5fda662f7e5ff4b9c0c">d</a>       = 1. + 2. * Shark::max(0., sqrt( (<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>-1.)/(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>+1) ) - 1.) + <a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="comment">// covariance matrix adaptation</span>
<a name="l00122"></a>00122     <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a>   = <a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>;
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (cupdate == <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86a07d1c8e6ea008687e14f0e047a309995">rankone</a>) <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a> = 1.;
<a name="l00124"></a>00124     <a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>      = 4. / (4. + <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>);
<a name="l00125"></a>00125     <a class="code" href="class_c_m_a.html#a1320bc0b4c245494cb764789440ad31a">ccov</a>    = 1. / <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a> * 2. / Shark::sqr(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a> + sqrt(2.))
<a name="l00126"></a>00126         + (1 - 1. / <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a>) * Shark::min(1., (2 * <a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a> - 1) / (Shark::sqr(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a> + 2) + <a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>));
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <a class="code" href="class_c_m_a.html#af9051c4560e9d39c44e4bd7698e37805">ccu</a>     = sqrt((2. - <a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>) * <a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>);
<a name="l00129"></a>00129     <a class="code" href="class_c_m_a.html#a4e79b9b4c075e9673de9d9310af76779">csu</a>     = sqrt((2. - <a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>) * <a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>);
<a name="l00130"></a>00130     <a class="code" href="class_c_m_a.html#acc2ce8ddd0b4fdf736bd03846f2d96e4">chi_n</a>   = sqrt(<span class="keywordtype">double</span>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>)) * (1 - 1. / (4. * <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>) +  1. / (21. * Shark::sqr(<span class="keywordtype">double</span>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>))));
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// init COG</span>
<a name="l00133"></a>00133     <a class="code" href="class_c_m_a.html#a8fae7dfedc46abe5ca88ea44939a76c4" title="calculate weighted mean for intermediate recombination">cog</a>(<a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>, p);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="comment">// init paths</span>
<a name="l00136"></a>00136     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++) {
<a name="l00137"></a>00137         <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>(i) = <a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>(i) = 0.;
<a name="l00138"></a>00138         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++) {
<a name="l00139"></a>00139             <span class="keywordflow">if</span> (i != j) <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>(i, j) = 0;
<a name="l00140"></a>00140             <span class="keywordflow">else</span> <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>(i, j) = var[i];
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// eigenvalues lambda and eigenvector matrix B</span>
<a name="l00145"></a>00145     eigensymm(<a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>, <a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>, <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>);
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="class_c_m_a.html#ac9445002162514866b1ce193b5be8520">00148</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">CMA::init</a>(<span class="keywordtype">unsigned</span> dimension, <span class="keywordtype">double</span> _sigma,  <a class="code" href="class_population.html" title="Base class for populations of individuals in an evolutionary algorithm.">Population</a> &amp;p,
<a name="l00149"></a>00149                              <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">RecombType</a> recomb, <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">UpdateType</a> cupdate) {
<a name="l00150"></a>00150     std::vector&lt;double&gt; var(dimension);
<a name="l00151"></a>00151     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00152"></a>00152     <span class="keywordflow">for</span> (i = 0; i &lt; dimension; i++) var[i] = 1;
<a name="l00153"></a>00153     <a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">init</a>(dimension, var, _sigma, p, recomb, cupdate);
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">//</span>
<a name="l00158"></a>00158 <span class="comment"></span><span class="comment">//</span>
<a name="l00159"></a><a class="code" href="class_c_m_a.html#a8fae7dfedc46abe5ca88ea44939a76c4">00159</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#a8fae7dfedc46abe5ca88ea44939a76c4" title="calculate weighted mean for intermediate recombination">CMA::cog</a>(<a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double &gt;</a>&amp; a, <a class="code" href="class_population.html" title="Base class for populations of individuals in an evolutionary algorithm.">Population</a> &amp;p, <span class="keywordtype">unsigned</span> c)<span class="keyword"> const </span>{
<a name="l00160"></a>00160     SIZE_CHECK(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a> == <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double &gt;</a>&amp; <span class="keyword">&gt;</span>(p[0][c]).size());
<a name="l00161"></a>00161     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
<a name="l00162"></a>00162     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++) {
<a name="l00163"></a>00163         a[j] = <span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(p[0][c])[j] * <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(0);
<a name="l00164"></a>00164         <span class="keywordflow">for</span> (i = 1; i &lt; p.<a class="code" href="class_population.html#afd59ccfaf65813549e6ea756ef0fb54b">size</a>(); i++) {
<a name="l00165"></a>00165             a[j] += <span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(p[i][c])[j] * <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(i);
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00171"></a>00171 <span class="comment">//</span>
<a name="l00172"></a><a class="code" href="class_c_m_a.html#ad8122c6cbde46aa4e8e20573c546c829">00172</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#ad8122c6cbde46aa4e8e20573c546c829" title="mutation after global intermediate recombination">CMA::create</a>(<a class="code" href="class_individual.html" title="Base class for individuals in a population.">Individual</a> &amp;o)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++) {
<a name="l00177"></a>00177         <span class="comment">// draw random vector</span>
<a name="l00178"></a>00178         <a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>(i) = Rng::gauss(0, 1);
<a name="l00179"></a>00179         <span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(o[1])[i] = <a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>(i);
<a name="l00180"></a>00180         <span class="comment">// global intermediate recombination, Eq. (1)</span>
<a name="l00181"></a>00181         <span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(o[0])[i] = <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>[i];
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="comment">// mutate objective variables, Eq. (1)</span>
<a name="l00185"></a>00185     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++)
<a name="l00186"></a>00186         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++)
<a name="l00187"></a>00187             <span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(o[0])[i] += <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a> * <a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>(i, j) * sqrt(fabs(<a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>(j))) * <a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>(j);
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">//</span>
<a name="l00192"></a>00192 <span class="comment"></span><span class="comment">//</span>
<a name="l00193"></a><a class="code" href="class_c_m_a.html#a1ff2d788fe7d6f19b406135141dfc012">00193</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#a1ff2d788fe7d6f19b406135141dfc012" title="do the update of the covariance matrix and the global step size">CMA::updateStrategyParameters</a>(<a class="code" href="class_population.html" title="Base class for populations of individuals in an evolutionary algorithm.">Population</a> &amp;p, <span class="keywordtype">double</span> lowerBound) {
<a name="l00194"></a>00194     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, k;
<a name="l00195"></a>00195     <span class="keywordtype">double</span> normPS = 0.;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// COG of new parents</span>
<a name="l00198"></a>00198     <a class="code" href="class_c_m_a.html#a8fae7dfedc46abe5ca88ea44939a76c4" title="calculate weighted mean for intermediate recombination">cog</a>(<a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>, p);
<a name="l00199"></a>00199     <a class="code" href="class_c_m_a.html#a8fae7dfedc46abe5ca88ea44939a76c4" title="calculate weighted mean for intermediate recombination">cog</a>(<a class="code" href="class_c_m_a.html#afef181a0482be3e11d0160a7e493a7fb">meanz</a> , p, 1);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a> = 0;
<a name="l00202"></a>00202     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++)
<a name="l00203"></a>00203         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++)
<a name="l00204"></a>00204             <a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a>(i) += <a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>(i, j) * <a class="code" href="class_c_m_a.html#afef181a0482be3e11d0160a7e493a7fb">meanz</a>[j];
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="comment">// Eq. (2) &amp; Eq. (4)</span>
<a name="l00207"></a>00207     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++) {
<a name="l00208"></a>00208         <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>(i) = (1 - <a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>) * <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>(i) + <a class="code" href="class_c_m_a.html#af9051c4560e9d39c44e4bd7698e37805">ccu</a> * sqrt(<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>) / <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a> * (<a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>[i] - <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>[i]);
<a name="l00209"></a>00209         <a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>(i) = (1 - <a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>) * <a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>(i) + <a class="code" href="class_c_m_a.html#a4e79b9b4c075e9673de9d9310af76779">csu</a> * sqrt(<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>) * <a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a>(i);
<a name="l00210"></a>00210         normPS += Shark::sqr(<a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>(i));
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     normPS  = sqrt(normPS);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="comment">// Eq. (3)</span>
<a name="l00215"></a>00215     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++)
<a name="l00216"></a>00216         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++)
<a name="l00217"></a>00217             <span class="keywordflow">for</span> (<a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>(i, j) = 0., k = 0; k &lt; p.<a class="code" href="class_population.html#afd59ccfaf65813549e6ea756ef0fb54b">size</a>(); k++)
<a name="l00218"></a>00218                 <a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>(i, j) += <a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>(k) * (<span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(p[k][0])[i] - <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>[i]) *
<a name="l00219"></a>00219                     (<span class="keyword">dynamic_cast&lt;</span> <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt; double &gt;</a>&amp; <span class="keyword">&gt;</span>(p[k][0])[j] - <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>[j]);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; i++)
<a name="l00222"></a>00222         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>; j++)
<a name="l00223"></a>00223             <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>(i, j) = (1 - <a class="code" href="class_c_m_a.html#a1320bc0b4c245494cb764789440ad31a">ccov</a>) * <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>(i, j) + <a class="code" href="class_c_m_a.html#a1320bc0b4c245494cb764789440ad31a">ccov</a> *
<a name="l00224"></a>00224                 (1. / <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a> * <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>(i) * <a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>(j) + (1. - 1. / <a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a>) * 1. / Shark::sqr(<a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a>) * <a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>(i, j));
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">// Eq. (5)</span>
<a name="l00227"></a>00227     <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a> *= exp((<a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a> / <a class="code" href="class_c_m_a.html#a43976b2c44e7a5fda662f7e5ff4b9c0c">d</a>) * (normPS / <a class="code" href="class_c_m_a.html#acc2ce8ddd0b4fdf736bd03846f2d96e4">chi_n</a> - 1));
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="comment">// eigenvalues lambda and eigenvector matrix B</span>
<a name="l00230"></a>00230     eigensymm(<a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>, <a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>, <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="comment">// lower bound</span>
<a name="l00233"></a>00233     <span class="keywordflow">if</span> ((sigma * sqrt(fabs(<a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>(n - 1)))) &lt; lowerBound)
<a name="l00234"></a>00234         sigma = lowerBound / sqrt(fabs(<a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>(n - 1)));
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">// new COG becomes old COG</span>
<a name="l00237"></a>00237     <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a> = <a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>;
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment">//</span>
<a name="l00242"></a>00242 <span class="comment"></span><span class="comment">//</span>
<a name="l00243"></a><a class="code" href="class_c_m_a.html#a037763461ab180a4ab797bd349130663">00243</a> <span class="keywordtype">double</span> <a class="code" href="class_c_m_a.html#a037763461ab180a4ab797bd349130663" title="get global setp size ">CMA::getSigma</a>()<span class="keyword"> const </span>{
<a name="l00244"></a>00244     <span class="keywordflow">return</span> <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a>;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">//</span>
<a name="l00249"></a>00249 <span class="comment"></span><span class="comment">//</span>
<a name="l00250"></a><a class="code" href="class_c_m_a.html#a1eee2d7f5615b74b23b20d1365b91d0c">00250</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#a1eee2d7f5615b74b23b20d1365b91d0c" title="set global setp size ">CMA::setSigma</a>(<span class="keywordtype">double</span> x) {
<a name="l00251"></a>00251     <a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a> = <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="comment">//</span>
<a name="l00256"></a>00256 <span class="comment"></span><span class="comment">//</span>
<a name="l00257"></a><a class="code" href="class_c_m_a.html#a0a5e0cae3e81a83fa10a5ffb4b883811">00257</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a.html#a0a5e0cae3e81a83fa10a5ffb4b883811" title="set different approximation for expectation of  distribution">CMA::setChi_n</a>(<span class="keywordtype">double</span> x) {
<a name="l00258"></a>00258     <a class="code" href="class_c_m_a.html#acc2ce8ddd0b4fdf736bd03846f2d96e4">chi_n</a> = <a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">//</span>
<a name="l00263"></a>00263 <span class="comment"></span><span class="comment">//</span>
<a name="l00264"></a><a class="code" href="class_c_m_a.html#abfaee3e8972ed6a6b7dc350119c827f7">00264</a> <span class="keywordtype">double</span> <a class="code" href="class_c_m_a.html#abfaee3e8972ed6a6b7dc350119c827f7" title="get condition number of covariance matrix">CMA::getCondition</a>()<span class="keyword"> const </span>{
<a name="l00265"></a>00265     <span class="keywordflow">return</span> <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>(0) / <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>(<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a> - 1);
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="comment">//</span>
<a name="l00270"></a>00270 <span class="comment"></span><span class="comment">//</span>
<a name="l00271"></a><a class="code" href="class_c_m_a.html#aa24df030c0b8cf5d3ea1f75d91cf928b">00271</a> <span class="keyword">const</span> Array&lt;double&gt; &amp;<a class="code" href="class_c_m_a.html#aa24df030c0b8cf5d3ea1f75d91cf928b" title="get covariance matrix">CMA::getC</a>()<span class="keyword"> const </span>{
<a name="l00272"></a>00272     <span class="keywordflow">return</span> <a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">//</span>
<a name="l00277"></a>00277 <span class="comment"></span><span class="comment">//</span>
<a name="l00278"></a><a class="code" href="class_c_m_a.html#add90ba631a5049faac9e4a0a9e758904">00278</a> <span class="keyword">const</span>  Array&lt;double&gt; &amp;<a class="code" href="class_c_m_a.html#add90ba631a5049faac9e4a0a9e758904" title="get eigenvalues of covariance matrix">CMA::getLambda</a>()<span class="keyword"> const </span>{
<a name="l00279"></a>00279     <span class="keywordflow">return</span> <a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>;
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="_c_m_a_8h.html#ac019ecf5ec772bd53effff0553633b9d">00282</a> std::ostream &amp; <a class="code" href="_c_m_a_8cpp.html#ac019ecf5ec772bd53effff0553633b9d">operator&lt;&lt;</a>( std::ostream &amp; stream, <span class="keyword">const</span> <a class="code" href="class_c_m_a.html" title="Implements the most recent version of the non-elitist CMA-ES.">CMA</a>&amp; cma)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <span class="comment">//change precision and save the old precision</span>
<a name="l00285"></a>00285     std::streamsize precision=stream.precision(21);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="comment">//writing states</span>
<a name="l00288"></a>00288     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00289"></a>00289     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00290"></a>00290     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#acc2ce8ddd0b4fdf736bd03846f2d96e4">chi_n</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00291"></a>00291     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00292"></a>00292     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00293"></a>00293     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a4e79b9b4c075e9673de9d9310af76779">csu</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00294"></a>00294     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#af9051c4560e9d39c44e4bd7698e37805">ccu</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00295"></a>00295     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a1320bc0b4c245494cb764789440ad31a">ccov</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00296"></a>00296     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a43976b2c44e7a5fda662f7e5ff4b9c0c">d</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00297"></a>00297     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00298"></a>00298     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">//reading chromosomes</span>
<a name="l00301"></a>00301     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00302"></a>00302     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00303"></a>00303     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#afef181a0482be3e11d0160a7e493a7fb">meanz</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">//reading arrays</span>
<a name="l00306"></a>00306     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00307"></a>00307     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00308"></a>00308     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00309"></a>00309     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00310"></a>00310     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00311"></a>00311     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00312"></a>00312     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00313"></a>00313     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00314"></a>00314     stream&lt;&lt;cma.<a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="comment">//reset precision</span>
<a name="l00317"></a>00317     stream.precision(precision);
<a name="l00318"></a>00318     <span class="keywordflow">return</span> stream;
<a name="l00319"></a>00319 }
<a name="l00320"></a><a class="code" href="_c_m_a_8h.html#a08498dc607cbf317a0d50ef754cba138">00320</a> std::istream &amp; <a class="code" href="_c_m_a_8cpp.html#a08498dc607cbf317a0d50ef754cba138">operator&gt;&gt;</a>( std::istream &amp; stream, <a class="code" href="class_c_m_a.html" title="Implements the most recent version of the non-elitist CMA-ES.">CMA</a>&amp; cma)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322     <span class="comment">//change precision and save the old precision</span>
<a name="l00323"></a>00323     <span class="keywordtype">double</span> precision=stream.precision(21);
<a name="l00324"></a>00324     <span class="comment">//reading states</span>
<a name="l00325"></a>00325     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a1e983106104b33b2dbdd168fc5baa011">n</a>;
<a name="l00326"></a>00326     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a899397645afa5999ca186f73ff6a87c4">sigma</a>;
<a name="l00327"></a>00327     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#acc2ce8ddd0b4fdf736bd03846f2d96e4">chi_n</a>;
<a name="l00328"></a>00328     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a204116b17558d6ca3a56118884a90001">cc</a>;
<a name="l00329"></a>00329     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#ae0770c89c8405361d25fff4455e1b95c">cs</a>;
<a name="l00330"></a>00330     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a4e79b9b4c075e9673de9d9310af76779">csu</a>;
<a name="l00331"></a>00331     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#af9051c4560e9d39c44e4bd7698e37805">ccu</a>;
<a name="l00332"></a>00332     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a1320bc0b4c245494cb764789440ad31a">ccov</a>;
<a name="l00333"></a>00333     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a43976b2c44e7a5fda662f7e5ff4b9c0c">d</a>;
<a name="l00334"></a>00334     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#aa90f3886eb7d8a5e37431708b6f82223">mueff</a>;
<a name="l00335"></a>00335     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a19e9ba79ad190abb8d1ff52b07dd47d2">mucov</a>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">//reading chromosomes</span>
<a name="l00338"></a>00338     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a856cb190e59a942902b7ad703880240c">x</a>;
<a name="l00339"></a>00339     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a478d265574d5e3ed993c7b1e5454f696">xPrime</a>;
<a name="l00340"></a>00340     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#afef181a0482be3e11d0160a7e493a7fb">meanz</a>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="comment">//reading arrays</span>
<a name="l00343"></a>00343     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#aee696dc5c5c7ea5ef9927a4b91797200">z</a>;
<a name="l00344"></a>00344     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a2049d9235cb652102f5543be965c30a2">pc</a>;
<a name="l00345"></a>00345     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#afdf4368c3f0c39b1129863b7d2620e48">ps</a>;
<a name="l00346"></a>00346     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#ad961a8c27d34445d53b6dc8290646388">C</a>;
<a name="l00347"></a>00347     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a34095bcc7a48ee2f6c417855e7dbd1ab">Z</a>;
<a name="l00348"></a>00348     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a664ca369df7e1af7f437c46ca70f3e13">lambda</a>;
<a name="l00349"></a>00349     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#ac0d81e307a5945a108b6623cc166ac9b">B</a>;
<a name="l00350"></a>00350     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a003115cfd6247630ed3d398624409d25">w</a>;
<a name="l00351"></a>00351     stream&gt;&gt;cma.<a class="code" href="class_c_m_a.html#a9f21c3e144abfb5a6cee9dd651db0028">theVector</a>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">//reset precision state</span>
<a name="l00354"></a>00354     stream.precision(precision);
<a name="l00355"></a>00355     <span class="keywordflow">return</span> stream;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="class_c_m_a_search.html#a47308b06636c13d23984c6e5949cc90d">00362</a> <a class="code" href="class_c_m_a_search.html#a47308b06636c13d23984c6e5949cc90d">CMASearch::CMASearch</a>()
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364     <a class="code" href="class_search_algorithm_base.html#af38fae867a4a31aeca6406bb2f382bd2" title="name of this algorithm">m_name</a> = <span class="stringliteral">&quot;CMA-ES&quot;</span>;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> = NULL;
<a name="l00367"></a>00367     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> = NULL;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a><a class="code" href="class_c_m_a_search.html#add6863cea0d9c67d500857d19e02dbc6">00370</a> <a class="code" href="class_c_m_a_search.html#add6863cea0d9c67d500857d19e02dbc6">CMASearch::~CMASearch</a>()
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> != NULL) <span class="keyword">delete</span> <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>;
<a name="l00373"></a>00373     <span class="keywordflow">if</span> (<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> != NULL) <span class="keyword">delete</span> <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>;
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="class_c_m_a_search.html#a178b6e4866c58054afe9e3106d115df7">00377</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#a178b6e4866c58054afe9e3106d115df7">CMASearch::init</a>(<a class="code" href="class_objective_function_v_s.html">ObjectiveFunctionVS&lt;double&gt;</a>&amp; fitness, <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">CMA::RecombType</a> recomb, <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">CMA::UpdateType</a> cupdate)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, dim = fitness.<a class="code" href="class_objective_function_v_s.html#a81d070aa0f782680dbcda03969790b57" title="Retreive the search space dimension.">dimension</a>();
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a> = &amp;fitness;
<a name="l00382"></a>00382     <a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a> = <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#a2d8b1dce1e74891713cee53e3fc8b45a">suggestLambda</a>(dim);
<a name="l00383"></a>00383     <a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a> = <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#af50a5a2b0ccbc61e450101753ccb0939">suggestMu</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, recomb);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// Sample three initial points and determine the</span>
<a name="l00386"></a>00386     <span class="comment">// initial step size as the median of their distances.</span>
<a name="l00387"></a>00387     Vector start1(dim);
<a name="l00388"></a>00388     Vector start2(dim);
<a name="l00389"></a>00389     Vector start3(dim);
<a name="l00390"></a>00390     <span class="keywordtype">double</span>* p;
<a name="l00391"></a>00391     p = &amp;start1(0);
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (! fitness.<a class="code" href="class_objective_function_v_s.html#acdf4c0d9de30d0e8617e05cb9f7cb6c2" title="For a BoxConstraintHandler we can automatically propose a starting point.">ProposeStartingPoint</a>(p)) <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[CMASearch::init] The fitness function must propose a starting point&quot;</span>);
<a name="l00393"></a>00393     p = &amp;start2(0);
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (! fitness.<a class="code" href="class_objective_function_v_s.html#acdf4c0d9de30d0e8617e05cb9f7cb6c2" title="For a BoxConstraintHandler we can automatically propose a starting point.">ProposeStartingPoint</a>(p)) <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[CMASearch::init] The fitness function must propose a starting point&quot;</span>);
<a name="l00395"></a>00395     p = &amp;start3(0);
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (! fitness.<a class="code" href="class_objective_function_v_s.html#acdf4c0d9de30d0e8617e05cb9f7cb6c2" title="For a BoxConstraintHandler we can automatically propose a starting point.">ProposeStartingPoint</a>(p)) <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[CMASearch::init] The fitness function must propose a starting point&quot;</span>);
<a name="l00397"></a>00397     <span class="keywordtype">double</span> d[3];
<a name="l00398"></a>00398     d[0] = (start2 - start1).norm();
<a name="l00399"></a>00399     d[1] = (start3 - start1).norm();
<a name="l00400"></a>00400     d[2] = (start3 - start2).norm();
<a name="l00401"></a>00401     std::sort(d, d + 3);
<a name="l00402"></a>00402     <span class="keywordtype">double</span> stepsize = d[1]; <span class="keywordflow">if</span> (stepsize == 0.0) stepsize = 1.0;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a> point(dim);
<a name="l00405"></a>00405     <span class="keywordflow">for</span> (i=0; i&lt;dim; i++) point[i] = start1(i);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00408"></a>00408     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00411"></a>00411     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">init</a>(dim, stepsize, *<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>, recomb, cupdate);
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="class_c_m_a_search.html#a0f12af32d5b9069b7f8979d36ce4def3">00416</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#a178b6e4866c58054afe9e3106d115df7">CMASearch::init</a>(<a class="code" href="class_objective_function_v_s.html">ObjectiveFunctionVS&lt;double&gt;</a>&amp; fitness, <span class="keyword">const</span> Array&lt;double&gt;&amp; start, <span class="keywordtype">double</span> stepsize, <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">CMA::RecombType</a> recomb, <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">CMA::UpdateType</a> cupdate)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, dim = fitness.<a class="code" href="class_objective_function_v_s.html#a81d070aa0f782680dbcda03969790b57" title="Retreive the search space dimension.">dimension</a>();
<a name="l00419"></a>00419     SIZE_CHECK(start.ndim() == 1);
<a name="l00420"></a>00420     SIZE_CHECK(start.dim(0) == dim);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a> = &amp;fitness;
<a name="l00423"></a>00423     <a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a> = <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#a2d8b1dce1e74891713cee53e3fc8b45a">suggestLambda</a>(dim);
<a name="l00424"></a>00424     <a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a> = <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#af50a5a2b0ccbc61e450101753ccb0939">suggestMu</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, recomb);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a> point(dim);
<a name="l00427"></a>00427     <span class="keywordflow">for</span> (i=0; i&lt;dim; i++) point[i] = start(i);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00430"></a>00430     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00433"></a>00433     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">init</a>(dim, stepsize, *<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>, recomb, cupdate);
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="class_c_m_a_search.html#a7e0509fce602fb0143c4dcca777e4d4c">00438</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#a178b6e4866c58054afe9e3106d115df7">CMASearch::init</a>(<a class="code" href="class_objective_function_v_s.html">ObjectiveFunctionVS&lt;double&gt;</a>&amp; fitness, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mu, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lambda, <span class="keyword">const</span> Array&lt;double&gt;&amp; start, <span class="keywordtype">double</span> stepsize, <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">CMA::RecombType</a> recomb, <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">CMA::UpdateType</a> cupdate)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, dim = fitness.<a class="code" href="class_objective_function_v_s.html#a81d070aa0f782680dbcda03969790b57" title="Retreive the search space dimension.">dimension</a>();
<a name="l00441"></a>00441     SIZE_CHECK(start.ndim() == 1);
<a name="l00442"></a>00442     SIZE_CHECK(start.dim(0) == dim);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     <a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a> = &amp;fitness;
<a name="l00445"></a>00445     <a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a> = <a class="code" href="class_evolutionary_algorithm.html#ac7b3284df62680387115fc7635ba35a9">lambda</a>;
<a name="l00446"></a>00446     <a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a> = <a class="code" href="class_evolutionary_algorithm.html#a48be0c2b401d171cd1cc421d78d36f8c">mu</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a> point(dim);
<a name="l00449"></a>00449     <span class="keywordflow">for</span> (i=0; i&lt;dim; i++) point[i] = start(i);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00452"></a>00452     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00455"></a>00455     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">init</a>(dim, stepsize, *<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>, recomb, cupdate);
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00460"></a><a class="code" href="class_c_m_a_search.html#a4325ad1ab6417a6cbadc55e23806fb06">00460</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#a178b6e4866c58054afe9e3106d115df7">CMASearch::init</a>(<a class="code" href="class_objective_function_v_s.html">ObjectiveFunctionVS&lt;double&gt;</a>&amp; fitness, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mu, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lambda, <span class="keyword">const</span> Array&lt;double&gt;&amp; start, <span class="keyword">const</span> Array&lt;double&gt;&amp; stepsize, <a class="code" href="class_c_m_a.html#a7585b7e1f2b6e5f5982a6892143b8c98">CMA::RecombType</a> recomb, <a class="code" href="class_c_m_a.html#ae76fc9cfb07a35c3e801ad611ef0fb86">CMA::UpdateType</a> cupdate)
<a name="l00461"></a>00461 {
<a name="l00462"></a>00462     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, dim = fitness.<a class="code" href="class_objective_function_v_s.html#a81d070aa0f782680dbcda03969790b57" title="Retreive the search space dimension.">dimension</a>();
<a name="l00463"></a>00463     SIZE_CHECK(start.ndim() == 1);
<a name="l00464"></a>00464     SIZE_CHECK(stepsize.ndim() == 1);
<a name="l00465"></a>00465     SIZE_CHECK(start.dim(0) == dim);
<a name="l00466"></a>00466     SIZE_CHECK(stepsize.dim(0) == dim);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a> = &amp;fitness;
<a name="l00469"></a>00469     <a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a> = <a class="code" href="class_evolutionary_algorithm.html#ac7b3284df62680387115fc7635ba35a9">lambda</a>;
<a name="l00470"></a>00470     <a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a> = <a class="code" href="class_evolutionary_algorithm.html#a48be0c2b401d171cd1cc421d78d36f8c">mu</a>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a> point(dim);
<a name="l00473"></a>00473     <span class="keywordflow">for</span> (i=0; i&lt;dim; i++) point[i] = start(i);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#a4ac12890a542161f9a3d6abcd3136a39">m_mu</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00476"></a>00476     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a> = <span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>(<a class="code" href="class_evolutionary_algorithm.html#add3c844ecd202d48440417c92dc4171f">m_lambda</a>, point, <a class="code" href="class_chromosome_t_3_01double_01_4.html" title="chromosome based on double numbers">ChromosomeT&lt;double&gt;</a>(dim));
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00479"></a>00479     <a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>-&gt;<a class="code" href="class_population.html#a305c35ad14f9ac628f0fd8207b5d2107">setMinimize</a>();
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     std::vector&lt;double&gt; var(dim);
<a name="l00482"></a>00482     <span class="keywordflow">for</span> (i=0; i&lt;dim; i++) var[i] = stepsize(i) * stepsize(i);
<a name="l00483"></a>00483     <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#adc0ad97207a0b4160dfc85124094dd61">init</a>(dim, var, 1.0, *<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>, recomb, cupdate);
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a><a class="code" href="class_c_m_a_search.html#aaf3dd60710f1018d6b33b0121e0793c6">00486</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#aaf3dd60710f1018d6b33b0121e0793c6" title="main interface: perform one iteration of the search algorithm">CMASearch::run</a>()
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> o;
<a name="l00489"></a>00489     <span class="keywordflow">for</span> (o=0; o&lt;<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>-&gt;<a class="code" href="class_population.html#afd59ccfaf65813549e6ea756ef0fb54b">size</a>(); o++) {
<a name="l00490"></a>00490         <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l00491"></a>00491             <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#ad8122c6cbde46aa4e8e20573c546c829" title="mutation after global intermediate recombination">create</a>((*<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>)[o]);
<a name="l00492"></a>00492             <span class="keywordflow">if</span> (<a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a>-&gt;<a class="code" href="class_objective_function_v_s.html#a7e44709339535d341a0eadd5351f1a5b" title="feasibility check">isFeasible</a>((*<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>)[o][0])) <span class="keywordflow">break</span>;
<a name="l00493"></a>00493             <span class="keywordflow">if</span> (<a class="code" href="class_c_m_a_search.html#a8921f26f752376cb0b4b0bba8be0ed04">m_fitness</a>-&gt;<a class="code" href="class_objective_function_v_s.html#abac8099595c08d9e654ff8ca4aa94d72" title="if possible, return the closest feasible point">closestFeasible</a>((*<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>)[o][0])) <span class="keywordflow">break</span>;
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495         <span class="keywordtype">double</span> f = (*m_fitness)(&amp;(*m_offspring)[o][0][0]);
<a name="l00496"></a>00496         (*m_offspring)[o].setFitness(f);
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>-&gt;<a class="code" href="class_population.html#a10bf6a8241bf428b2f7735bb13c9bebe">selectMuLambda</a>(*<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>, 0u);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>.<a class="code" href="class_c_m_a.html#a1ff2d788fe7d6f19b406135141dfc012" title="do the update of the covariance matrix and the global step size">updateStrategyParameters</a>(*<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <a class="code" href="class_c_m_a_search.html#aaf3dd60710f1018d6b33b0121e0793c6" title="main interface: perform one iteration of the search algorithm">SearchAlgorithm&lt;double*&gt;::run</a>();
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="class_c_m_a_search.html#a46251e899b148b57839a360bce81743c">00506</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#a46251e899b148b57839a360bce81743c" title="return the current set of pareto-optimal solutions">CMASearch::bestSolutions</a>(std::vector&lt;double*&gt;&amp; points)
<a name="l00507"></a>00507 {
<a name="l00508"></a>00508     points.resize(1);
<a name="l00509"></a>00509     points[0] = &amp;((*m_parents)[0][0][0]);
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="class_c_m_a_search.html#aa6fca6303d97f2a52d135c47db984216">00512</a> <span class="keywordtype">void</span> <a class="code" href="class_c_m_a_search.html#aa6fca6303d97f2a52d135c47db984216" title="Return a two-dimensional array of fitness values.">CMASearch::bestSolutionsFitness</a>(Array&lt;double&gt;&amp; fitness)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514     fitness.resize(1, 1, <span class="keyword">false</span>);
<a name="l00515"></a>00515     fitness(0, 0) = (*m_parents)[0].fitnessValue();
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="_c_m_a_8h.html#a11c98547fe8dffd4c05378cbbc66d383">00518</a> std::ostream &amp; <a class="code" href="_c_m_a_8cpp.html#ac019ecf5ec772bd53effff0553633b9d">operator&lt;&lt;</a>( std::ostream &amp; stream, <span class="keyword">const</span> <a class="code" href="class_c_m_a_search.html" title="Non-elitist CMA-ES implementing the interface EvolutionaryAlgorithm.">CMASearch</a>&amp; search)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520     <span class="keywordtype">double</span> precision=stream.precision(21);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     stream&lt;&lt;search.<a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;*search.<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;*search.<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>&lt;&lt;std::flush;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     stream.precision(precision);
<a name="l00525"></a>00525     <span class="keywordflow">return</span> stream;
<a name="l00526"></a>00526 }
<a name="l00527"></a><a class="code" href="_c_m_a_8h.html#a4c69f74ccb5f3dfa03142e45b0760681">00527</a> std::istream &amp; <a class="code" href="_c_m_a_8cpp.html#a08498dc607cbf317a0d50ef754cba138">operator&gt;&gt;</a>( std::istream &amp; stream, <a class="code" href="class_c_m_a_search.html" title="Non-elitist CMA-ES implementing the interface EvolutionaryAlgorithm.">CMASearch</a>&amp; search)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <span class="keywordtype">double</span> precision=stream.precision(21);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="keywordflow">if</span>(!search.<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>)
<a name="l00532"></a>00532         search.<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>=<span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>();
<a name="l00533"></a>00533     <span class="keywordflow">if</span>(!search.<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>)
<a name="l00534"></a>00534         search.<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>=<span class="keyword">new</span> <a class="code" href="class_population_t.html">PopulationT&lt;double&gt;</a>();
<a name="l00535"></a>00535 
<a name="l00536"></a>00536     stream&gt;&gt;search.<a class="code" href="class_c_m_a_search.html#a8fd63bbd8741910570da9f69030ac051">m_cma</a>
<a name="l00537"></a>00537           &gt;&gt;*search.<a class="code" href="class_c_m_a_search.html#a82027496667d15932810ca0dc7d1c0b9">m_parents</a>
<a name="l00538"></a>00538           &gt;&gt;*search.<a class="code" href="class_c_m_a_search.html#ac252d538b7ae1a437fdcc31052b0e34f">m_offspring</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     stream.precision(precision);
<a name="l00541"></a>00541     <span class="keywordflow">return</span> stream;
<a name="l00542"></a>00542 }
</pre></div></div>
</div>
</div>
</div>
</body></html>
