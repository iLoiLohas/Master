<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ReClaM: FFNet.cpp Source File</title>
<script type="text/javaScript" src="search/search.js"></script>
<link href="../css/main.css" rel="stylesheet" type="text/css"/>
</head>
<body id="type-b">

<div id="wrap">
<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
<div id="poweredby">
<img style="width: 95%;" src="../images/SharkLogo.png"/>
</div>		
  
<ul id="nav">
  <li class="first"><a href="../index.html">About Shark</a></li>
  <li><a href="#">Sourceforge</a>
  
  <ul>
    <li class="first"><a href="http://shark-project.sourceforge.net">Project Summary</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/files/">Downloads</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/develop">Subversion Repository</a></li>
  </ul>
  
</li>
<li class="first"><a href="../GettingStarted.html">Getting Started</a>
<li class="first"><a href="../Tutorials.html">Tutorials</a>
<li class="first"><a href="../FAQ.html">FAQ</a>

<li class="first"><a href="#">Main Modules</a>
<ul>
  <li class="first"><a href="../ReClaM/index.html">ReClaM</a>
  <li class="first"><a href="../EALib/index.html">EALib</a>
  <li class="first"><a href="../MOO-EALib/index.html">MOO-EALib</a>
  <li class="first"><a href="../Fuzzy/index.html">Fuzzy</a>
</ul>
</li>
<li class="first"><a href="#">Tools</a>
<ul>
  <li class="first"><a href="../Mixture/index.html">Mixture</a>
  <li><a href="../Array/index.html">Array</a>
  <li><a href="../Rng/index.html">Rng</a>
  <li><a href="../LinAlg/index.html">LinAlg</a>
  <li class="last"><a href="../FileUtil/index.html">FileUtil</a>		    
</ul>
</li>
</ul>
</div>

<!--<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
  <ul id="nav">
    <li><a href="../index.html"><span>Shark&nbsp;Main&nbsp;Page</span></a></li>
    <li><a href="../Array/index.html"><span>Array</span></a></li>
    <li><a href="../Rng/index.html"><span>Rng</span></a></li>
    <li><a href="../LinAlg/index.html"><span>LinAlg</span></a></li>
    <li><a href="../FileUtil/index.html"><span>FileUtil</span></a></li>
    <li><a href="../EALib/index.html"><span>EALib</span></a></li>
    <li><a href="../MOO-EALib/index.html"><span>MOO-EALib</span></a></li>
    <li class="active"><a href="../ReClaM/index.html"><span>ReClaM</span></a></li>
    <li><a href="../Fuzzy/index.html"><span>Fuzzy</span></a></li>
    <li><a href="../Mixture/index.html"><span>Mixture</span></a></li>
    <li><a href="../tutorials/index.html"><span>Tutorials</span></a></li>
    <li><a href="../faq/index.html"><span>FAQ</span></a></li>
  </ul>
 </div> -->
<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>FFNet.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_f_f_net_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//===========================================================================</span>
<a name="l00042"></a>00042 <span class="comment"></span><span class="comment">//===========================================================================</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;SharkDefs.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;ReClaM/FFNet.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">using namespace </span>std;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">//===========================================================================</span>
<a name="l00067"></a><a class="code" href="class_f_f_net.html#ad208d885ec754fc01ad71767fd2e2719">00067</a> <span class="comment"></span><a class="code" href="class_f_f_net.html#ad208d885ec754fc01ad71767fd2e2719" title="Destructs an feed forward network object.">FFNet::~FFNet</a>()
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (z) <span class="keyword">delete</span> [] z;
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">//===========================================================================</span>
<a name="l00111"></a><a class="code" href="class_f_f_net.html#aae1af26125b71f4145e8d6acff01d0b6">00111</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="class_f_f_net.html#aae1af26125b71f4145e8d6acff01d0b6" title="Activation function  of the hidden neurons.">FFNet::g</a>(<span class="keywordtype">double</span> a)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113     <span class="keywordflow">return</span> 1 / (1 + exp(-a));
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">//===========================================================================</span>
<a name="l00144"></a><a class="code" href="class_f_f_net.html#a87d90f96079c03024fff47938fe8cdb2">00144</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="class_f_f_net.html#a87d90f96079c03024fff47938fe8cdb2" title="Computes the derivative of the activation function  for the hidden neurons.">FFNet::dg</a>(<span class="keywordtype">double</span> ga)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146     <span class="keywordflow">return</span> ga *(1 - ga);
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">//===========================================================================</span>
<a name="l00190"></a><a class="code" href="class_f_f_net.html#a2fe2aa47a4c016ec9ab9b8054da4b023">00190</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="class_f_f_net.html#a2fe2aa47a4c016ec9ab9b8054da4b023" title="Activation function  of the output neurons.">FFNet::gOutput</a>(<span class="keywordtype">double</span> a)
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192     <span class="keywordflow">return</span> 1 / (1 + exp(-a));
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">//===========================================================================</span>
<a name="l00223"></a><a class="code" href="class_f_f_net.html#a6c7c6bd2d1f4cafd418d004ec21a493a">00223</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="class_f_f_net.html#a6c7c6bd2d1f4cafd418d004ec21a493a" title="Computes the derivative of the activation function  for the output neurons.">FFNet::dgOutput</a>(<span class="keywordtype">double</span> ga)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <span class="keywordflow">return</span> ga *(1 - ga);
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">//===========================================================================</span>
<a name="l00254"></a><a class="code" href="class_f_f_net.html#a1145d8a2c35d7b97c5fe321d82d5040d">00254</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a1145d8a2c35d7b97c5fe321d82d5040d" title="Initializes the random number generator and the weights of the net.">FFNet::initWeights</a>(<span class="keywordtype">long</span> seed, <span class="keywordtype">double</span> l, <span class="keywordtype">double</span> h)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256     Rng::seed(seed);
<a name="l00257"></a>00257     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = inputDimension; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; numberOfNeurons; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l00258"></a>00258     {
<a name="l00259"></a>00259         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l00260"></a>00260             <span class="keywordflow">if</span> (connection(i, j)) weight(i, j) = Rng::uni(l, h);
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (connectionMatrix(i, bias)) weight(i, bias) = Rng::uni(l, h);
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     writeParameters();
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="comment">//===========================================================================</span>
<a name="l00291"></a>00291 <span class="comment"></span><span class="keyword">inline</span>
<a name="l00292"></a><a class="code" href="class_f_f_net.html#a0d0cdea05c74b716734334c6ba096bcf">00292</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a1145d8a2c35d7b97c5fe321d82d5040d" title="Initializes the random number generator and the weights of the net.">FFNet::initWeights</a>(<span class="keywordtype">double</span> l, <span class="keywordtype">double</span> h)
<a name="l00293"></a>00293 {
<a name="l00294"></a>00294     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = inputDimension; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; numberOfNeurons; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l00297"></a>00297             <span class="keywordflow">if</span> (connection(i, j)) weight(i, j) = Rng::uni(l, h);
<a name="l00298"></a>00298         <span class="keywordflow">if</span> (connectionMatrix(i, bias)) weight(i, bias) = Rng::uni(l, h);
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     writeParameters();
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="comment">//===========================================================================</span>
<a name="l00329"></a>00329 <span class="comment"></span><span class="keyword">inline</span>
<a name="l00330"></a><a class="code" href="class_f_f_net.html#a0f3207cb0ebda8ff78fe90f2c8bfdddf">00330</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a0f3207cb0ebda8ff78fe90f2c8bfdddf" title="Uses the input pattern(s) input for the Feed Forward Net model to produce the output vector(s) output...">FFNet::model</a>(<span class="keyword">const</span> Array&lt;double&gt; &amp;input, Array&lt;double&gt; &amp;output)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332     readParameters();
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (input.ndim() == 1)
<a name="l00334"></a>00334     {
<a name="l00335"></a>00335         output.resize(outputDimension, <span class="keyword">false</span>);
<a name="l00336"></a>00336         activate(input);
<a name="l00337"></a>00337         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = firstOutputNeuron, c = 0 ; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; numberOfNeurons; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++, c++)
<a name="l00338"></a>00338             output(c) = z[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">else</span>
<a name="l00341"></a>00341     {
<a name="l00342"></a>00342         output.resize(input.dim(0), outputDimension, <span class="keyword">false</span>);
<a name="l00343"></a>00343         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> pattern = 0; pattern &lt; input.dim(0); pattern++)
<a name="l00344"></a>00344         {
<a name="l00345"></a>00345             activate(input[pattern]);
<a name="l00346"></a>00346             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = firstOutputNeuron, c = 0 ; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; numberOfNeurons; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++, c++)
<a name="l00347"></a>00347                 output(pattern, c) = z[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">//===========================================================================</span>
<a name="l00374"></a>00374 <span class="comment"></span><span class="keyword">inline</span>
<a name="l00375"></a><a class="code" href="class_f_f_net.html#a6b6f31411b0a2660dfd0408f34ffc779">00375</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a6b6f31411b0a2660dfd0408f34ffc779" title="Performs a backpropagation to calculate the derivatives of the outputs with respect to the parameters...">FFNet::backprop</a>(Array&lt;double&gt;&amp; derivative)
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j;  <span class="comment">// denote neurons</span>
<a name="l00378"></a>00378     <span class="keywordtype">unsigned</span> c;     <span class="comment">// denotes output</span>
<a name="l00379"></a>00379     <span class="keywordtype">unsigned</span> pos;   <span class="comment">// the actual position in the Array derivative</span>
<a name="l00380"></a>00380     <span class="keywordtype">double</span> sum;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">// 1. the &#39;local gradient&#39; deltas for each</span>
<a name="l00383"></a>00383     <span class="comment">//    output are calculated</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// output neurons</span>
<a name="l00386"></a>00386     <span class="keywordflow">for</span> (j = firstOutputNeuron; j &lt; numberOfNeurons; j++)
<a name="l00387"></a>00387         <span class="keywordflow">for</span> (c = 0; c &lt; outputDimension; c++)
<a name="l00388"></a>00388             <span class="keywordflow">if</span> (c + firstOutputNeuron == j)  d(c, j) = dgOutput(z[j]);
<a name="l00389"></a>00389             <span class="keywordflow">else</span> d(c, j) = 0;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">// hidden units</span>
<a name="l00392"></a>00392     <span class="keywordflow">for</span> (j = firstOutputNeuron - 1; j &gt;= inputDimension; j--)
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394         <span class="keywordflow">for</span> (c = 0; c &lt; outputDimension; c++)
<a name="l00395"></a>00395         {
<a name="l00396"></a>00396             sum = 0;
<a name="l00397"></a>00397             <span class="keywordflow">for</span> (i = j + 1; i &lt; numberOfNeurons; i++)
<a name="l00398"></a>00398             {
<a name="l00399"></a>00399                 <span class="keywordflow">if</span> (connection(i, j)) sum += weight(i, j) * d(c, i);
<a name="l00400"></a>00400             }
<a name="l00401"></a>00401             d(c, j) = dg(z[j]) * sum;
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="comment">// 2. the gradient for each output is calculated from</span>
<a name="l00406"></a>00406     <span class="comment">//    delta</span>
<a name="l00407"></a>00407     pos = 0;
<a name="l00408"></a>00408     <span class="keywordflow">for</span> (i = inputDimension; i &lt; numberOfNeurons; i++)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l00411"></a>00411         {
<a name="l00412"></a>00412             <span class="keywordflow">if</span> (connection(i, j))
<a name="l00413"></a>00413             {
<a name="l00414"></a>00414                 <span class="keywordflow">for</span> (c = 0; c &lt; outputDimension; c++)
<a name="l00415"></a>00415                 {
<a name="l00416"></a>00416                     derivative(c, pos) += d(c, i) * z[j];
<a name="l00417"></a>00417                 }
<a name="l00418"></a>00418                 pos++;
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421         <span class="keywordflow">if</span> (connection(i, bias))
<a name="l00422"></a>00422         {
<a name="l00423"></a>00423             <span class="keywordflow">for</span> (c = 0; c &lt; outputDimension; c++)
<a name="l00424"></a>00424             { <span class="comment">// bias</span>
<a name="l00425"></a>00425                 derivative(c, pos) += d(c, i);
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427             pos++;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">//===========================================================================</span>
<a name="l00457"></a><a class="code" href="class_f_f_net.html#a3c366f4079adfb6f4330b5ad2be9d149">00457</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a2c2530dc1476e2ef5a3b2e648005ae58" title="Reads in one input pattern for the Feed Forward Net model and calculates the derivatives of the resul...">FFNet::modelDerivative</a>(<span class="keyword">const</span> Array&lt;double&gt; &amp;input, Array&lt;double&gt; &amp;output, Array&lt;double&gt;&amp; derivative)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459     <span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;  <span class="comment">// denotes neurons</span>
<a name="l00460"></a>00460     <span class="keywordtype">unsigned</span> c;  <span class="comment">// denotes output</span>
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     derivative.resize(getOutputDimension(), getParameterDimension(), <span class="keyword">false</span>);
<a name="l00463"></a>00463     derivative = 0.;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     readParameters();
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (input.ndim() == 1)
<a name="l00468"></a>00468     {
<a name="l00469"></a>00469         output.resize(getOutputDimension(), <span class="keyword">false</span>);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <span class="comment">// calculate output</span>
<a name="l00472"></a>00472         activate(input);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         <span class="keywordflow">for</span> (i = firstOutputNeuron, c = 0 ; i &lt; numberOfNeurons; i++, c++) {
<a name="l00475"></a>00475             output(c) = z[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="comment">// backpropagation step</span>
<a name="l00479"></a>00479         backprop(derivative);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481     <span class="keywordflow">else</span>
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483         output.resize(input.dim(0), getOutputDimension(), <span class="keyword">false</span>);
<a name="l00484"></a>00484         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> pattern = 0; pattern &lt; input.dim(0); pattern++)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486             activate(input[pattern]);
<a name="l00487"></a>00487             <span class="keywordflow">for</span> (i = firstOutputNeuron, c = 0 ; i &lt; numberOfNeurons; i++, c++) {
<a name="l00488"></a>00488                 output(pattern, c) = z[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00489"></a>00489             }
<a name="l00490"></a>00490             backprop(derivative);
<a name="l00491"></a>00491         }
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493 };
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="class_f_f_net.html#add36879bc7b76f2df4fe52cf39bc8999">00495</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#add36879bc7b76f2df4fe52cf39bc8999" title="Calculates the model&amp;#39;s general derivative.">FFNet::generalDerivative</a>(<span class="keyword">const</span> Array&lt;double&gt;&amp; input, <span class="keyword">const</span> Array&lt;double&gt;&amp; coeffs, Array&lt;double&gt;&amp; derivative)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j;  <span class="comment">// denote neurons</span>
<a name="l00498"></a>00498     <span class="keywordtype">unsigned</span> c;     <span class="comment">// denotes output</span>
<a name="l00499"></a>00499     <span class="keywordtype">unsigned</span> pos;   <span class="comment">// the actual position in the Array dedw</span>
<a name="l00500"></a>00500     <span class="keywordtype">double</span> sum;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     <span class="keywordflow">for</span> (i = firstOutputNeuron, c = 0 ; i &lt; numberOfNeurons; i++, c++)
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         delta(i) =  coeffs(c) * dgOutput(z[i]);
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="comment">// hidden units</span>
<a name="l00508"></a>00508     <span class="keywordflow">for</span> (j = firstOutputNeuron - 1; j &gt;= inputDimension; j--)
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510         sum = 0;
<a name="l00511"></a>00511         <span class="keywordflow">for</span> (i = j + 1; i &lt; numberOfNeurons; i++)
<a name="l00512"></a>00512         {
<a name="l00513"></a>00513             <span class="keywordflow">if</span> (connection(i, j)) sum += weight(i, j) * delta(i);
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515         delta(j) = dg(z[j]) * sum;
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="comment">// calculate error gradient</span>
<a name="l00519"></a>00519     pos = 0;
<a name="l00520"></a>00520     <span class="keywordflow">for</span> (i = inputDimension; i &lt; numberOfNeurons; i++)
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l00523"></a>00523         {
<a name="l00524"></a>00524             <span class="keywordflow">if</span> (connection(i, j))
<a name="l00525"></a>00525             {
<a name="l00526"></a>00526                 derivative(pos) -= delta(i) * z[j];
<a name="l00527"></a>00527                 pos++;
<a name="l00528"></a>00528             }
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530         <span class="keywordflow">if</span> (connection(i, bias))
<a name="l00531"></a>00531         { <span class="comment">// bias</span>
<a name="l00532"></a>00532             derivative(pos) -= delta(i);
<a name="l00533"></a>00533             pos++;
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 };
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">//===========================================================================</span>
<a name="l00566"></a><a class="code" href="class_f_f_net.html#a2c2530dc1476e2ef5a3b2e648005ae58">00566</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a2c2530dc1476e2ef5a3b2e648005ae58" title="Reads in one input pattern for the Feed Forward Net model and calculates the derivatives of the resul...">FFNet::modelDerivative</a>(<span class="keyword">const</span> Array&lt;double&gt;&amp; input, Array&lt;double&gt;&amp; derivative)
<a name="l00567"></a>00567 {
<a name="l00568"></a>00568     readParameters();
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     derivative.resize(getOutputDimension(), getParameterDimension(), <span class="keyword">false</span>);
<a name="l00571"></a>00571     derivative = 0.;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (input.ndim() == 1)
<a name="l00574"></a>00574     {
<a name="l00575"></a>00575         activate(input);
<a name="l00576"></a>00576         <span class="comment">// backpropagation step</span>
<a name="l00577"></a>00577         backprop(derivative);
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579     <span class="keywordflow">else</span>
<a name="l00580"></a>00580     {
<a name="l00581"></a>00581         stringstream s;
<a name="l00582"></a>00582         s &lt;&lt; <span class="stringliteral">&quot;the derivative of the model with respect to more than one input is not defined&quot;</span> &lt;&lt; endl;
<a name="l00583"></a>00583         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585 };
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">//===========================================================================</span>
<a name="l00612"></a><a class="code" href="class_f_f_net.html#a1fb4db7b5ef481c24c7c8d44300c4574">00612</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a1fb4db7b5ef481c24c7c8d44300c4574" title="Reserves memory for all internal net data structures.">FFNet::resize</a>()
<a name="l00613"></a>00613 {
<a name="l00614"></a>00614     numberOfNeurons   = connectionMatrix.dim(0);
<a name="l00615"></a>00615     bias              = numberOfNeurons;
<a name="l00616"></a>00616     firstOutputNeuron = numberOfNeurons - outputDimension;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <span class="keywordtype">unsigned</span> numberOfWeights = 0; <span class="comment">//numberOfNeurons - inputDimension;</span>
<a name="l00619"></a>00619     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; connectionMatrix.dim(0); <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l00622"></a>00622             <span class="keywordflow">if</span> (connectionMatrix(i, j)) numberOfWeights++;
<a name="l00623"></a>00623         <span class="keywordflow">if</span> (connectionMatrix(i, bias)) numberOfWeights++;
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     parameter.resize(numberOfWeights, <span class="keyword">false</span>);
<a name="l00627"></a>00627     d.resize(outputDimension, numberOfNeurons, <span class="keyword">false</span>);
<a name="l00628"></a>00628     delta.resize(numberOfNeurons, <span class="keyword">false</span>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (z) <span class="keyword">delete</span> [] z;
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (numberOfNeurons) z = <span class="keyword">new</span> <span class="keywordtype">double</span>[numberOfNeurons];
<a name="l00632"></a>00632     <span class="keywordflow">else</span> z = NULL;
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">//===========================================================================</span>
<a name="l00660"></a><a class="code" href="class_f_f_net.html#aa0f1291ab764d297462970cdba198358">00660</a> <span class="comment"></span><a class="code" href="class_f_f_net.html#a1b91d55ae87e513bc05ca9e6fc66ec1b" title="Creates a feed-forward network by reading the necessary information from a file named &amp;quot;filename&amp;...">FFNet::FFNet</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> in, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> out)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662     inputDimension   = in;
<a name="l00663"></a>00663     outputDimension  = out;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     numberOfNeurons   = 0;
<a name="l00666"></a>00666     bias              = 0;
<a name="l00667"></a>00667     firstOutputNeuron = 0;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     z = NULL;
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 <span class="comment">//===========================================================================</span>
<a name="l00702"></a><a class="code" href="class_f_f_net.html#a40753afaa25eb2e7c7ab8b28f6befd12">00702</a> <span class="comment"></span><a class="code" href="class_f_f_net.html#a1b91d55ae87e513bc05ca9e6fc66ec1b" title="Creates a feed-forward network by reading the necessary information from a file named &amp;quot;filename&amp;...">FFNet::FFNet</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> in, <span class="keywordtype">unsigned</span> out,
<a name="l00703"></a>00703              <span class="keyword">const</span> Array&lt;int&gt;&amp; cmat)
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (cmat.ndim() != 2)
<a name="l00706"></a>00706     {
<a name="l00707"></a>00707         stringstream s;
<a name="l00708"></a>00708         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l00709"></a>00709         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (cmat.dim(0) != (cmat.dim(1) - 1))
<a name="l00712"></a>00712     {
<a name="l00713"></a>00713         stringstream s;
<a name="l00714"></a>00714         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l00715"></a>00715         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     inputDimension   = in;
<a name="l00719"></a>00719     outputDimension  = out;
<a name="l00720"></a>00720     connectionMatrix = cmat;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     weightMatrix.resize(connectionMatrix, <span class="keyword">false</span>);
<a name="l00723"></a>00723     weightMatrix     = 0;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     z = NULL;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727     resize();
<a name="l00728"></a>00728     writeParameters();
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="comment">//===========================================================================</span>
<a name="l00760"></a><a class="code" href="class_f_f_net.html#a45f7915aa96a6633a47ee44fb8c7f3e0">00760</a> <span class="comment"></span><a class="code" href="class_f_f_net.html#a1b91d55ae87e513bc05ca9e6fc66ec1b" title="Creates a feed-forward network by reading the necessary information from a file named &amp;quot;filename&amp;...">FFNet::FFNet</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> in, <span class="keywordtype">unsigned</span> out,
<a name="l00761"></a>00761              <span class="keyword">const</span> Array&lt;int&gt;&amp; cmat, <span class="keyword">const</span> Array&lt;double&gt;&amp; wmat)
<a name="l00762"></a>00762 {
<a name="l00763"></a>00763     <span class="keywordflow">if</span> (cmat.ndim() != 2)
<a name="l00764"></a>00764     {
<a name="l00765"></a>00765         stringstream s;
<a name="l00766"></a>00766         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l00767"></a>00767         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (cmat.dim(0) != (cmat.dim(1) - 1))
<a name="l00770"></a>00770     {
<a name="l00771"></a>00771         stringstream s;
<a name="l00772"></a>00772         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l00773"></a>00773         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775     <span class="keywordflow">if</span> (wmat.ndim() != 2)
<a name="l00776"></a>00776     {
<a name="l00777"></a>00777         stringstream s;
<a name="l00778"></a>00778         s &lt;&lt; <span class="stringliteral">&quot;weight matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l00779"></a>00779         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781     <span class="keywordflow">if</span> (wmat.dim(0) != (wmat.dim(1) - 1))
<a name="l00782"></a>00782     {
<a name="l00783"></a>00783         stringstream s;
<a name="l00784"></a>00784         s &lt;&lt; <span class="stringliteral">&quot;weight matrix has to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l00785"></a>00785         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     inputDimension   = in;
<a name="l00789"></a>00789     outputDimension  = out;
<a name="l00790"></a>00790     connectionMatrix = cmat;
<a name="l00791"></a>00791     weightMatrix     = wmat;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     z = NULL;
<a name="l00794"></a>00794     resize();
<a name="l00795"></a>00795     writeParameters();
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 <span class="comment">//===========================================================================</span>
<a name="l00851"></a>00851 <span class="comment"></span><a class="code" href="class_f_f_net.html#a1b91d55ae87e513bc05ca9e6fc66ec1b" title="Creates a feed-forward network by reading the necessary information from a file named &amp;quot;filename&amp;...">FFNet::FFNet</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;filename)
<a name="l00852"></a>00852 {
<a name="l00853"></a>00853     ifstream input(filename.c_str());
<a name="l00854"></a>00854     <span class="keywordflow">if</span> (!input)
<a name="l00855"></a>00855     {
<a name="l00856"></a>00856         stringstream s;
<a name="l00857"></a>00857         s &lt;&lt; <span class="stringliteral">&quot;cannot open net file &quot;</span> &lt;&lt; filename &lt;&lt; endl;
<a name="l00858"></a>00858         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860     z = NULL;
<a name="l00861"></a>00861     input &gt;&gt; *<span class="keyword">this</span>;
<a name="l00862"></a>00862     input.close();
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">//===========================================================================</span>
<a name="l00893"></a><a class="code" href="class_f_f_net.html#ae3c50ba7f370e6ca2f6031f49eeefe13">00893</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(<span class="keyword">const</span> Array&lt;int&gt;&amp; cmat, <span class="keyword">const</span> Array&lt;double&gt;&amp; wmat)
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895     <span class="keywordflow">if</span> ((cmat.ndim() != 2) ||
<a name="l00896"></a>00896             (wmat.ndim() != 2))
<a name="l00897"></a>00897     {
<a name="l00898"></a>00898         stringstream s;
<a name="l00899"></a>00899         s &lt;&lt; <span class="stringliteral">&quot;connection or weight matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l00900"></a>00900         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="keywordflow">if</span> ((cmat.dim(0) != (cmat.dim(1) - 1)) ||
<a name="l00904"></a>00904             (cmat.dim(0) != wmat.dim(0)) ||
<a name="l00905"></a>00905             (cmat.dim(1) != wmat.dim(1)))
<a name="l00906"></a>00906     {
<a name="l00907"></a>00907         stringstream s;
<a name="l00908"></a>00908         s &lt;&lt; <span class="stringliteral">&quot;connection and weight matrices have to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l00909"></a>00909         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     connectionMatrix = cmat;
<a name="l00913"></a>00913     weightMatrix     = wmat;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     resize();
<a name="l00916"></a>00916     writeParameters();
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="comment">//===========================================================================</span>
<a name="l00957"></a><a class="code" href="class_f_f_net.html#ab1222be8d54d895fa3e4e42ed063a669">00957</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(Array&lt;unsigned&gt; &amp;layers,
<a name="l00958"></a>00958                                                  <span class="keywordtype">bool</span> ff_layer,    <span class="comment">// all connections between layers?</span>
<a name="l00959"></a>00959                                                  <span class="keywordtype">bool</span> ff_in_out,   <span class="comment">// shortcuts from in to out?</span>
<a name="l00960"></a>00960                                                  <span class="keywordtype">bool</span> ff_all,      <span class="comment">// all shortcuts?</span>
<a name="l00961"></a>00961                                                  <span class="keywordtype">bool</span> bias)        <span class="comment">// bias?</span>
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963     <span class="keywordtype">unsigned</span> N = 0;  <span class="comment">// total number of neurons:</span>
<a name="l00964"></a>00964     <span class="keywordtype">unsigned</span> row,    <span class="comment">// connection matrix row    (target neuron)</span>
<a name="l00965"></a>00965     column, <span class="comment">// connection matrix column (start neuron)</span>
<a name="l00966"></a>00966     k,      <span class="comment">// counter.</span>
<a name="l00967"></a>00967     z_pos,  <span class="comment">// first target neuron in next layer</span>
<a name="l00968"></a>00968     s_pos;  <span class="comment">// first start neuron in current layer</span>
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">//</span>
<a name="l00972"></a>00972     <span class="comment">// Calculate total number of neurons from the</span>
<a name="l00973"></a>00973     <span class="comment">// number of neurons per layer:</span>
<a name="l00974"></a>00974     <span class="comment">//</span>
<a name="l00975"></a>00975     <span class="keywordflow">for</span> (k = 0; k &lt; layers.dim(0); k++) N += layers(k);
<a name="l00976"></a>00976     connectionMatrix.resize(N, N + 1);
<a name="l00977"></a>00977     connectionMatrix = 0;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="comment">//</span>
<a name="l00980"></a>00980     <span class="comment">// set connections from each neuron of layer i to each</span>
<a name="l00981"></a>00981     <span class="comment">// neuron of layer i + 1 for all layers:</span>
<a name="l00982"></a>00982     <span class="comment">//</span>
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (ff_layer)
<a name="l00984"></a>00984     {
<a name="l00985"></a>00985         z_pos = layers(0);
<a name="l00986"></a>00986         s_pos = 0;
<a name="l00987"></a>00987         <span class="keywordflow">for</span> (k = 0; k &lt; layers.dim(0) - 1; k++)
<a name="l00988"></a>00988         {
<a name="l00989"></a>00989             <span class="keywordflow">for</span> (row = z_pos; row &lt; z_pos + layers(k + 1); row++)
<a name="l00990"></a>00990                 <span class="keywordflow">for</span> (column = s_pos; column &lt; s_pos + layers(k); column++)
<a name="l00991"></a>00991                     connectionMatrix(row, column) = 1;
<a name="l00992"></a>00992             s_pos += layers(k);
<a name="l00993"></a>00993             z_pos += layers(k + 1);
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     <span class="comment">//</span>
<a name="l00998"></a>00998     <span class="comment">// set connections from all input neurons to all output neurons:</span>
<a name="l00999"></a>00999     <span class="comment">//</span>
<a name="l01000"></a>01000     <span class="keywordflow">if</span> (ff_in_out)
<a name="l01001"></a>01001     {
<a name="l01002"></a>01002         <span class="keywordflow">for</span> (row = N - layers(layers.dim(0) - 1); row &lt; N; row++)
<a name="l01003"></a>01003             <span class="keywordflow">for</span> (column = 0; column &lt; layers(0); column++)
<a name="l01004"></a>01004                 connectionMatrix(row, column) = 1;
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007     <span class="comment">//</span>
<a name="l01008"></a>01008     <span class="comment">// set connections from all neurons of layer i to</span>
<a name="l01009"></a>01009     <span class="comment">// all neurons of layers j with j &gt; i for all layers i:</span>
<a name="l01010"></a>01010     <span class="comment">//</span>
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (ff_all)
<a name="l01012"></a>01012     {
<a name="l01013"></a>01013         z_pos = layers(0);
<a name="l01014"></a>01014         s_pos = 0;
<a name="l01015"></a>01015         <span class="keywordflow">for</span> (k = 0; k &lt; layers.dim(0) - 1; k++)
<a name="l01016"></a>01016         {
<a name="l01017"></a>01017             <span class="keywordflow">for</span> (row = z_pos; row &lt; z_pos + layers(k + 1); row++)
<a name="l01018"></a>01018                 <span class="keywordflow">for</span> (column = 0; column &lt; s_pos + layers(k); column++)
<a name="l01019"></a>01019                     connectionMatrix(row, column) = 1;
<a name="l01020"></a>01020             s_pos += layers(k);
<a name="l01021"></a>01021             z_pos += layers(k + 1);
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="comment">//</span>
<a name="l01026"></a>01026     <span class="comment">// set connections from all neurons (except the input neurons)</span>
<a name="l01027"></a>01027     <span class="comment">// to the bias values:</span>
<a name="l01028"></a>01028     <span class="comment">//</span>
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (bias)
<a name="l01030"></a>01030         <span class="keywordflow">for</span> (k = layers(0); k &lt; N; k++) connectionMatrix(k, N) = 1;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     weightMatrix.resize(connectionMatrix.dim(0), connectionMatrix.dim(1), <span class="keyword">false</span>);
<a name="l01033"></a>01033     weightMatrix = 0.;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     inputDimension = layers(0);
<a name="l01037"></a>01037     outputDimension = layers(layers.dim(0) - 1);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     resize();
<a name="l01040"></a>01040     parameter = 0;
<a name="l01041"></a>01041 
<a name="l01042"></a>01042     writeParameters();
<a name="l01043"></a>01043 }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 
<a name="l01046"></a>01046 <span class="comment">//===========================================================================</span>
<a name="l01086"></a><a class="code" href="class_f_f_net.html#aaaff85a1e636622d68d0992b8a9d3463">01086</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(<span class="keywordtype">unsigned</span> in, <span class="keywordtype">unsigned</span> hidden, <span class="keywordtype">unsigned</span> out,
<a name="l01087"></a>01087                                                  <span class="keywordtype">bool</span> ff_layer,  <span class="comment">// all connections beteween layers?</span>
<a name="l01088"></a>01088                                                  <span class="keywordtype">bool</span> ff_in_out, <span class="comment">// shortcuts from in to out?</span>
<a name="l01089"></a>01089                                                  <span class="keywordtype">bool</span> ff_all,    <span class="comment">// all shortcuts?</span>
<a name="l01090"></a>01090                                                  <span class="keywordtype">bool</span> bias)      <span class="comment">// bias?</span>
<a name="l01091"></a>01091 {
<a name="l01092"></a>01092     Array&lt;unsigned&gt; layer(3);
<a name="l01093"></a>01093     layer(0) = in;
<a name="l01094"></a>01094     layer(1) = hidden;
<a name="l01095"></a>01095     layer(2) = out;
<a name="l01096"></a>01096     setStructure(layer, ff_layer, ff_in_out, ff_all, bias);
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 <span class="comment">//===========================================================================</span>
<a name="l01141"></a><a class="code" href="class_f_f_net.html#afb0f709bb699a824551879118f08b313">01141</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(<span class="keywordtype">unsigned</span> in, <span class="keywordtype">unsigned</span> hidden1, <span class="keywordtype">unsigned</span> hidden2, <span class="keywordtype">unsigned</span> out,
<a name="l01142"></a>01142                                                  <span class="keywordtype">bool</span> ff_layer,   <span class="comment">// all connections beteween layers?</span>
<a name="l01143"></a>01143                                                  <span class="keywordtype">bool</span> ff_in_out,  <span class="comment">// shortcuts from in to out?</span>
<a name="l01144"></a>01144                                                  <span class="keywordtype">bool</span> ff_all,     <span class="comment">// all shortcuts?</span>
<a name="l01145"></a>01145                                                  <span class="keywordtype">bool</span> bias)       <span class="comment">// bias?</span>
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147     Array&lt;unsigned&gt; layer(4);
<a name="l01148"></a>01148     layer(0) = in;
<a name="l01149"></a>01149     layer(1) = hidden1;
<a name="l01150"></a>01150     layer(2) = hidden2;
<a name="l01151"></a>01151     layer(3) = out;
<a name="l01152"></a>01152     setStructure(layer, ff_layer, ff_in_out, ff_all, bias);
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 <span class="comment">//===========================================================================</span>
<a name="l01180"></a><a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0">01180</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(<span class="keyword">const</span> Array&lt;int&gt;&amp; cmat)
<a name="l01181"></a>01181 {
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (cmat.ndim() != 2)
<a name="l01183"></a>01183     {
<a name="l01184"></a>01184         stringstream s;
<a name="l01185"></a>01185         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l01186"></a>01186         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01187"></a>01187     }
<a name="l01188"></a>01188     <span class="keywordflow">if</span> (cmat.dim(0) != (cmat.dim(1) - 1))
<a name="l01189"></a>01189     {
<a name="l01190"></a>01190         stringstream s;
<a name="l01191"></a>01191         s &lt;&lt; <span class="stringliteral">&quot;connection matrix has to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l01192"></a>01192         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     connectionMatrix = cmat;
<a name="l01196"></a>01196     weightMatrix.resize(cmat.dim(0), cmat.dim(1), <span class="keyword">false</span>);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     resize();
<a name="l01199"></a>01199     parameter = 0;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201     writeParameters();
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 
<a name="l01205"></a>01205 <span class="comment">//===========================================================================</span>
<a name="l01239"></a><a class="code" href="class_f_f_net.html#acda39c27ad60598c008d7e5fba23bdfb">01239</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a95589da3770ac250948556b714445fd0" title="Based on a given connectionMatrix the structure of the current network is modified.">FFNet::setStructure</a>(<span class="keyword">const</span> Array&lt;double&gt;&amp; wmat, <span class="keywordtype">bool</span> preserve)
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241     <span class="keywordflow">if</span> (wmat.ndim() != 2)
<a name="l01242"></a>01242     {
<a name="l01243"></a>01243         stringstream s;
<a name="l01244"></a>01244         s &lt;&lt; <span class="stringliteral">&quot;weight matrix has not dimension two&quot;</span> &lt;&lt; endl;
<a name="l01245"></a>01245         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01246"></a>01246     }
<a name="l01247"></a>01247     <span class="keywordflow">if</span> (wmat.dim(0) != (wmat.dim(1) - 1))
<a name="l01248"></a>01248     {
<a name="l01249"></a>01249         stringstream s;
<a name="l01250"></a>01250         s &lt;&lt; <span class="stringliteral">&quot;weight matrix has to be (N + 1) x N&quot;</span> &lt;&lt; endl;
<a name="l01251"></a>01251         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     weightMatrix = wmat;
<a name="l01255"></a>01255     connectionMatrix.resize(wmat.dim(0), wmat.dim(1), <span class="keyword">false</span>);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     numberOfNeurons   = connectionMatrix.dim(0);
<a name="l01258"></a>01258     bias              = numberOfNeurons;
<a name="l01259"></a>01259     firstOutputNeuron = numberOfNeurons - outputDimension;
<a name="l01260"></a>01260 
<a name="l01261"></a>01261     <span class="keywordtype">unsigned</span> numberOfWeights = 0;
<a name="l01262"></a>01262     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; connectionMatrix.dim(0); <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l01263"></a>01263     {
<a name="l01264"></a>01264         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l01265"></a>01265         {
<a name="l01266"></a>01266             <span class="keywordflow">if</span> (preserve)
<a name="l01267"></a>01267             {
<a name="l01268"></a>01268                 <span class="keywordflow">if</span> (weightMatrix(i, j)  != 0.)
<a name="l01269"></a>01269                 {
<a name="l01270"></a>01270                     <span class="keywordflow">if</span> (connectionMatrix(i, j) == 0)
<a name="l01271"></a>01271                     {
<a name="l01272"></a>01272                         stringstream s;
<a name="l01273"></a>01273                         s &lt;&lt; <span class="stringliteral">&quot;weight specified for non-existing connection&quot;</span> &lt;&lt; endl;
<a name="l01274"></a>01274                         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01275"></a>01275                     }
<a name="l01276"></a>01276                     numberOfWeights++;
<a name="l01277"></a>01277                 }
<a name="l01278"></a>01278                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connectionMatrix(i, j) != 0) numberOfWeights++;
<a name="l01279"></a>01279                 <span class="keywordflow">if</span> (weightMatrix(i, bias)  != 0.)
<a name="l01280"></a>01280                 {
<a name="l01281"></a>01281                     <span class="keywordflow">if</span> (connectionMatrix(i, bias) == 0)
<a name="l01282"></a>01282                     {
<a name="l01283"></a>01283                         stringstream s;
<a name="l01284"></a>01284                         s &lt;&lt; <span class="stringliteral">&quot;weight specified for non-existing bias&quot;</span> &lt;&lt; endl;
<a name="l01285"></a>01285                         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01286"></a>01286                     }
<a name="l01287"></a>01287                     numberOfWeights++;
<a name="l01288"></a>01288                 }
<a name="l01289"></a>01289                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connectionMatrix(i, bias) != 0) numberOfWeights++;
<a name="l01290"></a>01290             }
<a name="l01291"></a>01291             <span class="keywordflow">else</span>
<a name="l01292"></a>01292             {
<a name="l01293"></a>01293                 <span class="keywordflow">if</span> (weightMatrix(i, j)  != 0.)
<a name="l01294"></a>01294                 {
<a name="l01295"></a>01295                     connectionMatrix(i, j) = 1;
<a name="l01296"></a>01296                     numberOfWeights++;
<a name="l01297"></a>01297                 }
<a name="l01298"></a>01298                 <span class="keywordflow">else</span>
<a name="l01299"></a>01299                 {
<a name="l01300"></a>01300                     connectionMatrix(i, j) = 0;
<a name="l01301"></a>01301                 }
<a name="l01302"></a>01302                 <span class="keywordflow">if</span> (weightMatrix(i, bias)  != 0.)
<a name="l01303"></a>01303                 {
<a name="l01304"></a>01304                     connectionMatrix(i, bias) = 1;
<a name="l01305"></a>01305                     numberOfWeights++;
<a name="l01306"></a>01306                 }
<a name="l01307"></a>01307                 <span class="keywordflow">else</span>
<a name="l01308"></a>01308                 {
<a name="l01309"></a>01309                     connectionMatrix(i, bias) = 0;
<a name="l01310"></a>01310                 }
<a name="l01311"></a>01311             }
<a name="l01312"></a>01312         }
<a name="l01313"></a>01313     }
<a name="l01314"></a>01314 
<a name="l01315"></a>01315     resize();
<a name="l01316"></a>01316     writeParameters();
<a name="l01317"></a>01317 }
<a name="l01318"></a>01318 
<a name="l01319"></a>01319 <span class="comment">//===========================================================================</span>
<a name="l01346"></a><a class="code" href="class_f_f_net.html#a2be2cf617ab5b9f3cb72f56e839235fc">01346</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a2be2cf617ab5b9f3cb72f56e839235fc" title="Reads the parameters (weight and bias values) from the weightMatrix and writes them to the parameter ...">FFNet::writeParameters</a>()
<a name="l01347"></a>01347 {
<a name="l01348"></a>01348     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; connectionMatrix.dim(0); <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l01349"></a>01349     {
<a name="l01350"></a>01350         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l01351"></a>01351         {
<a name="l01352"></a>01352             <span class="keywordflow">if</span> (connectionMatrix(i, j))
<a name="l01353"></a>01353             {
<a name="l01354"></a>01354                 parameter(k) = weight(i, j);
<a name="l01355"></a>01355                 k++;
<a name="l01356"></a>01356             }
<a name="l01357"></a>01357         }
<a name="l01358"></a>01358         <span class="keywordflow">if</span> (i &gt;= inputDimension)
<a name="l01359"></a>01359         {
<a name="l01360"></a>01360             <span class="keywordflow">if</span> (connectionMatrix(i, bias))
<a name="l01361"></a>01361             {
<a name="l01362"></a>01362                 parameter(k) = weight(i, bias);
<a name="l01363"></a>01363                 k++;
<a name="l01364"></a>01364             }
<a name="l01365"></a>01365         }
<a name="l01366"></a>01366     }
<a name="l01367"></a>01367 }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 <span class="comment">//===========================================================================</span>
<a name="l01395"></a><a class="code" href="class_f_f_net.html#a17620f14f1350f67f1eb62b74ac7c657">01395</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a17620f14f1350f67f1eb62b74ac7c657" title="Reads the parameters (weight and bias values) from the parameter vector ModelInterface::w and stores ...">FFNet::readParameters</a>()
<a name="l01396"></a>01396 {
<a name="l01397"></a>01397     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; connectionMatrix.dim(0); <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
<a name="l01398"></a>01398     {
<a name="l01399"></a>01399         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l01400"></a>01400         {
<a name="l01401"></a>01401             <span class="keywordflow">if</span> (connectionMatrix(i, j))
<a name="l01402"></a>01402             {
<a name="l01403"></a>01403                 weight(i, j) = parameter(k);
<a name="l01404"></a>01404                 k++;
<a name="l01405"></a>01405             }
<a name="l01406"></a>01406         }
<a name="l01407"></a>01407         <span class="keywordflow">if</span> (i &gt;= inputDimension)
<a name="l01408"></a>01408         {
<a name="l01409"></a>01409             <span class="keywordflow">if</span> (connectionMatrix(i, bias))
<a name="l01410"></a>01410             {
<a name="l01411"></a>01411                 weight(i, bias) = parameter(k);
<a name="l01412"></a>01412                 k++;
<a name="l01413"></a>01413             }
<a name="l01414"></a>01414         }
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417 
<a name="l01418"></a>01418 
<a name="l01419"></a>01419 <span class="comment">//===========================================================================</span>
<a name="l01439"></a><a class="code" href="class_f_f_net.html#a286706696122d4a040ce4544c39f9dcb">01439</a> <span class="comment"></span><span class="keyword">const</span> Array&lt; double &gt; &amp;<a class="code" href="class_f_f_net.html#a286706696122d4a040ce4544c39f9dcb" title="Returns the current weightMatrix.">FFNet::getWeights</a>()
<a name="l01440"></a>01440 {
<a name="l01441"></a>01441     readParameters();
<a name="l01442"></a>01442     <span class="keywordflow">return</span> weightMatrix;
<a name="l01443"></a>01443 }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 <span class="comment">//===========================================================================</span>
<a name="l01461"></a><a class="code" href="class_f_f_net.html#aba54cd428fed95aa02f232569cc9a476">01461</a> <span class="comment"></span><span class="keyword">const</span> Array&lt; int &gt; &amp;<a class="code" href="class_f_f_net.html#aba54cd428fed95aa02f232569cc9a476" title="Returns the current connectionMatrix.">FFNet::getConnections</a>()
<a name="l01462"></a>01462 {
<a name="l01463"></a>01463     <span class="keywordflow">return</span> connectionMatrix;
<a name="l01464"></a>01464 }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466 <span class="comment">//===========================================================================</span>
<a name="l01490"></a><a class="code" href="class_r_b_f_net.html#ab4a13fbbdcd50284c59fe6c84708dd3e">01490</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a378849ec2613ef085646200003f3ad0e" title="Writes the data of a network to an output stream.">FFNet::write</a>(ostream&amp; os)<span class="keyword"> const</span>
<a name="l01491"></a>01491 <span class="keyword"></span>{
<a name="l01492"></a>01492     os &lt;&lt; inputDimension &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; outputDimension &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01493"></a>01493     writeArray(connectionMatrix, os, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\n&quot;</span>, <span class="charliteral">&#39; &#39;</span>);
<a name="l01494"></a>01494     writeArray(weightMatrix, os, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\n&quot;</span>, <span class="charliteral">&#39; &#39;</span>);
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497 
<a name="l01498"></a>01498 <span class="comment">//===========================================================================</span>
<a name="l01525"></a><a class="code" href="class_r_b_f_net.html#a8a086aaf810025c0bd47d9e3b829f5af">01525</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a323874f4ba80d907fe07071c7d7d6fbd" title="Reads the data for the creation of a network from an input stream.">FFNet::read</a>(istream&amp; is)
<a name="l01526"></a>01526 {
<a name="l01527"></a>01527     <span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j, n, pos;
<a name="l01528"></a>01528     <span class="keywordtype">double</span> v, dn;
<a name="l01529"></a>01529     vector&lt;double&gt; l;
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     is &gt;&gt; inputDimension;
<a name="l01532"></a>01532     is &gt;&gt; outputDimension;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534     is &gt;&gt; v;
<a name="l01535"></a>01535     <span class="keywordflow">while</span> (is)
<a name="l01536"></a>01536     {
<a name="l01537"></a>01537         l.push_back(v);
<a name="l01538"></a>01538         is &gt;&gt; v;
<a name="l01539"></a>01539     }
<a name="l01540"></a>01540 
<a name="l01541"></a>01541     <span class="keywordflow">if</span> (!l.size())
<a name="l01542"></a>01542     {
<a name="l01543"></a>01543         stringstream s;
<a name="l01544"></a>01544         s &lt;&lt; <span class="stringliteral">&quot;no matrices given in net file&quot;</span>;
<a name="l01545"></a>01545         <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548     dn = (sqrt(1. + l.size() * 2.) - 1.) / 2.;
<a name="l01549"></a>01549     n = unsigned(dn);
<a name="l01550"></a>01550     <span class="keywordflow">if</span> (<span class="keywordtype">double</span>(n) == dn)
<a name="l01551"></a>01551     { <span class="comment">// new style with bias</span>
<a name="l01552"></a>01552         connectionMatrix.resize(n, n + 1, <span class="keyword">false</span>);
<a name="l01553"></a>01553         weightMatrix.resize(n, n + 1, <span class="keyword">false</span>);
<a name="l01554"></a>01554 
<a name="l01555"></a>01555         pos = 0;
<a name="l01556"></a>01556         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l01557"></a>01557         {
<a name="l01558"></a>01558             <span class="keywordflow">for</span> (j = 0; j &lt; n + 1; j++)
<a name="l01559"></a>01559             {
<a name="l01560"></a>01560                 connectionMatrix(i, j) = unsigned(l[pos]);
<a name="l01561"></a>01561                 pos++;
<a name="l01562"></a>01562             }
<a name="l01563"></a>01563         }
<a name="l01564"></a>01564 
<a name="l01565"></a>01565         <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l01566"></a>01566         {
<a name="l01567"></a>01567             <span class="keywordflow">for</span> (j = 0; j &lt; n + 1; j++)
<a name="l01568"></a>01568             {
<a name="l01569"></a>01569                 weightMatrix(i, j) = l[pos];
<a name="l01570"></a>01570                 pos++;
<a name="l01571"></a>01571             }
<a name="l01572"></a>01572         }
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574     <span class="keywordflow">else</span>
<a name="l01575"></a>01575     { <span class="comment">// old style without bias</span>
<a name="l01576"></a>01576         dn = (sqrt(1. + l.size() * 8.) - 1.) / 4.;
<a name="l01577"></a>01577         n =  unsigned(dn);
<a name="l01578"></a>01578         <span class="keywordflow">if</span> (<span class="keywordtype">double</span>(n) == dn)
<a name="l01579"></a>01579         {
<a name="l01580"></a>01580             connectionMatrix.resize(n, n + 1, <span class="keyword">false</span>);
<a name="l01581"></a>01581             weightMatrix.resize(n, n + 1, <span class="keyword">false</span>);
<a name="l01582"></a>01582 
<a name="l01583"></a>01583             pos = 0;
<a name="l01584"></a>01584             <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l01585"></a>01585             {
<a name="l01586"></a>01586                 <span class="keywordflow">for</span> (j = 0; j &lt; n; j++)
<a name="l01587"></a>01587                 {
<a name="l01588"></a>01588                     connectionMatrix(i, j) = unsigned(l[pos]);
<a name="l01589"></a>01589                     pos++;
<a name="l01590"></a>01590                 }
<a name="l01591"></a>01591                 <span class="comment">// handle bias</span>
<a name="l01592"></a>01592                 <span class="keywordflow">if</span> (i &gt;= inputDimension) connectionMatrix(i, n) = 1;
<a name="l01593"></a>01593                 <span class="keywordflow">else</span> connectionMatrix(i, n) = 0;
<a name="l01594"></a>01594             }
<a name="l01595"></a>01595             <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l01596"></a>01596             {
<a name="l01597"></a>01597                 <span class="keywordflow">for</span> (j = 0; j &lt; n + 1; j++)
<a name="l01598"></a>01598                 {
<a name="l01599"></a>01599                     weightMatrix(i, j) = l[pos];
<a name="l01600"></a>01600                     pos++;
<a name="l01601"></a>01601                 }
<a name="l01602"></a>01602             }
<a name="l01603"></a>01603         }
<a name="l01604"></a>01604         <span class="keywordflow">else</span>
<a name="l01605"></a>01605         { <span class="comment">// no style</span>
<a name="l01606"></a>01606             stringstream s;
<a name="l01607"></a>01607             s &lt;&lt; <span class="stringliteral">&quot;cannot parse network configuration file&quot;</span> &lt;&lt; endl;
<a name="l01608"></a>01608             <span class="keywordflow">throw</span> SHARKEXCEPTION(s.str().c_str());
<a name="l01609"></a>01609         }
<a name="l01610"></a>01610     }
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     resize();
<a name="l01613"></a>01613     writeParameters();
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 
<a name="l01617"></a><a class="code" href="class_f_f_net.html#aebbf2a1829f3abbf447d8d7d907dd400">01617</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#aebbf2a1829f3abbf447d8d7d907dd400" title="Auxiliary function for writeSource.">FFNet::replaceInString</a>(<span class="keyword">const</span> std::string &amp;str, std::string &amp;newString, <span class="keyword">const</span> std::string &amp;token, <span class="keyword">const</span> std::string &amp;newToken1, <span class="keywordtype">int</span> newToken2, <span class="keyword">const</span> std::string &amp;newToken3)
<a name="l01618"></a>01618 {
<a name="l01619"></a>01619     std::ostringstream buffer;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     buffer &lt;&lt; newToken2;
<a name="l01622"></a>01622     std::string newToken = newToken1 + buffer.str() + newToken3;
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     std::string::size_type pos;
<a name="l01625"></a>01625     newString = str;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     pos = newString.find(token, 0);
<a name="l01628"></a>01628     <span class="keywordflow">while</span> (pos != std::string::npos)
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630         newString.replace(pos, token.length(), newToken);
<a name="l01631"></a>01631         pos = newString.find(token, 0);
<a name="l01632"></a>01632     }
<a name="l01633"></a>01633 }
<a name="l01634"></a>01634 
<a name="l01635"></a><a class="code" href="class_f_f_net.html#a7783530ca0d61d73e6b0d77b0c0590c7">01635</a> <span class="keywordtype">void</span> <a class="code" href="class_f_f_net.html#a7783530ca0d61d73e6b0d77b0c0590c7" title="Writes the network to an outout stream as plain C code.">FFNet::writeSource</a>(std::ostream &amp;os, <span class="keyword">const</span> <span class="keywordtype">char</span> *g, <span class="keyword">const</span> <span class="keywordtype">char</span> *gOut, <span class="keywordtype">unsigned</span> p)
<a name="l01636"></a>01636 {
<a name="l01637"></a>01637     <span class="keywordtype">unsigned</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j;
<a name="l01638"></a>01638     <span class="keywordtype">bool</span> first;
<a name="l01639"></a>01639     std::string str;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641     os.precision(p);
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     os &lt;&lt; <span class="stringliteral">&quot;void model(double *in, double *out) {\n&quot;</span>;
<a name="l01644"></a>01644     <span class="keywordflow">for</span> (j = 0; j &lt; inputDimension; j++)
<a name="l01645"></a>01645         os &lt;&lt; <span class="stringliteral">&quot;  double z&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; = in[&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;];\n&quot;</span>;
<a name="l01646"></a>01646 
<a name="l01647"></a>01647     <span class="keywordflow">for</span> (i = inputDimension; i &lt; firstOutputNeuron; i++)
<a name="l01648"></a>01648     {
<a name="l01649"></a>01649         first = <span class="keyword">true</span>;
<a name="l01650"></a>01650         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l01651"></a>01651             <span class="keywordflow">if</span> (connectionMatrix(i, j))
<a name="l01652"></a>01652             {
<a name="l01653"></a>01653                 <span class="keywordflow">if</span> (first)
<a name="l01654"></a>01654                 {
<a name="l01655"></a>01655                     os &lt;&lt; <span class="stringliteral">&quot;  double z&quot;</span> &lt;&lt; i &lt;&lt;  <span class="stringliteral">&quot; = z&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; * &quot;</span> &lt;&lt; weightMatrix(i, j);
<a name="l01656"></a>01656                     first = <span class="keyword">false</span>;
<a name="l01657"></a>01657                 }
<a name="l01658"></a>01658                 <span class="keywordflow">else</span>
<a name="l01659"></a>01659                 {
<a name="l01660"></a>01660                     os &lt;&lt; <span class="stringliteral">&quot; + z&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; * &quot;</span> &lt;&lt; weightMatrix(i, j);
<a name="l01661"></a>01661                 }
<a name="l01662"></a>01662             }
<a name="l01663"></a>01663 
<a name="l01664"></a>01664         <span class="keywordflow">if</span>( connectionMatrix(i, bias) ) {
<a name="l01665"></a>01665             <span class="keywordflow">if</span> (first)
<a name="l01666"></a>01666             {
<a name="l01667"></a>01667                 os  &lt;&lt; <span class="stringliteral">&quot;double z&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; weightMatrix(i, bias); <span class="comment">// bias</span>
<a name="l01668"></a>01668                 first = <span class="keyword">false</span>;
<a name="l01669"></a>01669             }
<a name="l01670"></a>01670             <span class="keywordflow">else</span>
<a name="l01671"></a>01671             {
<a name="l01672"></a>01672                 os &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; weightMatrix(i, bias);
<a name="l01673"></a>01673             }
<a name="l01674"></a>01674         }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676         <span class="keywordflow">if</span> (!first)
<a name="l01677"></a>01677         {
<a name="l01678"></a>01678             os &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l01679"></a>01679             replaceInString(g, str, <span class="stringliteral">&quot;#&quot;</span>, <span class="stringliteral">&quot;z&quot;</span>, i, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01680"></a>01680             os &lt;&lt; <span class="stringliteral">&quot;  z&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; str &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l01681"></a>01681         }
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683     <span class="keywordflow">for</span> (i = firstOutputNeuron; i &lt; numberOfNeurons; i++)
<a name="l01684"></a>01684     {
<a name="l01685"></a>01685         first = <span class="keyword">true</span>;
<a name="l01686"></a>01686 
<a name="l01687"></a>01687         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; j++)
<a name="l01688"></a>01688             <span class="keywordflow">if</span> (connectionMatrix(i, j))
<a name="l01689"></a>01689             {
<a name="l01690"></a>01690                 <span class="keywordflow">if</span> (first)
<a name="l01691"></a>01691                 {
<a name="l01692"></a>01692                     os &lt;&lt; <span class="stringliteral">&quot;  out[&quot;</span> &lt;&lt; i - firstOutputNeuron &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span> &lt;&lt; <span class="stringliteral">&quot;z&quot;</span> &lt;&lt; j
<a name="l01693"></a>01693                     &lt;&lt; <span class="stringliteral">&quot; * &quot;</span> &lt;&lt; weightMatrix(i, j);
<a name="l01694"></a>01694                     first = <span class="keyword">false</span>;
<a name="l01695"></a>01695                 }
<a name="l01696"></a>01696                 <span class="keywordflow">else</span>
<a name="l01697"></a>01697                 {
<a name="l01698"></a>01698                     os &lt;&lt; <span class="stringliteral">&quot; + z&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; * &quot;</span> &lt;&lt; weightMatrix(i, j);
<a name="l01699"></a>01699                 }
<a name="l01700"></a>01700             }
<a name="l01701"></a>01701         <span class="keywordflow">if</span>( connectionMatrix(i, bias) ) {
<a name="l01702"></a>01702             <span class="keywordflow">if</span> (first)
<a name="l01703"></a>01703             {
<a name="l01704"></a>01704                 os &lt;&lt; <span class="stringliteral">&quot;  out[&quot;</span> &lt;&lt; i - firstOutputNeuron &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span>
<a name="l01705"></a>01705                 &lt;&lt; weightMatrix(i, bias); <span class="comment">// bias</span>
<a name="l01706"></a>01706                 first = <span class="keyword">false</span>;
<a name="l01707"></a>01707             }
<a name="l01708"></a>01708             <span class="keywordflow">else</span>
<a name="l01709"></a>01709             {
<a name="l01710"></a>01710                 os &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; weightMatrix(i, bias); <span class="comment">// bias</span>
<a name="l01711"></a>01711             }
<a name="l01712"></a>01712         }
<a name="l01713"></a>01713         
<a name="l01714"></a>01714         <span class="keywordflow">if</span> (!first)
<a name="l01715"></a>01715         {
<a name="l01716"></a>01716             os &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l01717"></a>01717             <span class="keywordflow">if</span>((strlen(gOut) != 1) || (*gOut != <span class="charliteral">&#39;#&#39;</span>)) { <span class="comment">// skip for linear output neurons</span>
<a name="l01718"></a>01718                 replaceInString(gOut, str, <span class="stringliteral">&quot;#&quot;</span>, <span class="stringliteral">&quot;out[&quot;</span>, i - firstOutputNeuron, <span class="stringliteral">&quot;]&quot;</span>);
<a name="l01719"></a>01719                 os &lt;&lt;  <span class="stringliteral">&quot;  out[&quot;</span> &lt;&lt; i - firstOutputNeuron &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span> &lt;&lt; str &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l01720"></a>01720             }
<a name="l01721"></a>01721         }
<a name="l01722"></a>01722     }
<a name="l01723"></a>01723     os &lt;&lt; <span class="stringliteral">&quot;};&quot;</span> &lt;&lt; std::endl;
<a name="l01724"></a>01724 }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726 
</pre></div></div>
</div>
</div>
</div>
</body></html>
