<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ReClaM: simpleMSERNNet.cpp</title>
<script type="text/javaScript" src="search/search.js"></script>
<link href="../css/main.css" rel="stylesheet" type="text/css"/>
</head>
<body id="type-b">

<div id="wrap">
<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
<div id="poweredby">
<img style="width: 95%;" src="../images/SharkLogo.png"/>
</div>		
  
<ul id="nav">
  <li class="first"><a href="../index.html">About Shark</a></li>
  <li><a href="#">Sourceforge</a>
  
  <ul>
    <li class="first"><a href="http://shark-project.sourceforge.net">Project Summary</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/files/">Downloads</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/develop">Subversion Repository</a></li>
  </ul>
  
</li>
<li class="first"><a href="../GettingStarted.html">Getting Started</a>
<li class="first"><a href="../Tutorials.html">Tutorials</a>
<li class="first"><a href="../FAQ.html">FAQ</a>

<li class="first"><a href="#">Main Modules</a>
<ul>
  <li class="first"><a href="../ReClaM/index.html">ReClaM</a>
  <li class="first"><a href="../EALib/index.html">EALib</a>
  <li class="first"><a href="../MOO-EALib/index.html">MOO-EALib</a>
  <li class="first"><a href="../Fuzzy/index.html">Fuzzy</a>
</ul>
</li>
<li class="first"><a href="#">Tools</a>
<ul>
  <li class="first"><a href="../Mixture/index.html">Mixture</a>
  <li><a href="../Array/index.html">Array</a>
  <li><a href="../Rng/index.html">Rng</a>
  <li><a href="../LinAlg/index.html">LinAlg</a>
  <li class="last"><a href="../FileUtil/index.html">FileUtil</a>		    
</ul>
</li>
</ul>
</div>

<!--<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
  <ul id="nav">
    <li><a href="../index.html"><span>Shark&nbsp;Main&nbsp;Page</span></a></li>
    <li><a href="../Array/index.html"><span>Array</span></a></li>
    <li><a href="../Rng/index.html"><span>Rng</span></a></li>
    <li><a href="../LinAlg/index.html"><span>LinAlg</span></a></li>
    <li><a href="../FileUtil/index.html"><span>FileUtil</span></a></li>
    <li><a href="../EALib/index.html"><span>EALib</span></a></li>
    <li><a href="../MOO-EALib/index.html"><span>MOO-EALib</span></a></li>
    <li class="active"><a href="../ReClaM/index.html"><span>ReClaM</span></a></li>
    <li><a href="../Fuzzy/index.html"><span>Fuzzy</span></a></li>
    <li><a href="../Mixture/index.html"><span>Mixture</span></a></li>
    <li><a href="../tutorials/index.html"><span>Tutorials</span></a></li>
    <li><a href="../faq/index.html"><span>FAQ</span></a></li>
  </ul>
 </div> -->
<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>simpleMSERNNet.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="comment">//===========================================================================</span>
<span class="comment"></span><span class="comment">//===========================================================================</span>

<span class="preprocessor">#include&lt;<a class="code" href="_m_s_e_r_n_net_8h.html" title="Offers the functions to create and to work with a recurrent neural network. The network is combined w...">ReClaM/MSERNNet.h</a>&gt;</span>
<span class="preprocessor">#include&lt;<a class="code" href="_rprop_8h.html" title="This file offers classes to use the Resilient-Backpropagation-algorithm for the optimization of the a...">ReClaM/Rprop.h</a>&gt;</span>
<span class="preprocessor">#include&lt;<a class="code" href="create_connection_matrix_8h.html" title="Offers methods for creating connection matrices for neural networks.">ReClaM/createConnectionMatrix.h</a>&gt;</span>
<span class="preprocessor">#include&lt;Array/ArrayIo.h&gt;</span>

<span class="keyword">using namespace </span>std;

<span class="comment">//===========================================================================</span>
<span class="comment">// define the regression model</span>

<span class="keyword">class </span>myNet: <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="class_m_s_e_r_n_net.html" title="A recurrent neural network regression model that learns with Back Propagation Through Time and assume...">MSERNNet</a>, <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="class_rprop_plus.html" title="This class offers methods for the usage of the Resilient-Backpropagation-algorithm with weight-backtr...">RpropPlus</a>
{
<span class="keyword">public</span>:
    myNet(): <a class="code" href="class_m_s_e_r_n_net.html" title="A recurrent neural network regression model that learns with Back Propagation Through Time and assume...">MSERNNet</a>()
    {
        Array &lt;int&gt; con;<span class="comment">//</span>
        <a name="a2"></a><a class="code" href="create_connection_matrix_8h.html#aa74e5dce6ced6460972eb0896b1abe82" title="Creates a connection matrix for a recurrent network.">createConnectionMatrixRNN</a>(con,1,8,1,2);
        setStructure(con);
        initWeights(-0.5, 0.5);
        init(*<span class="keyword">this</span>);
    };

<span class="comment">//   Array&lt;double&gt; &amp;Dedw(){ return dedw; }</span>
};


<span class="comment">//===========================================================================</span>
<span class="comment">// learn the Lorentz time series</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{

    <span class="comment">//===========================================================================</span>
    <span class="comment">// some parameters</span>

    <span class="keywordtype">unsigned</span> iterations = 1000;
    <span class="keyword">const</span> <span class="keywordtype">char</span>* datafile = <span class="stringliteral">&quot;timeseries&quot;</span>;
    <span class="keywordflow">if</span>(argc &gt;1) datafile = argv[1];
    
    <span class="keywordtype">unsigned</span> episode = 1000;
    <span class="keywordtype">int</span> forecast = 5;
    <span class="keywordtype">bool</span> checkGradient = <span class="keyword">false</span>;     <span class="comment">//if this is true, the gradient calculation is checked</span>

    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t = 0, <a name="a3"></a><a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
    ifstream infile;
    ofstream outfile;

    <span class="comment">//load the data</span>
    Array&lt;double&gt; data;
    infile.open(datafile);
    readArray(data, infile);
    infile.close();
    data /= 100.; data += .5; <span class="comment">//scale between [0,1] because all neurons of a RNN are sigmoid!</span>

    <span class="comment">//define the training and evaluation arrays</span>
    <span class="keywordtype">unsigned</span> dims[2] = {episode, 1};
    ArrayReference&lt;double&gt; trainIn(dims, &amp;data.elem(0)            , 2, episode);
    ArrayReference&lt;double&gt; trainTarget(dims, &amp;data.elem(0)   + forecast, 2, episode);
    ArrayReference&lt;double&gt; evalIn(dims, &amp;data.elem(1000)         , 2, episode);
    ArrayReference&lt;double&gt; evalTarget(dims, &amp;data.elem(1000) + forecast, 2, episode);
    Array&lt;double&gt; trainOut(episode, 1), evalOut(episode, 1);

    <span class="comment">//output the evaluation input/target arrays -- to compare them to evalOut</span>
    outfile.open(<span class="stringliteral">&quot;input&quot;</span>);
    writeArray(evalIn, outfile);
    outfile.close();
    outfile.open(<span class="stringliteral">&quot;target&quot;</span>);
    writeArray(evalTarget, outfile);
    outfile.close();

    <span class="comment">//create the network</span>
    myNet net;
    Array&lt;double&gt; exact, estimated;
    <span class="keywordtype">double</span> z;

    <span class="keywordflow">while</span> (t++ &lt; iterations)
    {
        cout &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;

        <span class="comment">//WARNING!!: for a unique error, warmupLength must be &gt;0</span>
        <span class="comment">// -- only then, the neuron states are reset to zero</span>
        <span class="comment">// in the model routine</span>
        net.includeWarmUp(100);

        <span class="comment">//check gradient on the training data</span>
        <span class="keywordflow">if</span> (checkGradient)
        {
            net.errorDerivative(net, trainIn, trainTarget, exact);
            cout &lt;&lt; <span class="stringliteral">&quot;derror - gradient:&quot;</span> &lt;&lt; exact;
            net.ErrorFunction::errorDerivative(net, trainIn, trainTarget, estimated);
            cout &lt;&lt; <span class="stringliteral">&quot;deltagrad - gradient:&quot;</span> &lt;&lt; estimated();
            <span class="keywordflow">for</span> (z = 0, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0;<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> &lt; exact.nelem();<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++)
            {
                exact(<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>) = exact(<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>) - estimated(<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>); z += exact(<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>) * exact(<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>);
            }
            cout &lt;&lt; <span class="stringliteral">&quot;difference:&quot;</span> &lt;&lt; exact;
            cout &lt;&lt; <span class="stringliteral">&quot;square-sum of difference: &quot;</span> &lt;&lt; z &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }

        <span class="comment">//learn on the training data</span>
        net.optimize(net, net, trainIn, trainTarget);

        <span class="comment">//evaluate on the evaluation data (compare files `output&#39; `input&#39; `target&#39;)</span>
        cout &lt;&lt; net.error(net, evalIn, evalTarget) &lt;&lt; endl;
        <span class="keywordflow">if</span> (!(t % 100))
        {
            net.model(evalIn, evalOut);
            outfile.open(<span class="stringliteral">&quot;output&quot;</span>);
            writeArray(evalOut, outfile);
            outfile.close();
        }
    }

    <span class="comment">// lines below are for self-testing this example, please ignore</span>
    <span class="keywordflow">if</span> (net.error(net, evalIn, evalTarget) &lt; 0.00135) exit(EXIT_SUCCESS);
    <span class="keywordflow">else</span> exit(EXIT_FAILURE);
}
</pre></div> </div>
</div>
</div>
</div>
</body></html>
