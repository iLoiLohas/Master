<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ReClaM: QpMcStzDecomp.cpp Source File</title>
<script type="text/javaScript" src="search/search.js"></script>
<link href="../css/main.css" rel="stylesheet" type="text/css"/>
</head>
<body id="type-b">

<div id="wrap">
<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
<div id="poweredby">
<img style="width: 95%;" src="../images/SharkLogo.png"/>
</div>		
  
<ul id="nav">
  <li class="first"><a href="../index.html">About Shark</a></li>
  <li><a href="#">Sourceforge</a>
  
  <ul>
    <li class="first"><a href="http://shark-project.sourceforge.net">Project Summary</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/files/">Downloads</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/develop">Subversion Repository</a></li>
  </ul>
  
</li>
<li class="first"><a href="../GettingStarted.html">Getting Started</a>
<li class="first"><a href="../Tutorials.html">Tutorials</a>
<li class="first"><a href="../FAQ.html">FAQ</a>

<li class="first"><a href="#">Main Modules</a>
<ul>
  <li class="first"><a href="../ReClaM/index.html">ReClaM</a>
  <li class="first"><a href="../EALib/index.html">EALib</a>
  <li class="first"><a href="../MOO-EALib/index.html">MOO-EALib</a>
  <li class="first"><a href="../Fuzzy/index.html">Fuzzy</a>
</ul>
</li>
<li class="first"><a href="#">Tools</a>
<ul>
  <li class="first"><a href="../Mixture/index.html">Mixture</a>
  <li><a href="../Array/index.html">Array</a>
  <li><a href="../Rng/index.html">Rng</a>
  <li><a href="../LinAlg/index.html">LinAlg</a>
  <li class="last"><a href="../FileUtil/index.html">FileUtil</a>		    
</ul>
</li>
</ul>
</div>

<!--<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
  <ul id="nav">
    <li><a href="../index.html"><span>Shark&nbsp;Main&nbsp;Page</span></a></li>
    <li><a href="../Array/index.html"><span>Array</span></a></li>
    <li><a href="../Rng/index.html"><span>Rng</span></a></li>
    <li><a href="../LinAlg/index.html"><span>LinAlg</span></a></li>
    <li><a href="../FileUtil/index.html"><span>FileUtil</span></a></li>
    <li><a href="../EALib/index.html"><span>EALib</span></a></li>
    <li><a href="../MOO-EALib/index.html"><span>MOO-EALib</span></a></li>
    <li class="active"><a href="../ReClaM/index.html"><span>ReClaM</span></a></li>
    <li><a href="../Fuzzy/index.html"><span>Fuzzy</span></a></li>
    <li><a href="../Mixture/index.html"><span>Mixture</span></a></li>
    <li><a href="../tutorials/index.html"><span>Tutorials</span></a></li>
    <li><a href="../faq/index.html"><span>FAQ</span></a></li>
  </ul>
 </div> -->
<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>QpMcStzDecomp.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_qp_mc_stz_decomp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//===========================================================================</span>
<a name="l00035"></a>00035 <span class="comment"></span><span class="comment">//===========================================================================</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;SharkDefs.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;Rng/GlobalRng.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;Array/ArrayIo.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;Array/ArrayOp.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;LinAlg/LinAlg.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;ReClaM/QuadraticProgram.h&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">using namespace </span>std;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">// useful exchange macros for Array&lt;T&gt; and std::vector&lt;T&gt;</span>
<a name="l00054"></a><a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">00054</a> <span class="preprocessor">#define XCHG_A(t, a, i, j) {t temp; temp = a(i); a(i) = a(j); a(j) = temp;}</span>
<a name="l00055"></a><a class="code" href="_qp_mc_stz_decomp_8cpp.html#a9f231c20de6ca030ddb93f78fe960503">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define XCHG_V(t, a, i, j) {t temp; temp = a[i]; a[i] = a[j]; a[j] = temp;}</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="class_qp_mc_stz_decomp.html#a240c23062f09d05667673dbd5b8f6e6f">00061</a> <a class="code" href="class_qp_mc_stz_decomp.html#a240c23062f09d05667673dbd5b8f6e6f" title="Constructor.">QpMcStzDecomp::QpMcStzDecomp</a>(<a class="code" href="class_cached_matrix.html" title="Efficient quadratic matrix cache.">CachedMatrix</a>&amp; kernel)
<a name="l00062"></a>00062 : kernelMatrix(kernel)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064     <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a> = <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_q_p_matrix.html#ae8b50d982345b3dffa6a4cbfb362e5a3" title="return the size of the quadratic matrix">getMatrixSize</a>();
<a name="l00065"></a>00065     <a class="code" href="class_qp_mc_stz_decomp.html#a66ea1cba27c6d8e2c060108611e9369b" title="maximum number of iterations">maxIter</a> = -1;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="class_qp_mc_stz_decomp.html#a607efc758ad77661b3f371c033cc7b64">00068</a> <a class="code" href="class_qp_mc_stz_decomp.html#a607efc758ad77661b3f371c033cc7b64" title="Destructor.">QpMcStzDecomp::~QpMcStzDecomp</a>()
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="class_qp_mc_stz_decomp.html#a0b369ae1b702a3e85b04d810b38c56e3">00073</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_mc_stz_decomp.html#a0b369ae1b702a3e85b04d810b38c56e3" title="solve the quadratic program">QpMcStzDecomp::Solve</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> classes,
<a name="l00074"></a>00074                         <span class="keyword">const</span> <span class="keywordtype">double</span>* modifiers,
<a name="l00075"></a>00075                         <span class="keyword">const</span> Array&lt;double&gt;&amp; target,
<a name="l00076"></a>00076                         <span class="keyword">const</span> Array&lt;double&gt;&amp; linearPart,
<a name="l00077"></a>00077                         <span class="keyword">const</span> Array&lt;double&gt;&amp; lower,
<a name="l00078"></a>00078                         <span class="keyword">const</span> Array&lt;double&gt;&amp; upper,
<a name="l00079"></a>00079                         Array&lt;double&gt;&amp; solutionVector,
<a name="l00080"></a>00080                         <span class="keywordtype">double</span> eps)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082     SIZE_CHECK(target.ndim() == 2);
<a name="l00083"></a>00083     SIZE_CHECK(linearPart.ndim() == 1);
<a name="l00084"></a>00084     SIZE_CHECK(lower.ndim() == 1);
<a name="l00085"></a>00085     SIZE_CHECK(upper.ndim() == 1);
<a name="l00086"></a>00086     SIZE_CHECK(solutionVector.ndim() == 1);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     this-&gt;classes = <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00089"></a>00089     <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a> = <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a> * <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00090"></a>00090     memcpy(<a class="code" href="class_qp_mc_stz_decomp.html#a87a76edc1782785fb084fe9d96354524" title="kernel modifiers under six binary conditions">m_modifier</a>, modifiers, <span class="keyword">sizeof</span>(<a class="code" href="class_qp_mc_stz_decomp.html#a87a76edc1782785fb084fe9d96354524" title="kernel modifiers under six binary conditions">m_modifier</a>));
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     SIZE_CHECK(target.dim(0) == <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>);
<a name="l00093"></a>00093     SIZE_CHECK(target.dim(1) == 1);
<a name="l00094"></a>00094     SIZE_CHECK(linearPart.dim(0) == <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00095"></a>00095     SIZE_CHECK(lower.dim(0) == <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00096"></a>00096     SIZE_CHECK(upper.dim(0) == <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00097"></a>00097     SIZE_CHECK(solutionVector.dim(0) == <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a, b, bc, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j;
<a name="l00100"></a>00100     <span class="keywordtype">float</span>* q = NULL;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment">// prepare lists</span>
<a name="l00103"></a>00103     <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>, <span class="keyword">false</span>);
<a name="l00104"></a>00104     <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>, <span class="keyword">false</span>);
<a name="l00105"></a>00105     <a class="code" href="class_qp_mc_stz_decomp.html#a00317ce2c17a7929e59da44c98d0e1c1" title="linear part of the objective function">linear</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>, <span class="keyword">false</span>);
<a name="l00106"></a>00106     <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>, <span class="keyword">false</span>);
<a name="l00107"></a>00107     <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>, <span class="keyword">false</span>);
<a name="l00108"></a>00108     <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>);
<a name="l00109"></a>00109     <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00110"></a>00110     <a class="code" href="class_qp_mc_stz_decomp.html#a895a88ddbc328be5559d7fbf5591d019" title="space for the example[i].variables pointers">storage</a>.resize(<a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">// prepare list contents</span>
<a name="l00113"></a>00113     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>; i++)
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].index = <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
<a name="l00116"></a>00116         <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label = (<span class="keywordtype">unsigned</span> int)target(i, 0);
<a name="l00117"></a>00117         <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].active = <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00118"></a>00118         <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].variables = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a895a88ddbc328be5559d7fbf5591d019" title="space for the example[i].variables pointers">storage</a>[classes * <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00119"></a>00119         <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].diagonal = <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a963f1b6b4ce8c3eaecfa01d00d613fd8" title="overriden virtual function">Entry</a>(i, i);
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; i++)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e = i / <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00124"></a>00124         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[e].label;
<a name="l00125"></a>00125         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = i % <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00126"></a>00126         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].example = e;
<a name="l00127"></a>00127         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].index = v;
<a name="l00128"></a>00128         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label = v;
<a name="l00129"></a>00129         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].diagonal = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(y, y, v, v) * <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a963f1b6b4ce8c3eaecfa01d00d613fd8" title="overriden virtual function">Entry</a>(e, e);
<a name="l00130"></a>00130         <a class="code" href="class_qp_mc_stz_decomp.html#a895a88ddbc328be5559d7fbf5591d019" title="space for the example[i].variables pointers">storage</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>] = <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// prepare the solver internal variables</span>
<a name="l00134"></a>00134     <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a> = lower;
<a name="l00135"></a>00135     <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a> = upper;
<a name="l00136"></a>00136     <a class="code" href="class_qp_mc_stz_decomp.html#a00317ce2c17a7929e59da44c98d0e1c1" title="linear part of the objective function">linear</a> = linearPart;
<a name="l00137"></a>00137     <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a> = linearPart;
<a name="l00138"></a>00138     <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a> = solutionVector;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <a class="code" href="class_qp_mc_stz_decomp.html#a9f8ab1d07b358601f85e0d7920b91633" title="stopping condition - solution accuracy">epsilon</a> = eps;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a> = <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>;
<a name="l00143"></a>00143     <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> = <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e = 0xffffffff;
<a name="l00146"></a>00146     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; i++)
<a name="l00147"></a>00147     {
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(i) &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(i)) <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpMcStzDecomp::Solve] The feasible region is empty.&quot;</span>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <span class="keywordtype">double</span> v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i);
<a name="l00151"></a>00151         <span class="keywordflow">if</span> (v != 0.0)
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ei = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].example;
<a name="l00154"></a>00154             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label;
<a name="l00155"></a>00155             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yi = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[ei].label;
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (ei != e)
<a name="l00157"></a>00157             {
<a name="l00158"></a>00158                 q = <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(ei, 0, <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>);
<a name="l00159"></a>00159                 e = ei;
<a name="l00160"></a>00160             }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>; a++)
<a name="l00163"></a>00163             {
<a name="l00164"></a>00164                 <span class="keywordtype">double</span> k = q[a];
<a name="l00165"></a>00165                 <a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>* ex = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[a];
<a name="l00166"></a>00166                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yj = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a236d438136792c3990557bab59ade852">label</a>;
<a name="l00167"></a>00167                 bc = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#accac782a1cf940345fb6252f80a2d52a">active</a>;
<a name="l00168"></a>00168                 <span class="keywordflow">for</span> (b = 0; b &lt; bc; b++)
<a name="l00169"></a>00169                 {
<a name="l00170"></a>00170                     j = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[b];
<a name="l00171"></a>00171                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vj = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].label;
<a name="l00172"></a>00172                     <span class="keywordtype">double</span> km = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(yi, yj, vi, vj);
<a name="l00173"></a>00173                     <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(j) -= v * km * k;
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175             }
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <a class="code" href="class_qp_mc_stz_decomp.html#a8b05ba8118f8b75ff334d297a44cf195" title="true if the problem has already been unshrinked">bUnshrinked</a> = <span class="keyword">false</span>;
<a name="l00180"></a>00180     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shrinkCounter = (<a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> &lt; 1000) ? <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> : 1000;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="comment">// initial shrinking (useful for dummy variables and warm starts)</span>
<a name="l00183"></a>00183     <a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b" title="Shrink the problem.">Shrink</a>();
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="comment">// decomposition loop</span>
<a name="l00186"></a>00186     <a class="code" href="class_qp_mc_stz_decomp.html#aa021436da629d7a24fefdb8449c6c9c1" title="solution statistics: number of iterations">iter</a> = 0;
<a name="l00187"></a>00187     <a class="code" href="class_qp_mc_stz_decomp.html#ae7b2c82ca5d97e1139364e1a49e0debb" title="is the solution found (near) optimal or has the solver stopped due to an interation or time constrain...">optimal</a> = <span class="keyword">false</span>;
<a name="l00188"></a>00188     <span class="keywordflow">while</span> (<a class="code" href="class_qp_mc_stz_decomp.html#aa021436da629d7a24fefdb8449c6c9c1" title="solution statistics: number of iterations">iter</a> != <a class="code" href="class_qp_mc_stz_decomp.html#a66ea1cba27c6d8e2c060108611e9369b" title="maximum number of iterations">maxIter</a>)
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190         <span class="comment">// select a working set and check for optimality</span>
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#ab4232e7735482de382e818ed8a11330f" title="select optimization directions i and j">SelectWorkingSet</a>(i, j))
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193             <span class="comment">// seems to be optimal</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195             <span class="comment">// do costly unshrinking</span>
<a name="l00196"></a>00196             <a class="code" href="class_qp_mc_stz_decomp.html#a53a2a3b18132d632035d8a4f7091205d" title="Active all variables.">Unshrink</a>(<span class="keyword">true</span>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198             <span class="comment">// check again on the whole problem</span>
<a name="l00199"></a>00199             <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#ab4232e7735482de382e818ed8a11330f" title="select optimization directions i and j">SelectWorkingSet</a>(i, j))
<a name="l00200"></a>00200             {
<a name="l00201"></a>00201                 <a class="code" href="class_qp_mc_stz_decomp.html#ae7b2c82ca5d97e1139364e1a49e0debb" title="is the solution found (near) optimal or has the solver stopped due to an interation or time constrain...">optimal</a> = <span class="keyword">true</span>;
<a name="l00202"></a>00202                 <span class="keywordflow">break</span>;
<a name="l00203"></a>00203             }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205             <span class="comment">// shrink again</span>
<a name="l00206"></a>00206             <a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b" title="Shrink the problem.">Shrink</a>();
<a name="l00207"></a>00207             shrinkCounter = (<a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> &lt; 1000) ? <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> : 1000;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209             <a class="code" href="class_qp_mc_stz_decomp.html#ab4232e7735482de382e818ed8a11330f" title="select optimization directions i and j">SelectWorkingSet</a>(i, j);
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="comment">// update</span>
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214             <span class="keywordtype">double</span> ai = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i);
<a name="l00215"></a>00215             <span class="keywordtype">double</span> aj = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(j);
<a name="l00216"></a>00216 <span class="comment">//          double Li = boxMin(i);</span>
<a name="l00217"></a>00217             <span class="keywordtype">double</span> Lj = <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(j);
<a name="l00218"></a>00218             <span class="keywordtype">double</span> Ui = <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(i);
<a name="l00219"></a>00219 <span class="comment">//          double Uj = boxMax(j);</span>
<a name="l00220"></a>00220             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> eij = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].example;
<a name="l00221"></a>00221             ASSERT(<a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a> == eij);
<a name="l00222"></a>00222             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label;
<a name="l00223"></a>00223             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vj = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].label;
<a name="l00224"></a>00224             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yij = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[eij].label;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226             <span class="comment">// get the matrix row corresponding to the working set</span>
<a name="l00227"></a>00227             q = <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(eij, 0, <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             <span class="comment">// update alpha, that is, solve the sub-problem defined by i and j</span>
<a name="l00230"></a>00230             <span class="keywordtype">double</span> numerator = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(i) - <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(j);
<a name="l00231"></a>00231             <span class="keywordtype">double</span> denominator = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].diagonal + <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].diagonal
<a name="l00232"></a>00232                     - 2.0 * <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(yij, yij, vi, vj) * q[eij];
<a name="l00233"></a>00233             <span class="keywordtype">double</span> mu = numerator / denominator;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235             <span class="keywordtype">bool</span> i_at_bound = <span class="keyword">false</span>;
<a name="l00236"></a>00236             <span class="keywordtype">bool</span> j_at_bound = <span class="keyword">false</span>;
<a name="l00237"></a>00237             <span class="keywordflow">if</span> (ai + mu &gt; Ui) { i_at_bound = <span class="keyword">true</span>; mu = Ui - ai; }
<a name="l00238"></a>00238             <span class="keywordflow">if</span> (aj - mu &lt; Lj) { j_at_bound = <span class="keyword">true</span>; mu = aj - Lj; }
<a name="l00239"></a>00239             <span class="keywordflow">if</span> (i_at_bound) <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i) = Ui; <span class="keywordflow">else</span> <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i) += mu;
<a name="l00240"></a>00240             <span class="keywordflow">if</span> (j_at_bound) <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(j) = Lj; <span class="keywordflow">else</span> <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(j) -= mu;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242             <span class="comment">// update the gradient</span>
<a name="l00243"></a>00243             <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>; a++)
<a name="l00244"></a>00244             {
<a name="l00245"></a>00245                 <span class="keywordtype">double</span> k = q[a];
<a name="l00246"></a>00246                 <a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>* ex = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[a];
<a name="l00247"></a>00247                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yc = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a236d438136792c3990557bab59ade852">label</a>;
<a name="l00248"></a>00248                 bc = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#accac782a1cf940345fb6252f80a2d52a">active</a>;
<a name="l00249"></a>00249                 <span class="keywordflow">for</span> (b = 0; b &lt; bc; b++)
<a name="l00250"></a>00250                 {
<a name="l00251"></a>00251                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[b];
<a name="l00252"></a>00252                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vc = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[c].label;
<a name="l00253"></a>00253                     <span class="keywordtype">double</span> km_i = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(yij, yc, vi, vc);
<a name="l00254"></a>00254                     <span class="keywordtype">double</span> km_j = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(yij, yc, vj, vc);
<a name="l00255"></a>00255                     <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(c) -= mu * (km_i - km_j) * k;
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257             }
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         shrinkCounter--;
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (shrinkCounter == 0)
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263             <span class="comment">// shrink the problem</span>
<a name="l00264"></a>00264             <a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b" title="Shrink the problem.">Shrink</a>();
<a name="l00265"></a>00265 
<a name="l00266"></a>00266             shrinkCounter = (<a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> &lt; 1000) ? <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> : 1000;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <a class="code" href="class_qp_mc_stz_decomp.html#aa021436da629d7a24fefdb8449c6c9c1" title="solution statistics: number of iterations">iter</a>++;
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#aa021436da629d7a24fefdb8449c6c9c1" title="solution statistics: number of iterations">iter</a> == <a class="code" href="class_qp_mc_stz_decomp.html#a66ea1cba27c6d8e2c060108611e9369b" title="maximum number of iterations">maxIter</a>) <a class="code" href="class_qp_mc_stz_decomp.html#ae7b2c82ca5d97e1139364e1a49e0debb" title="is the solution found (near) optimal or has the solver stopped due to an interation or time constrain...">optimal</a> = <span class="keyword">false</span>;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="comment">// return alpha</span>
<a name="l00275"></a>00275     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; i++)
<a name="l00276"></a>00276     {
<a name="l00277"></a>00277         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = classes * <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[<a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].example].index + <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label;
<a name="l00278"></a>00278         solutionVector(j) = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i);
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="class_qp_mc_stz_decomp.html#ab4232e7735482de382e818ed8a11330f">00282</a> <span class="keywordtype">bool</span> <a class="code" href="class_qp_mc_stz_decomp.html#ab4232e7735482de382e818ed8a11330f" title="select optimization directions i and j">QpMcStzDecomp::SelectWorkingSet</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; j)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e;
<a name="l00285"></a>00285     <span class="keywordtype">double</span> worst_gap = 0.0;
<a name="l00286"></a>00286     <span class="keywordtype">double</span> best_gain = 0.0;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="comment">// loop over the examples, defining groups of variables</span>
<a name="l00289"></a>00289     <span class="comment">// among which we do second-order working set selection</span>
<a name="l00290"></a>00290     <span class="keywordflow">for</span> (e=0; e&lt;<a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>; e++)
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292         <a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>* ex = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[e];
<a name="l00293"></a>00293         <span class="keywordtype">double</span> k = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a5674726e8f019c19feac3b082c692c02">diagonal</a>;
<a name="l00294"></a>00294         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a236d438136792c3990557bab59ade852">label</a>;
<a name="l00295"></a>00295         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b, bc = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#accac782a1cf940345fb6252f80a2d52a">active</a>;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="comment">// select first variable according to maximal gradient</span>
<a name="l00298"></a>00298         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0x7fffffff;
<a name="l00299"></a>00299         <span class="keywordtype">double</span> l_u = -1e100;
<a name="l00300"></a>00300         <span class="keywordtype">double</span> l_d = 1e100;
<a name="l00301"></a>00301         <span class="keywordflow">for</span> (b=0; b&lt;bc; b++)
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[b];
<a name="l00304"></a>00304             <span class="keywordtype">double</span> v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(c);
<a name="l00305"></a>00305             <span class="keywordtype">double</span> g = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(c);
<a name="l00306"></a>00306             <span class="keywordflow">if</span> (v &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(c))
<a name="l00307"></a>00307             {
<a name="l00308"></a>00308                 <span class="keywordflow">if</span> (g &gt; l_u)
<a name="l00309"></a>00309                 {
<a name="l00310"></a>00310                     l_u = g;
<a name="l00311"></a>00311                     ii = c;
<a name="l00312"></a>00312                 }
<a name="l00313"></a>00313             }
<a name="l00314"></a>00314             <span class="keywordflow">if</span> (v &gt; <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(c))
<a name="l00315"></a>00315             {
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> (g &lt; l_d)
<a name="l00317"></a>00317                 {
<a name="l00318"></a>00318                     l_d = g;
<a name="l00319"></a>00319                     ii = c;
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321             }
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323         <span class="keywordflow">if</span> (ii == 0x7fffffff) <span class="keywordflow">continue</span>;
<a name="l00324"></a>00324         <span class="keywordtype">double</span> gap = l_u - l_d;
<a name="l00325"></a>00325         <span class="keywordflow">if</span> (gap &gt; worst_gap) worst_gap = gap;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         <span class="comment">// select second variable according to maximal unconstrained gain</span>
<a name="l00328"></a>00328         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[ii].label;
<a name="l00329"></a>00329         <span class="keywordtype">double</span> aii = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(ii);
<a name="l00330"></a>00330         <span class="keywordtype">double</span> gii = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(ii);
<a name="l00331"></a>00331         <span class="keywordtype">double</span> mii = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(y, y, vi, vi);
<a name="l00332"></a>00332         <span class="keywordflow">for</span> (b=0; b&lt;bc; b++)
<a name="l00333"></a>00333         {
<a name="l00334"></a>00334             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = ex-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[b];
<a name="l00335"></a>00335             <span class="keywordflow">if</span> (c == ii) <span class="keywordflow">continue</span>;
<a name="l00336"></a>00336             <span class="keywordtype">double</span> v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(c);
<a name="l00337"></a>00337             <span class="keywordtype">double</span> g = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(c);
<a name="l00338"></a>00338             <span class="keywordtype">double</span> numerator = gii - g;
<a name="l00339"></a>00339             <span class="keywordflow">if</span> (numerator == 0.0) <span class="keywordflow">continue</span>;
<a name="l00340"></a>00340             <span class="keywordflow">if</span> (numerator &gt; 0.0 &amp;&amp; (aii == <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(ii) || v == <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(c))) <span class="keywordflow">continue</span>;
<a name="l00341"></a>00341             <span class="keywordflow">if</span> (numerator &lt; 0.0 &amp;&amp; (aii == <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(ii) || v == <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(c))) <span class="keywordflow">continue</span>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vc = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[c].label;
<a name="l00344"></a>00344             <span class="keywordtype">double</span> denominator = (mii + <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(y, y, vc, vc) - 2.0 * <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(y, y, vi, vc)) * k;
<a name="l00345"></a>00345             <span class="keywordtype">double</span> gain = numerator * numerator / denominator;
<a name="l00346"></a>00346             <span class="keywordflow">if</span> (gain &gt; best_gain)
<a name="l00347"></a>00347             {
<a name="l00348"></a>00348                 i = ii;
<a name="l00349"></a>00349                 j = c;
<a name="l00350"></a>00350                 best_gain = gain;
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(i) &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(j)) std::swap(i, j);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">// return KKT stopping condition</span>
<a name="l00358"></a>00358     <span class="keywordflow">return</span> (worst_gap &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a9f8ab1d07b358601f85e0d7920b91633" title="stopping condition - solution accuracy">epsilon</a>);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b">00361</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b" title="Shrink the problem.">QpMcStzDecomp::Shrink</a>()
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <span class="keywordtype">int</span> a, e;
<a name="l00364"></a>00364     <span class="keywordtype">double</span> v, g;
<a name="l00365"></a>00365     std::vector&lt;double&gt; largest_up(<a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>);
<a name="l00366"></a>00366     std::vector&lt;double&gt; largest_down(<a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>);
<a name="l00367"></a>00367     <span class="keywordtype">double</span> l_up = -1e100;
<a name="l00368"></a>00368     <span class="keywordtype">double</span> l_down = 1e100;
<a name="l00369"></a>00369     <span class="keywordflow">for</span> (e=0; e&lt;(int)<a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>; e++)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         largest_up[e] = -1e100;
<a name="l00372"></a>00372         largest_down[e] = 1e100;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">for</span> (a = 0; a &lt; (int)<a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a>; a++)
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377         e = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[a].example;
<a name="l00378"></a>00378         <span class="keywordtype">double</span> v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(a);
<a name="l00379"></a>00379         <span class="keywordtype">double</span> g = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(a);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (v &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(a))
<a name="l00382"></a>00382         {
<a name="l00383"></a>00383             <span class="keywordflow">if</span> (g &gt; largest_up[e])
<a name="l00384"></a>00384             {
<a name="l00385"></a>00385                 largest_up[e] = g;
<a name="l00386"></a>00386                 <span class="keywordflow">if</span> (g &gt; l_up) l_up = g;
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (v &gt; <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(a))
<a name="l00390"></a>00390         {
<a name="l00391"></a>00391             <span class="keywordflow">if</span> (g &lt; largest_down[e])
<a name="l00392"></a>00392             {
<a name="l00393"></a>00393                 largest_down[e] = g;
<a name="l00394"></a>00394                 <span class="keywordflow">if</span> (g &lt; l_down) l_down = g;
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (! <a class="code" href="class_qp_mc_stz_decomp.html#a8b05ba8118f8b75ff334d297a44cf195" title="true if the problem has already been unshrinked">bUnshrinked</a>)
<a name="l00400"></a>00400     {
<a name="l00401"></a>00401         <span class="keywordflow">if</span> (l_up - l_down &lt; 10.0 * <a class="code" href="class_qp_mc_stz_decomp.html#a9f8ab1d07b358601f85e0d7920b91633" title="stopping condition - solution accuracy">epsilon</a>)
<a name="l00402"></a>00402         {
<a name="l00403"></a>00403             <span class="comment">// unshrink the problem at this accuracy level</span>
<a name="l00404"></a>00404             <a class="code" href="class_qp_mc_stz_decomp.html#a53a2a3b18132d632035d8a4f7091205d" title="Active all variables.">Unshrink</a>(<span class="keyword">false</span>);
<a name="l00405"></a>00405             <a class="code" href="class_qp_mc_stz_decomp.html#a8b05ba8118f8b75ff334d297a44cf195" title="true if the problem has already been unshrinked">bUnshrinked</a> = <span class="keyword">true</span>;
<a name="l00406"></a>00406             <span class="keywordflow">return</span>;
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="comment">// shrink variables</span>
<a name="l00411"></a>00411     <span class="keywordtype">bool</span> se = <span class="keyword">false</span>;
<a name="l00412"></a>00412     <span class="keywordflow">for</span> (a = <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> - 1; a &gt;= 0; a--)
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(a);
<a name="l00415"></a>00415         g = <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(a);
<a name="l00416"></a>00416         e = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[a].example;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="keywordflow">if</span> ((v == <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>(a) &amp;&amp; g &lt;= largest_down[e]) || (v == <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>(a) &amp;&amp; g &gt;= largest_up[e]))
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420             <span class="comment">// In this moment no feasible step including this variable</span>
<a name="l00421"></a>00421             <span class="comment">// can improve the objective. Thus deactivate the variable.</span>
<a name="l00422"></a>00422             <a class="code" href="class_qp_mc_stz_decomp.html#afc95b32935ce3ba5b65966cc68869714" title="shrink a variable">DeactivateVariable</a>(a);
<a name="l00423"></a>00423             <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[e].active == 0) se = <span class="keyword">true</span>;
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (se)
<a name="l00428"></a>00428     {
<a name="l00429"></a>00429         <span class="comment">// exchange examples such that shrinked examples</span>
<a name="l00430"></a>00430         <span class="comment">// are moved to the ends of the lists</span>
<a name="l00431"></a>00431         <span class="keywordflow">for</span> (e = <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a> - 1; e &gt;= 0; e--)
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433             <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[e].active == 0) <a class="code" href="class_qp_mc_stz_decomp.html#a6722a4792ace01f542b506a5f439252c" title="shrink an examples">DeactivateExample</a>(e);
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="comment">// shrink the corresponding cache entries</span>
<a name="l00437"></a>00437         <span class="keywordflow">for</span> (e = 0; e &lt; (int)<a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>; e++)
<a name="l00438"></a>00438         {
<a name="l00439"></a>00439             <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a67586c601fa24798d44e84d72537d339">getCacheRowSize</a>(e) &gt; <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>) <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#acf27a56098c46b240d519701e92580c5">CacheRowResize</a>(e, <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="class_qp_mc_stz_decomp.html#a53a2a3b18132d632035d8a4f7091205d">00444</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_mc_stz_decomp.html#a53a2a3b18132d632035d8a4f7091205d" title="Active all variables.">QpMcStzDecomp::Unshrink</a>(<span class="keywordtype">bool</span> complete)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (<a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> == <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>) <span class="keywordflow">return</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, a;
<a name="l00449"></a>00449     <span class="keywordtype">float</span>* q;
<a name="l00450"></a>00450     <span class="keywordtype">double</span> v;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <span class="comment">// compute the inactive gradient components (quadratic time complexity)</span>
<a name="l00453"></a>00453     <span class="keywordflow">for</span> (a = <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a>; a &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; a++) <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(a) = <a class="code" href="class_qp_mc_stz_decomp.html#a00317ce2c17a7929e59da44c98d0e1c1" title="linear part of the objective function">linear</a>(a);
<a name="l00454"></a>00454     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; i++)
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         v = <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>(i);
<a name="l00457"></a>00457         <span class="keywordflow">if</span> (v == 0.0) <span class="keywordflow">continue</span>;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ei = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].example;
<a name="l00460"></a>00460         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vi = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>].label;
<a name="l00461"></a>00461         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yi = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[ei].label;
<a name="l00462"></a>00462         q = <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(ei, 0, <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>, <span class="keyword">true</span>);
<a name="l00463"></a>00463         <span class="keywordflow">for</span> (a = <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a>; a &lt; <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>; a++)
<a name="l00464"></a>00464         {
<a name="l00465"></a>00465             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ea = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[a].example;
<a name="l00466"></a>00466             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> va = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[a].label;
<a name="l00467"></a>00467             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ya = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[ea].label;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469             <span class="keywordtype">double</span> km = <a class="code" href="class_qp_mc_stz_decomp.html#a689d6cfc829c91ea0cd31e7fcfc4d762" title="Return the &amp;#39;kernel modifier&amp;#39; which is used to compute the Q-matrix from the kernel matrix...">Modifier</a>(yi, ya, vi, va);
<a name="l00470"></a>00470             <span class="keywordtype">double</span> k = q[ea];
<a name="l00471"></a>00471             <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>(a) -= km * k * v;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>; i++) <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[i].active = <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>;
<a name="l00476"></a>00476     <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a> = <a class="code" href="class_qp_mc_stz_decomp.html#ad430738435e3093f0e37aee2d24c705f" title="number of examples in the problem (size of the kernel matrix)">examples</a>;
<a name="l00477"></a>00477     <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> = <a class="code" href="class_qp_mc_stz_decomp.html#a6fa9ee292229f76e663394b416810ef3" title="number of variables in the problem = examples times classes">variables</a>;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="keywordflow">if</span> (! complete) <a class="code" href="class_qp_mc_stz_decomp.html#ad0a75de05e09d4a109f48a5c6f90c44b" title="Shrink the problem.">Shrink</a>();
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="class_qp_mc_stz_decomp.html#afc95b32935ce3ba5b65966cc68869714">00482</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_mc_stz_decomp.html#afc95b32935ce3ba5b65966cc68869714" title="shrink a variable">QpMcStzDecomp::DeactivateVariable</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ev = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[v].example;
<a name="l00485"></a>00485     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iv = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[v].index;
<a name="l00486"></a>00486     <a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>* exv = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[ev];
<a name="l00487"></a>00487     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ih = exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#accac782a1cf940345fb6252f80a2d52a">active</a> - 1;
<a name="l00488"></a>00488     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h = exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[ih];
<a name="l00489"></a>00489     <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[v].index = ih;
<a name="l00490"></a>00490     <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[h].index = iv;
<a name="l00491"></a>00491     std::swap(exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[iv], exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[ih]);
<a name="l00492"></a>00492     iv = ih;
<a name="l00493"></a>00493     exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#accac782a1cf940345fb6252f80a2d52a">active</a>--;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a> - 1;
<a name="l00496"></a>00496     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ej = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].example;
<a name="l00497"></a>00497     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ij = <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[j].index;
<a name="l00498"></a>00498     <a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>* exj = &amp;<a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[ej];
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">// exchange entries in the lists</span>
<a name="l00501"></a>00501     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_mc_stz_decomp.html#a305b4156f214bdde6574da04360ed737" title="box constraint lower bound, that is, minimal variable value">boxMin</a>, v, j);
<a name="l00502"></a>00502     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_mc_stz_decomp.html#a75f597bf0b5483a9676fee220d565196" title="box constraint upper bound, that is, maximal variable value">boxMax</a>, v, j);
<a name="l00503"></a>00503     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_mc_stz_decomp.html#a00317ce2c17a7929e59da44c98d0e1c1" title="linear part of the objective function">linear</a>, v, j);
<a name="l00504"></a>00504     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_mc_stz_decomp.html#a31ec91588021b5fd85bcd22f51d6cdcb" title="Solution candidate.">alpha</a>, v, j);
<a name="l00505"></a>00505     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_mc_stz_decomp.html#a684b5f50f362bb60c47f105621b582e7" title="gradient of the objective function The gradient array is of fixed size and not subject to shrinking...">gradient</a>, v, j);
<a name="l00506"></a>00506     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a9f231c20de6ca030ddb93f78fe960503">XCHG_V</a>(<a class="code" href="struct_qp_mc_stz_decomp_1_1t_variable.html" title="data structure describing one variable of the problem">tVariable</a>, <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>, v, j);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     std::swap(exv-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[iv], exj-&gt;<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html#a890e3e31ec5fdad0b63a409b81f6f1c5">variables</a>[ij]);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <a class="code" href="class_qp_mc_stz_decomp.html#a504e0ff568f2719aafe3bffe848a3a92" title="number of currently active variables">activeVar</a>--;
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="class_qp_mc_stz_decomp.html#a6722a4792ace01f542b506a5f439252c">00513</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_mc_stz_decomp.html#a6722a4792ace01f542b506a5f439252c" title="shrink an examples">QpMcStzDecomp::DeactivateExample</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a> - 1;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <a class="code" href="_qp_mc_stz_decomp_8cpp.html#a9f231c20de6ca030ddb93f78fe960503">XCHG_V</a>(<a class="code" href="struct_qp_mc_stz_decomp_1_1t_example.html" title="data structure describing one training example">tExample</a>, <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>, e, j);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v;
<a name="l00520"></a>00520     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pe = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[e].variables;
<a name="l00521"></a>00521     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pj = <a class="code" href="class_qp_mc_stz_decomp.html#a9c8f47d13765f92cb7edcff1fbfca77d" title="information about each training example">example</a>[j].variables;
<a name="l00522"></a>00522     <span class="keywordflow">for</span> (v = 0; v &lt; <a class="code" href="class_qp_mc_stz_decomp.html#aa880f1219ee6c683e056947b3c3df470" title="number of classes in the problem">classes</a>; v++)
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[pe[v]].example = e;
<a name="l00525"></a>00525         <a class="code" href="class_qp_mc_stz_decomp.html#ad09e1fe6895340f65531eb436eb24f92" title="information about each variable of the problem">variable</a>[pj[v]].example = j;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="comment">// notify the matrix cache</span>
<a name="l00529"></a>00529     <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a262e15085d6057581dc41c43a9886032">CacheRowRelease</a>(e);
<a name="l00530"></a>00530     <a class="code" href="class_qp_mc_stz_decomp.html#a778b235f5eea3f612627088d9aafd32c" title="kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a24706a604c5b2db1c76b6a632d0aae18" title="Exchange the rows i and j and the columns i and j.">FlipColumnsAndRows</a>(e, j);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <a class="code" href="class_qp_mc_stz_decomp.html#a5cc54f54ecfbc9a4f7f7e961d6a3bad0" title="number of currently active examples">activeEx</a>--;
<a name="l00533"></a>00533 }
</pre></div></div>
</div>
</div>
</div>
</body></html>
