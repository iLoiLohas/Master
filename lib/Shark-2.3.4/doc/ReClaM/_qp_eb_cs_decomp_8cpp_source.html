<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ReClaM: QpEbCsDecomp.cpp Source File</title>
<script type="text/javaScript" src="search/search.js"></script>
<link href="../css/main.css" rel="stylesheet" type="text/css"/>
</head>
<body id="type-b">

<div id="wrap">
<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
<div id="poweredby">
<img style="width: 95%;" src="../images/SharkLogo.png"/>
</div>		
  
<ul id="nav">
  <li class="first"><a href="../index.html">About Shark</a></li>
  <li><a href="#">Sourceforge</a>
  
  <ul>
    <li class="first"><a href="http://shark-project.sourceforge.net">Project Summary</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/files/">Downloads</a></li>
    <li><a href="http://sourceforge.net/projects/shark-project/develop">Subversion Repository</a></li>
  </ul>
  
</li>
<li class="first"><a href="../GettingStarted.html">Getting Started</a>
<li class="first"><a href="../Tutorials.html">Tutorials</a>
<li class="first"><a href="../FAQ.html">FAQ</a>

<li class="first"><a href="#">Main Modules</a>
<ul>
  <li class="first"><a href="../ReClaM/index.html">ReClaM</a>
  <li class="first"><a href="../EALib/index.html">EALib</a>
  <li class="first"><a href="../MOO-EALib/index.html">MOO-EALib</a>
  <li class="first"><a href="../Fuzzy/index.html">Fuzzy</a>
</ul>
</li>
<li class="first"><a href="#">Tools</a>
<ul>
  <li class="first"><a href="../Mixture/index.html">Mixture</a>
  <li><a href="../Array/index.html">Array</a>
  <li><a href="../Rng/index.html">Rng</a>
  <li><a href="../LinAlg/index.html">LinAlg</a>
  <li class="last"><a href="../FileUtil/index.html">FileUtil</a>		    
</ul>
</li>
</ul>
</div>

<!--<div id="header">
<div id="site-name">Shark Machine Learning Library</div>
  <ul id="nav">
    <li><a href="../index.html"><span>Shark&nbsp;Main&nbsp;Page</span></a></li>
    <li><a href="../Array/index.html"><span>Array</span></a></li>
    <li><a href="../Rng/index.html"><span>Rng</span></a></li>
    <li><a href="../LinAlg/index.html"><span>LinAlg</span></a></li>
    <li><a href="../FileUtil/index.html"><span>FileUtil</span></a></li>
    <li><a href="../EALib/index.html"><span>EALib</span></a></li>
    <li><a href="../MOO-EALib/index.html"><span>MOO-EALib</span></a></li>
    <li class="active"><a href="../ReClaM/index.html"><span>ReClaM</span></a></li>
    <li><a href="../Fuzzy/index.html"><span>Fuzzy</span></a></li>
    <li><a href="../Mixture/index.html"><span>Mixture</span></a></li>
    <li><a href="../tutorials/index.html"><span>Tutorials</span></a></li>
    <li><a href="../faq/index.html"><span>FAQ</span></a></li>
  </ul>
 </div> -->
<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>QpEbCsDecomp.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_qp_eb_cs_decomp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//===========================================================================</span>
<a name="l00035"></a>00035 <span class="comment"></span><span class="comment">//===========================================================================</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;SharkDefs.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;Rng/GlobalRng.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;Array/ArrayIo.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;Array/ArrayOp.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;LinAlg/LinAlg.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;ReClaM/QuadraticProgram.h&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">using namespace </span>std;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// useful exchange macros for Array&lt;T&gt; and std::vector&lt;T&gt;</span>
<a name="l00053"></a><a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">00053</a> <span class="preprocessor">#define XCHG_A(t, a, i, j) {t temp; temp = a(i); a(i) = a(j); a(j) = temp;}</span>
<a name="l00054"></a><a class="code" href="_qp_eb_cs_decomp_8cpp.html#a9f231c20de6ca030ddb93f78fe960503">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define XCHG_V(t, a, i, j) {t temp; temp = a[i]; a[i] = a[j]; a[j] = temp;}</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="class_qp_eb_cs_decomp.html#ae951ae657b1e508fe68acf303e7aa7bc">00057</a> <a class="code" href="class_qp_eb_cs_decomp.html#ae951ae657b1e508fe68acf303e7aa7bc" title="Constructor.">QpEbCsDecomp::QpEbCsDecomp</a>(<a class="code" href="class_cached_matrix.html" title="Efficient quadratic matrix cache.">CachedMatrix</a>&amp; kernel, <span class="keyword">const</span> Array&lt;double&gt;&amp; y, 
<a name="l00058"></a>00058                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> classes, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r,
<a name="l00059"></a>00059                             <a class="code" href="class_svm_states_collection.html" title="Utility class for storing snapshots of SVM states.">SvmStatesCollection</a> * states)
<a name="l00060"></a>00060 : kernelMatrix(kernel)
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062     <span class="comment">//experimental/recently added vars</span>
<a name="l00063"></a>00063     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>; <span class="comment">//examples and misc.</span>
<a name="l00064"></a>00064     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> = static_cast &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aa" title="List of possible shrinking modes.">eShrinkingModes</a> &gt; ( 0 );
<a name="l00065"></a>00065     <span class="keywordflow">if</span> ( w == 1 ) <span class="comment">//combine cliv with clipped-gain</span>
<a name="l00066"></a>00066         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#afdd06d5923f43547f3eef04a7d4a77ee">useClippedInReproc</a> = <span class="keyword">true</span>;
<a name="l00067"></a>00067     <span class="keywordflow">else</span>
<a name="l00068"></a>00068         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#afdd06d5923f43547f3eef04a7d4a77ee">useClippedInReproc</a> = <span class="keyword">false</span>;
<a name="l00069"></a>00069     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae6fb2f952d001d9c12d18b209c5c118a">useClippedAsWitness</a> = <span class="keyword">true</span>;
<a name="l00070"></a>00070     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#add9a01a68425e6fd42a42972768f5e25">shrinkCritFraction</a> = 1.0;
<a name="l00071"></a>00071     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a13f081340b6ff18d7146c50dbf5d3440">shrinkEqualFraction</a> = 0.0;
<a name="l00072"></a>00072     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a422c07882f0cabaaf76b1a43aba984c3">reprocGradients</a>.resize(classes);
<a name="l00073"></a>00073     
<a name="l00074"></a>00074     <span class="comment">// init cardinalities (seenEx is done in init)</span>
<a name="l00075"></a>00075     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_q_p_matrix.html#ae8b50d982345b3dffa6a4cbfb362e5a3" title="return the size of the quadratic matrix">getMatrixSize</a>();
<a name="l00076"></a>00076     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> = classes;
<a name="l00077"></a>00077     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> * <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>;
<a name="l00078"></a>00078     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> = 0;
<a name="l00079"></a>00079     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> = 0;
<a name="l00080"></a>00080     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a> = 0;
<a name="l00081"></a>00081     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> = 0;
<a name="l00082"></a>00082     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[i] = 0;
<a name="l00083"></a>00083     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[0] = 1;  <span class="comment">//account for pre-defined first procNew step</span>
<a name="l00084"></a>00084     
<a name="l00085"></a>00085     SIZE_CHECK(y.ndim() == 2);
<a name="l00086"></a>00086     SIZE_CHECK(y.dim(0) == <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>);
<a name="l00087"></a>00087     SIZE_CHECK(y.dim(1) == 1);
<a name="l00088"></a>00088     RANGE_CHECK( classes &gt; 1 );
<a name="l00089"></a>00089     
<a name="l00090"></a>00090     <span class="comment">// size lists; alpha, boxMax, and gradient have length of number of variables, rest of number of examples</span>
<a name="l00091"></a>00091     <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a>, <span class="keyword">false</span>);
<a name="l00092"></a>00092     <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a>, <span class="keyword">false</span>);
<a name="l00093"></a>00093     <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00094"></a>00094     <a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00095"></a>00095     <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a>, <span class="keyword">false</span>);
<a name="l00096"></a>00096     <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00097"></a>00097     <a class="code" href="class_qp_eb_cs_decomp.html#a7b0fb261e3bf0fcc46de1c86ce6384cd" title="i-th element gives the current index of the originally i-th sample">curIndex</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00098"></a>00098     <a class="code" href="class_qp_eb_cs_decomp.html#ab1f15576a09ae5f8e43f2d2f567fc546" title="In each epoch, pre-define how to traverse through the samples.">lottery</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00099"></a>00099     <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00100"></a>00100     <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, <span class="keyword">false</span>);
<a name="l00101"></a>00101     <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>, <span class="keyword">false</span>);
<a name="l00102"></a>00102     <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>.resize(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>, <span class="keyword">false</span>);
<a name="l00103"></a>00103     
<a name="l00104"></a>00104     <span class="keywordtype">double</span> peek; <span class="comment">//tmp helper</span>
<a name="l00105"></a>00105     <span class="comment">// fill lists, part 1. Rest done later, because boxMax depends on C, etc.</span>
<a name="l00106"></a>00106     <span class="keywordflow">for</span> (e = 0; e &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>; e++) 
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108         <span class="comment">// fill in label</span>
<a name="l00109"></a>00109         peek = y(e,0);
<a name="l00110"></a>00110         ASSERT ( peek == (<span class="keywordtype">int</span>)peek ) <span class="comment">//no regression-type datasets</span>
<a name="l00111"></a>00111         RANGE_CHECK ( peek &gt;= 0 ) <span class="comment">// no +-1 encoded binary datasets</span>
<a name="l00112"></a>00112         RANGE_CHECK( peek &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> );
<a name="l00113"></a>00113         <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(e) = peek;
<a name="l00114"></a>00114         <span class="comment">// fill in rest</span>
<a name="l00115"></a>00115         <a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(e) = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a963f1b6b4ce8c3eaecfa01d00d613fd8" title="overriden virtual function">Entry</a>(e, e);
<a name="l00116"></a>00116         <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>(e) = e;
<a name="l00117"></a>00117         <a class="code" href="class_qp_eb_cs_decomp.html#a7b0fb261e3bf0fcc46de1c86ce6384cd" title="i-th element gives the current index of the originally i-th sample">curIndex</a>(e) = e;
<a name="l00118"></a>00118         <a class="code" href="class_qp_eb_cs_decomp.html#ab1f15576a09ae5f8e43f2d2f567fc546" title="In each epoch, pre-define how to traverse through the samples.">lottery</a>(e) = e;
<a name="l00119"></a>00119         <span class="comment">// initially, ninaClasses contain all classes:</span>
<a name="l00120"></a>00120         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l00121"></a>00121             <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(e).insert(c);
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> = 0;
<a name="l00124"></a>00124     <a class="code" href="_qp_eb_cs_decomp_8h.html#ac7f69eb35a827b4a533981f79150e021">MT_COUNT_KERNEL_LOOKUPS</a>( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>; )
<a name="l00125"></a>00125     
<a name="l00126"></a>00126     <span class="comment">// first init the strategy parameters that are fixed during the entire run:</span>
<a name="l00127"></a>00127     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a35427576b90b9d788f8173bde6aef40f">reRu</a> = static_cast &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a2552c345332206dac71017d88ba67eb1" title="List of possible rules how many and which reprocess steps (nOld or nOpt) to be done after one nNew...">eReprocessRules</a> &gt;( r );;
<a name="l00128"></a>00128     <span class="keywordflow">switch</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a35427576b90b9d788f8173bde6aef40f">reRu</a> )
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a2552c345332206dac71017d88ba67eb1a315a36804428dd8348de59cca573baef">rOrig</a>:
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ac010f96c28fc99ce596fd57a51dac29a">numMultipl</a>[0] = 1;
<a name="l00133"></a>00133             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ac010f96c28fc99ce596fd57a51dac29a">numMultipl</a>[1] = 1;
<a name="l00134"></a>00134             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ac010f96c28fc99ce596fd57a51dac29a">numMultipl</a>[2] = 10;
<a name="l00135"></a>00135             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a3ff623f43056f04595357b0a380a55a5">tryMultipl</a>[0] = 1;
<a name="l00136"></a>00136             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a3ff623f43056f04595357b0a380a55a5">tryMultipl</a>[1] = 10;
<a name="l00137"></a>00137             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a3ff623f43056f04595357b0a380a55a5">tryMultipl</a>[2] = 10;
<a name="l00138"></a>00138             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae1a77a63cc8c4a896814a3c09080ee08">probAdaptationRate</a> = 0.05;
<a name="l00139"></a>00139             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae839fc78e96d45aba09ebbbd250df2c9">guaranteeFraction</a> = 1.0 / 20.0;
<a name="l00140"></a>00140             <span class="keywordflow">break</span>;
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142         <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::QpEbCsDecomp] Invalid reprocRules designator&quot;</span> );
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     
<a name="l00145"></a>00145     <span class="comment">// set working set selection variables and related:</span>
<a name="l00146"></a>00146     <span class="comment">// for the time being, set the additional pseudo-parameter for the class</span>
<a name="l00147"></a>00147     <span class="comment">// inversion method by overloading the constructor&#39;s wss parameter. if </span>
<a name="l00148"></a>00148     <span class="comment">// w &lt; wSS_MAX and w = wClassInv directly, we will look at all variables.</span>
<a name="l00149"></a>00149     <span class="keywordflow">if</span> ( w &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76ab6066680bb2182e2897be560b5c39e9e">wSS_MAX</a> ) 
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a10c1dbecfef4fcb1e58f8c1ed2b2c86e">desired_noof_hits</a> = w - <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76ab6066680bb2182e2897be560b5c39e9e">wSS_MAX</a> + 1;
<a name="l00152"></a>00152         w = 1;
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154     <span class="keywordflow">else</span>
<a name="l00155"></a>00155         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a10c1dbecfef4fcb1e58f8c1ed2b2c86e">desired_noof_hits</a> = 0;
<a name="l00156"></a>00156     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> = static_cast &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76" title="List of variants of the WSS algorithm, i.e., among which set of samples is MVP-WSS carried out...">eWsVariants</a> &gt;( w );
<a name="l00157"></a>00157     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> == 2 ) 
<a name="l00158"></a>00158         <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::QpEbCsDecomp] wClassInversion only applicable to true multi-class tasks.&quot;</span>);
<a name="l00159"></a>00159     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> )
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7928cb2572fe8cefdfb199679e9f63dc">candidate</a> = 0;
<a name="l00162"></a>00162         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> = 0;
<a name="l00163"></a>00163         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> = 0;
<a name="l00164"></a>00164         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a> = 0;
<a name="l00165"></a>00165         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a> = 1;
<a name="l00166"></a>00166         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> = <span class="keyword">true</span>;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">// init strategy vars: variable parameters (rest initialized in course of program)</span>
<a name="l00170"></a>00170     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a>; <span class="comment">//first move must be to draw a new sample</span>
<a name="l00171"></a>00171     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a35427576b90b9d788f8173bde6aef40f">reRu</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a2552c345332206dac71017d88ba67eb1a315a36804428dd8348de59cca573baef">rOrig</a> )
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) 
<a name="l00174"></a>00174             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[i] = 1.0;
<a name="l00175"></a>00175         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> = 3.0;
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177     
<a name="l00178"></a>00178     <span class="comment">// init introspection and temporary-results vars </span>
<a name="l00179"></a>00179     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a> = 0.0;
<a name="l00180"></a>00180     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#aff9acb6335feb1a3b6a6e4717dd14590">primal</a> = 0.0;
<a name="l00181"></a>00181     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a69c1c016249c84975765f9d401ac9415">curGainRate</a> = 0.0;
<a name="l00182"></a>00182     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> = NULL;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="comment">// init default stopping conditions. overriden by setStoppingConditions.</span>
<a name="l00185"></a>00185     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#ae66a0de8559bba08b8dd0940d4a70424">accuracy</a> = 0.0001; <span class="comment">//default is 1e-4 in original paper</span>
<a name="l00186"></a>00186     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a> = 1;
<a name="l00187"></a>00187     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a190ee7e9d758154f18b11a83423e4017">dualAim</a> = 0.0;
<a name="l00188"></a>00188     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a04e2853c57256b08819621c0f4ffd794">sNone</a>;
<a name="l00189"></a>00189     
<a name="l00190"></a>00190     <span class="comment">// initialize record keeping historian</span>
<a name="l00191"></a>00191     <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a> = states;
<a name="l00192"></a>00192     <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> = 0;
<a name="l00193"></a>00193     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a> != NULL )
<a name="l00194"></a>00194     {   
<a name="l00195"></a>00195         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> = 10;
<a name="l00196"></a>00196         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a> = <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>*<a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a>;
<a name="l00197"></a>00197                                         <span class="comment">// v-- number of shots, param length, closure lengths, noof measures</span>
<a name="l00198"></a>00198         <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a6739393dc682a4a4bef93292e13dc0d2" title="initialization method for resizing of the internal arrays.">declareIntentions</a>( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a>, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, 4 );
<a name="l00199"></a>00199         <a class="code" href="class_qp_eb_cs_decomp.html#a7639a06b1e1275c5d200cdb204919016">m_dummyClosureDouble</a>.resize(0, <span class="keyword">false</span>);
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <span class="keywordflow">else</span>
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> = 0;
<a name="l00204"></a>00204         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a> = 0;
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> )
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> / <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>;
<a name="l00209"></a>00209         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#adf72e323e4e2e5cac6559434d39e1288">writeDualModuland</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> % <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="class_qp_eb_cs_decomp.html#aaf6bf101277a2b9099263d847233ff53">00214</a> <a class="code" href="class_qp_eb_cs_decomp.html#aaf6bf101277a2b9099263d847233ff53" title="Destructor.">QpEbCsDecomp::~QpEbCsDecomp</a>()
<a name="l00215"></a>00215 { }
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="class_qp_eb_cs_decomp.html#a61ce4ac374726623615f344008c60de1">00217</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#a61ce4ac374726623615f344008c60de1" title="reset all variables that are valid for one epoch only">QpEbCsDecomp::init</a>()
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219 <span class="comment">//  ASSERT( false )</span>
<a name="l00220"></a>00220     <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> = 0;
<a name="l00221"></a>00221     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a04e2853c57256b08819621c0f4ffd794">sNone</a>; <span class="comment">//this can only reset any former break-to-next-epoch</span>
<a name="l00222"></a>00222     <a class="code" href="class_qp_eb_cs_decomp.html#af0899237b61d52c18f827435d3e8ea98" title="randomly reorder the lottery vector defining the iteration through the dataset">shuffleSamples</a>();
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="class_qp_eb_cs_decomp.html#a505b5ad6e6abac5b51b60508031458fb">00225</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#a505b5ad6e6abac5b51b60508031458fb" title="set the stopping conditions for the solver.">QpEbCsDecomp::setStoppingConditions</a>(<span class="keywordtype">double</span> a, <span class="keywordtype">int</span> e, <span class="keywordtype">double</span> d)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227     RANGE_CHECK( a &gt; 0 );
<a name="l00228"></a>00228     <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#ae66a0de8559bba08b8dd0940d4a70424">accuracy</a> = a;
<a name="l00229"></a>00229     
<a name="l00230"></a>00230     <span class="keywordflow">if</span> ( d &gt; 0 ) 
<a name="l00231"></a>00231     {
<a name="l00232"></a>00232         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a> = <a class="code" href="_qp_eb_cs_decomp_8h.html#a766d98cca48d8851da346b920bb244a0">MAX_EPOCHS_HARD_BOUNDARY</a>;
<a name="l00233"></a>00233         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a190ee7e9d758154f18b11a83423e4017">dualAim</a> = d;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( e &gt; 0 ) 
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237         <span class="keywordflow">if</span> ( e &lt; <a class="code" href="_qp_eb_cs_decomp_8h.html#a766d98cca48d8851da346b920bb244a0">MAX_EPOCHS_HARD_BOUNDARY</a> )
<a name="l00238"></a>00238             <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a> = e;
<a name="l00239"></a>00239         <span class="keywordflow">else</span>
<a name="l00240"></a>00240             <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a> = <a class="code" href="_qp_eb_cs_decomp_8h.html#a766d98cca48d8851da346b920bb244a0">MAX_EPOCHS_HARD_BOUNDARY</a>;
<a name="l00241"></a>00241         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a190ee7e9d758154f18b11a83423e4017">dualAim</a> = 0.0;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <span class="keywordflow">else</span> <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[EpochBasedCsMcSvm::setStoppingConditions]&quot;</span> 
<a name="l00244"></a>00244                               <span class="stringliteral">&quot;Invalid stopping criterion.&quot;</span>);
<a name="l00245"></a>00245                                                   
<a name="l00246"></a>00246     <span class="comment">// initialize record keeping historian</span>
<a name="l00247"></a>00247     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a> != NULL )
<a name="l00248"></a>00248     {   
<a name="l00249"></a>00249         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> = 10;
<a name="l00250"></a>00250         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a> = <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>*<a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a>;
<a name="l00251"></a>00251                                         <span class="comment">// v-- number of shots, param length, closure lengths, noof measures</span>
<a name="l00252"></a>00252         <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a6739393dc682a4a4bef93292e13dc0d2" title="initialization method for resizing of the internal arrays.">declareIntentions</a>( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a>, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>, 4 );
<a name="l00253"></a>00253         <a class="code" href="class_qp_eb_cs_decomp.html#a7639a06b1e1275c5d200cdb204919016">m_dummyClosureDouble</a>.resize(0, <span class="keyword">false</span>);
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     <span class="keywordflow">else</span>
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> = 0;
<a name="l00258"></a>00258         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a> = 0;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> )
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> / <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>;
<a name="l00263"></a>00263         <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#adf72e323e4e2e5cac6559434d39e1288">writeDualModuland</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> % <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="class_qp_eb_cs_decomp.html#a1145022da7d30780f4a99c6ac0c0636c">00267</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#a1145022da7d30780f4a99c6ac0c0636c" title="solve the quadratic program.">QpEbCsDecomp::Solve</a>(Array&lt;double&gt;&amp; solutionVector, <span class="keywordtype">double</span> regC)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     SIZE_CHECK( solutionVector.ndim() == 1 );
<a name="l00270"></a>00270     SIZE_CHECK( solutionVector.dim(0) == <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae69b45aee527742cb9f1d130bc521e86">variables</a> );
<a name="l00271"></a>00271     RANGE_CHECK( regC &gt; 0 );
<a name="l00272"></a>00272     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a6fac95732a5d4af771498b2914865d08">creg</a> = regC;
<a name="l00273"></a>00273     <span class="keywordtype">double</span> curGain = 0.0; <span class="comment">//tmp helper</span>
<a name="l00274"></a>00274     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e, c, j, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> = 0; <span class="comment">//used for examples, classes, misc.</span>
<a name="l00275"></a>00275     
<a name="l00276"></a>00276     <span class="comment">//fill lists, part 2</span>
<a name="l00277"></a>00277     solutionVector = 0; <span class="comment">//to be clear: in contrast to other solvers, no custom init allowed here</span>
<a name="l00278"></a>00278     <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a> = 0;          <span class="comment">//dito</span>
<a name="l00279"></a>00279     <span class="keywordflow">for</span> (e = 0; e &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>; e++)
<a name="l00280"></a>00280         <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l00281"></a>00281             <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(e*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+c) = ( c == <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(e) )*regC;
<a name="l00282"></a>00282     
<a name="l00283"></a>00283     <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#aa2781bbe5c0f3c93d927b27763494065">overall_timer</a>.<a class="code" href="classs_wall_timer.html#aa73a34ebb6bf8ca9416b42ad5bd1f8ac">tic</a>();
<a name="l00284"></a>00284     <span class="comment">// ONE LOOP = ONE EPOCH  ( Stop condition handling ugly here, but allows for flexible, extendable structure. )</span>
<a name="l00285"></a>00285     <span class="keywordflow">while</span>( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a1545869cd86f56fe6485c89ca23d3d0e">sQUIT_MARKER</a> ) <span class="comment">//only first stopping condition indicates immediate end-of-epoch</span>
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         <a class="code" href="class_qp_eb_cs_decomp.html#a61ce4ac374726623615f344008c60de1" title="reset all variables that are valid for one epoch only">init</a>();  <span class="comment">//reset all vars that are valid for one epoch only</span>
<a name="l00288"></a>00288         <span class="keywordflow">while</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a0555277931bd9bb2ebdf960c613a171b">sEND_MARKER</a> ) <span class="comment">//cycle through samples, with intermittant reprocess/optimize steps</span>
<a name="l00289"></a>00289         {
<a name="l00290"></a>00290             <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a69c1c016249c84975765f9d401ac9415">curGainRate</a> = 0.0;
<a name="l00291"></a>00291             <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a23d7436e4f4c33e9ca0b813b0391b619">rolex</a>.<a class="code" href="classs_wall_timer.html#aa73a34ebb6bf8ca9416b42ad5bd1f8ac">tic</a>(); <span class="comment">//start timer</span>
<a name="l00292"></a>00292             <span class="keywordflow">for</span> (i=0,j=0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a3ff623f43056f04595357b0a380a55a5">tryMultipl</a>[<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a>]; i++) <span class="comment">//i=trials, j=successes</span>
<a name="l00293"></a>00293             {
<a name="l00294"></a>00294                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ae27aa61221d1fff44cdfbad0e895f438" title="find the next pattern to work on. return true if there are now unseen samples left.">selectNextPattern</a>() ) <span class="keywordflow">break</span>; <span class="comment">//end epoch if seen all non-SPs</span>
<a name="l00295"></a>00295                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a2a6b24fe27abcbfbdf9ea88bbf062ab1" title="Choose working set according to current strategy. return corresponding KKT violation.">selectWorkingSet</a>() &gt; <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#ae66a0de8559bba08b8dd0940d4a70424">accuracy</a>)
<a name="l00296"></a>00296                 {
<a name="l00297"></a>00297                     curGain = <a class="code" href="class_qp_eb_cs_decomp.html#a9abcc449d3e12a8ccc0b4769761c05b0" title="do the actual update on the working set, return the gain achieved">performSmoStep</a>();
<a name="l00298"></a>00298                     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a69c1c016249c84975765f9d401ac9415">curGainRate</a> += curGain;
<a name="l00299"></a>00299                     ++j;
<a name="l00300"></a>00300                     <span class="keywordflow">if</span> ( j &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ac010f96c28fc99ce596fd57a51dac29a">numMultipl</a>[<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a>] ) <span class="comment">//reached foreseen amount of iterations: finish</span>
<a name="l00301"></a>00301                         <span class="keywordflow">break</span>;
<a name="l00302"></a>00302                 }
<a name="l00303"></a>00303                 <span class="keywordflow">else</span> <span class="comment">//potential cacheRowRelease &amp; potential safety exit for cicl-based wss-strategies</span>
<a name="l00304"></a>00304                 {
<a name="l00305"></a>00305                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a> ) <span class="comment">//we&#39;ll never see that sample again</span>
<a name="l00306"></a>00306                     {
<a name="l00307"></a>00307                         <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a262e15085d6057581dc41c43a9886032">CacheRowRelease</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> ); <span class="comment">//then delete the corresponding row</span>
<a name="l00308"></a>00308                         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> == <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a01a217dc6d2e2ac8f3517c8d5eb5bfdd">sEndEpochSoon</a> ) <span class="comment">//mostly for completeness: tryMultipl[nNew] is 1 for all known reru</span>
<a name="l00309"></a>00309                             <span class="keywordflow">break</span>;
<a name="l00310"></a>00310                     }
<a name="l00311"></a>00311                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> )
<a name="l00312"></a>00312                     {
<a name="l00313"></a>00313                         <span class="comment">// this is possible e.g. in beginning: we&#39;ll have endless opimizations on few samples,</span>
<a name="l00314"></a>00314                         <span class="comment">// hence, e.g., max_witness = max_gain may be e-10, which is below kkt limit</span>
<a name="l00315"></a>00315                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> = <span class="keyword">true</span>; <span class="comment">//next time, do nOpt over all SCs</span>
<a name="l00316"></a>00316                     }
<a name="l00317"></a>00317                 }
<a name="l00318"></a>00318             }
<a name="l00319"></a>00319             <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a69c1c016249c84975765f9d401ac9415">curGainRate</a> /= ( <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a23d7436e4f4c33e9ca0b813b0391b619">rolex</a>.<a class="code" href="classs_wall_timer.html#ae6d1eef67f01f28526ebd5022312a1a8">toc</a>() + 0.00001 ); <span class="comment">//stop timer</span>
<a name="l00320"></a>00320             <a class="code" href="class_qp_eb_cs_decomp.html#ab7f9ed80cc6ab2fdffcfd291eff6c4fa" title="select next processing step">selectNextProcessingStep</a>(); <span class="comment">//update probabilities and select next step based on timing and dual</span>
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322         
<a name="l00323"></a>00323         ++<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a>;
<a name="l00324"></a>00324         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a> &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a4ff8d174006828a6fc41b6b3e62020ae">maxEpochs</a> ) 
<a name="l00325"></a>00325             <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8ac970b000c62ea69979fbd278e083eb8b">sEpochs</a>;
<a name="l00326"></a>00326         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a190ee7e9d758154f18b11a83423e4017">dualAim</a> &gt; 0 &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a01629c025d5ab13a87800662eda290ac" title="return the current value of the primal, and also store in introsp.primal">calcPrimal</a>()-<a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a> &lt;= <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a190ee7e9d758154f18b11a83423e4017">dualAim</a> )
<a name="l00327"></a>00327             <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a17c57f03eddd118950a9c12425806898">sDualAim</a>;
<a name="l00328"></a>00328             
<a name="l00329"></a>00329         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> )
<a name="l00330"></a>00330         {
<a name="l00331"></a>00331             <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a30c82978adcb2ff688a17cfb2e65ffba" title="auxiliary methods for direct access to #m_performanceMeasures">storeDirectly</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a>, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a>*<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>-1 );
<a name="l00332"></a>00332             <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a30c82978adcb2ff688a17cfb2e65ffba" title="auxiliary methods for direct access to #m_performanceMeasures">storeDirectly</a>( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#aa2781bbe5c0f3c93d927b27763494065">overall_timer</a>.<a class="code" href="classs_wall_timer.html#ae6d1eef67f01f28526ebd5022312a1a8">toc</a>(), 1, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a>*<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>-1 );
<a name="l00333"></a>00333             <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ada9dd4d4c3dfed62ac4931937c2cb25a" title="true svm training should be influenced as little as possible, and the influence should be constant...">pushSnapShot</a>( <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a7639a06b1e1275c5d200cdb204919016">m_dummyClosureDouble</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a> );
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     
<a name="l00338"></a>00338     <span class="comment">//print results/performance measures to screen</span>
<a name="l00339"></a>00339     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#ae9cc78afec4b9a28f76d3a1fd8438a4e">verbosity</a> == 1 )
<a name="l00340"></a>00340     {
<a name="l00341"></a>00341         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> )
<a name="l00342"></a>00342         {
<a name="l00343"></a>00343             cout &lt;&lt; <span class="stringliteral">&quot;\t\t[ &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#aefdad21c21803157415ec9de092c1c83" title="get number of kernel evaluations">getKernelEvals</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00344"></a>00344                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a13728ccfe689ddf51dc96dfa3c87610e">getMaxCacheSize</a>()/1048576*<span class="keyword">sizeof</span>(float) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> 
<a name="l00345"></a>00345                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> 
<a name="l00346"></a>00346                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#aa2781bbe5c0f3c93d927b27763494065">overall_timer</a>.<a class="code" href="classs_wall_timer.html#ae6d1eef67f01f28526ebd5022312a1a8">toc</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[1] 
<a name="l00347"></a>00347                  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[2] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; endl;
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349         <span class="keywordflow">else</span>
<a name="l00350"></a>00350         {
<a name="l00351"></a>00351             cout &lt;&lt; <span class="stringliteral">&quot;\t\t[ &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#aefdad21c21803157415ec9de092c1c83" title="get number of kernel evaluations">getKernelEvals</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00352"></a>00352                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a13728ccfe689ddf51dc96dfa3c87610e">getMaxCacheSize</a>()/1048576*<span class="keyword">sizeof</span>(float) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> 
<a name="l00353"></a>00353                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> 
<a name="l00354"></a>00354                  &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#aa2781bbe5c0f3c93d927b27763494065">overall_timer</a>.<a class="code" href="classs_wall_timer.html#ae6d1eef67f01f28526ebd5022312a1a8">toc</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[1] 
<a name="l00355"></a>00355                  &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[2] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a>;
<a name="l00356"></a>00356             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>-10; i++)
<a name="l00357"></a>00357                 cout &lt;&lt; <span class="stringliteral">&quot;, 0 &quot;</span>;
<a name="l00358"></a>00358             cout &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; endl;
<a name="l00359"></a>00359             cout &lt;&lt; <span class="stringliteral">&quot;\t\t,&quot;</span> &lt;&lt; endl;
<a name="l00360"></a>00360             cout &lt;&lt; <span class="stringliteral">&quot;\t\t[ &quot;</span>;
<a name="l00361"></a>00361             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>-1; i++)
<a name="l00362"></a>00362                 cout &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ae5c27f57bcc4bf5bf865aa0a7fc7bdbc" title="auxiliary methods for direct access to #m_performanceMeasures">accessDirectly</a>( 0, i ) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00363"></a>00363             cout &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ae5c27f57bcc4bf5bf865aa0a7fc7bdbc" title="auxiliary methods for direct access to #m_performanceMeasures">accessDirectly</a>( 0, <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>-1 );
<a name="l00364"></a>00364             cout &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; endl;
<a name="l00365"></a>00365             cout &lt;&lt; <span class="stringliteral">&quot;\t\t,&quot;</span> &lt;&lt; endl;
<a name="l00366"></a>00366             cout &lt;&lt; <span class="stringliteral">&quot;\t\t[ &quot;</span>;
<a name="l00367"></a>00367             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>-1; i++)
<a name="l00368"></a>00368                 cout &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ae5c27f57bcc4bf5bf865aa0a7fc7bdbc" title="auxiliary methods for direct access to #m_performanceMeasures">accessDirectly</a>( 1, i ) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00369"></a>00369             cout &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ae5c27f57bcc4bf5bf865aa0a7fc7bdbc" title="auxiliary methods for direct access to #m_performanceMeasures">accessDirectly</a>( 1, <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a5fcf571dff54f10968e99a6ac1940e72">overall_noof_measurements</a>-1 );
<a name="l00370"></a>00370             cout &lt;&lt; <span class="stringliteral">&quot; ]&quot;</span> &lt;&lt; endl;
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373         
<a name="l00374"></a>00374     <span class="comment">// return alpha</span>
<a name="l00375"></a>00375     <span class="keywordflow">for</span> (e = 0; e &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>; e++)
<a name="l00376"></a>00376         <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l00377"></a>00377             solutionVector( <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>(e)*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c ) = <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>( e*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c );
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a><a class="code" href="class_qp_eb_cs_decomp.html#ab7f9ed80cc6ab2fdffcfd291eff6c4fa">00382</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#ab7f9ed80cc6ab2fdffcfd291eff6c4fa" title="select next processing step">QpEbCsDecomp::selectNextProcessingStep</a>()
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
<a name="l00385"></a>00385     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> == <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8aa5707c9db68e2a278f7e21619956c4ff">sEndEpochNow</a> )
<a name="l00386"></a>00386         <span class="keywordflow">return</span>; <span class="comment">//if the last procNew in this epoch was aborted, leave everything as is</span>
<a name="l00387"></a>00387     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> == 0 )
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a>; <span class="comment">//if currently there are no APs, procOld and procOpt don&#39;t make sense</span>
<a name="l00390"></a>00390         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> == <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a01a217dc6d2e2ac8f3517c8d5eb5bfdd">sEndEpochSoon</a> )
<a name="l00391"></a>00391             <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8aa5707c9db68e2a278f7e21619956c4ff">sEndEpochNow</a>;
<a name="l00392"></a>00392         <span class="keywordflow">return</span>;
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394     <span class="keywordflow">switch</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a35427576b90b9d788f8173bde6aef40f">reRu</a> )
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a2552c345332206dac71017d88ba67eb1a315a36804428dd8348de59cca573baef">rOrig</a>:
<a name="l00397"></a>00397         {
<a name="l00398"></a>00398             <span class="comment">// update probabilities</span>
<a name="l00399"></a>00399             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a>] = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae1a77a63cc8c4a896814a3c09080ee08">probAdaptationRate</a> * <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a69c1c016249c84975765f9d401ac9415">curGainRate</a> +
<a name="l00400"></a>00400                                             (1.0 - <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae1a77a63cc8c4a896814a3c09080ee08">probAdaptationRate</a>) * <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a>];
<a name="l00401"></a>00401             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> = 0.0;
<a name="l00402"></a>00402             for (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[i]; <span class="comment">//update the sum</span>
<a name="l00403"></a>00403             for (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) <span class="comment">//raise other probabilities if necessary</span>
<a name="l00404"></a>00404                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[i] &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae839fc78e96d45aba09ebbbd250df2c9">guaranteeFraction</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> )
<a name="l00405"></a>00405                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>] = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae839fc78e96d45aba09ebbbd250df2c9">guaranteeFraction</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a>;
<a name="l00406"></a>00406             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> = 0.0; 
<a name="l00407"></a>00407             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) 
<a name="l00408"></a>00408                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[i]; <span class="comment">//and update the sum again</span>
<a name="l00409"></a>00409                 
<a name="l00410"></a>00410             <span class="comment">// choose next step according to new probabilites</span>
<a name="l00411"></a>00411             <span class="keywordtype">double</span> draw = Rng::uni(0, <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aebaeff71e6eb1dce1c4c8190b8a17d7d">probSum</a>);
<a name="l00412"></a>00412             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5ab2cd4afd6c64a9c89b852d5d8a1f9fb2">nMAX</a>; i++) 
<a name="l00413"></a>00413             {
<a name="l00414"></a>00414                 <span class="keywordflow">if</span> ( draw &lt;= <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[i] ) 
<a name="l00415"></a>00415                 {
<a name="l00416"></a>00416                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> = static_cast &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5" title="List of possible actions for the next processing step.">eNextProc</a> &gt;( <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a> );
<a name="l00417"></a>00417                     <span class="keywordflow">break</span>;
<a name="l00418"></a>00418                 }
<a name="l00419"></a>00419                 <span class="keywordflow">else</span> 
<a name="l00420"></a>00420                 {
<a name="l00421"></a>00421                     draw -= <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a71adfffb27fe11ac1682b0aaf7c0587a">probability</a>[<a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>];
<a name="l00422"></a>00422                 }
<a name="l00423"></a>00423             }
<a name="l00424"></a>00424             <span class="keywordflow">break</span>;
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426         <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::selectNextProcessingStep] unkown reprocess rule&quot;</span>);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428     
<a name="l00429"></a>00429     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> == <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a01a217dc6d2e2ac8f3517c8d5eb5bfdd">sEndEpochSoon</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a> )
<a name="l00430"></a>00430         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8aa5707c9db68e2a278f7e21619956c4ff">sEndEpochNow</a>; <span class="comment">//after endSoon, only allow continuation for nOld,nOpt, not for nNew</span>
<a name="l00431"></a>00431     <span class="keywordflow">else</span>
<a name="l00432"></a>00432         ++<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ab85fa29a0a91c98b3bb9244ddcd1cada">planned_steps</a>[<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a>];
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="class_qp_eb_cs_decomp.html#ae27aa61221d1fff44cdfbad0e895f438">00435</a> <span class="keywordtype">bool</span> <a class="code" href="class_qp_eb_cs_decomp.html#ae27aa61221d1fff44cdfbad0e895f438" title="find the next pattern to work on. return true if there are now unseen samples left.">QpEbCsDecomp::selectNextPattern</a>()
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437     <span class="keywordflow">switch</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> )
<a name="l00438"></a>00438     {
<a name="l00439"></a>00439         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a>:
<a name="l00440"></a>00440         {
<a name="l00441"></a>00441             <span class="keywordflow">do</span> <span class="comment">//iterate through the lottery until a non-supportPattern is reached</span>
<a name="l00442"></a>00442             {
<a name="l00443"></a>00443                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a7b0fb261e3bf0fcc46de1c86ce6384cd" title="i-th element gives the current index of the originally i-th sample">curIndex</a>( <a class="code" href="class_qp_eb_cs_decomp.html#ab1f15576a09ae5f8e43f2d2f567fc546" title="In each epoch, pre-define how to traverse through the samples.">lottery</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a>) );
<a name="l00444"></a>00444                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a>;
<a name="l00445"></a>00445                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> )
<a name="l00446"></a>00446                 {
<a name="l00447"></a>00447                     <span class="keywordflow">if</span> (    <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> % <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> == <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#adf72e323e4e2e5cac6559434d39e1288">writeDualModuland</a>  <span class="comment">//take measurements every x-th example...</span>
<a name="l00448"></a>00448                          &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> != <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#adf72e323e4e2e5cac6559434d39e1288">writeDualModuland</a>                           <span class="comment">//...but not very close to the beginning </span>
<a name="l00449"></a>00449                          &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> / <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a> != <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a> ) <span class="comment">//...and not very close to the end</span>
<a name="l00450"></a>00450                     {
<a name="l00451"></a>00451                         <span class="keywordtype">int</span> index = (<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a648f92c368b326bef4995a6aa48fed7a">epochs</a>*<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a89dd16afbb047bf2af658928ad462f35">measurements_per_epoch</a>)+(<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a>/<a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#ad2851ce2476a2d14e16799ebd6a9c724">writeDualEvery</a>)-1;
<a name="l00452"></a>00452                         <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a30c82978adcb2ff688a17cfb2e65ffba" title="auxiliary methods for direct access to #m_performanceMeasures">storeDirectly</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a>, 0, index );
<a name="l00453"></a>00453                         <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#a30c82978adcb2ff688a17cfb2e65ffba" title="auxiliary methods for direct access to #m_performanceMeasures">storeDirectly</a>( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#aa2781bbe5c0f3c93d927b27763494065">overall_timer</a>.<a class="code" href="classs_wall_timer.html#ae6d1eef67f01f28526ebd5022312a1a8">toc</a>(), 1, index );
<a name="l00454"></a>00454                         <a class="code" href="class_qp_eb_cs_decomp.html#ae932f120e5a9049bb22b1273edec47ba">mep_historian</a>-&gt;<a class="code" href="class_svm_states_collection.html#ada9dd4d4c3dfed62ac4931937c2cb25a" title="true svm training should be influenced as little as possible, and the influence should be constant...">pushSnapShot</a>( <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a7639a06b1e1275c5d200cdb204919016">m_dummyClosureDouble</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a> );
<a name="l00455"></a>00455                     }
<a name="l00456"></a>00456                 }
<a name="l00457"></a>00457                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#a534f34a139274f0f77fabb3d053bc05f">seenEx</a> &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a> ) <span class="comment">//picked this epoch&#39;s last pattern</span>
<a name="l00458"></a>00458                 {
<a name="l00459"></a>00459                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> ) <span class="comment">//bummer, there were only SPs left, so bail out.</span>
<a name="l00460"></a>00460                     {
<a name="l00461"></a>00461                         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8aa5707c9db68e2a278f7e21619956c4ff">sEndEpochNow</a>; 
<a name="l00462"></a>00462                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00463"></a>00463                     }
<a name="l00464"></a>00464                     <span class="keywordflow">else</span> <span class="comment">//found one SP, but that&#39;s the last one, so one more SMO</span>
<a name="l00465"></a>00465                     {
<a name="l00466"></a>00466                         <a class="code" href="class_qp_eb_cs_decomp.html#aff38a9e5fcd8ab96c3dff8d8c996264b" title="Stopping criterion. The last one greater zero is considered active in addition to accuracy...">stopCrit</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_stop_crit.html#a43e6f719ce0bd09bd7963627f4bffb09">stop</a> = <a class="code" href="class_qp_eb_cs_decomp.html#accdfa4d11822227d285801e28e4b50b8a01a217dc6d2e2ac8f3517c8d5eb5bfdd">sEndEpochSoon</a>;
<a name="l00467"></a>00467                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00468"></a>00468                     }
<a name="l00469"></a>00469                 }
<a name="l00470"></a>00470             } <span class="keywordflow">while</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> ); <span class="comment">//ensure that not an SP (only necessary if epochs &gt; 1)</span>
<a name="l00471"></a>00471             <span class="keywordflow">break</span>;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a4c60bcdf45a35df21fc9d2652077e16c">nOld</a>:
<a name="l00474"></a>00474         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a1b97a887d3ad6a9f38fc3e054da24a17">nOpt</a>:
<a name="l00475"></a>00475         {
<a name="l00476"></a>00476             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> ) <span class="comment">//retrieve sample from candidate list</span>
<a name="l00477"></a>00477             {
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> )
<a name="l00479"></a>00479                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a74d4e772c4b8542e178fddb1f70bd161">safe_discrete</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>, 1 );
<a name="l00480"></a>00480                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7928cb2572fe8cefdfb199679e9f63dc">candidate</a> &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> )
<a name="l00481"></a>00481                 {
<a name="l00482"></a>00482                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a74d4e772c4b8542e178fddb1f70bd161">safe_discrete</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>, 1 );
<a name="l00483"></a>00483                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> = <span class="keyword">true</span>;
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485                 <span class="keywordflow">else</span>
<a name="l00486"></a>00486                 {
<a name="l00487"></a>00487                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7928cb2572fe8cefdfb199679e9f63dc">candidate</a>;
<a name="l00488"></a>00488                 }
<a name="l00489"></a>00489             }
<a name="l00490"></a>00490             <span class="keywordflow">else</span>
<a name="l00491"></a>00491                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a74d4e772c4b8542e178fddb1f70bd161">safe_discrete</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>, 1 );
<a name="l00492"></a>00492             <span class="keywordflow">break</span>; 
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494         <span class="keywordflow">default</span>: 
<a name="l00495"></a>00495         {
<a name="l00496"></a>00496             cout &lt;&lt; <span class="stringliteral">&quot;received strat.proc = &quot;</span> &lt;&lt; <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> &lt;&lt; endl;
<a name="l00497"></a>00497             <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::selectNextPattern] Not a valid processing mode.&quot;</span>);
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="class_qp_eb_cs_decomp.html#a2a6b24fe27abcbfbdf9ea88bbf062ab1">00503</a> <span class="keywordtype">double</span> <a class="code" href="class_qp_eb_cs_decomp.html#a2a6b24fe27abcbfbdf9ea88bbf062ab1" title="Choose working set according to current strategy. return corresponding KKT violation.">QpEbCsDecomp::selectWorkingSet</a>()
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> = NULL;
<a name="l00506"></a>00506     <span class="keywordtype">double</span> g_cur;
<a name="l00507"></a>00507     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, p = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a>;
<a name="l00508"></a>00508     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(p);
<a name="l00509"></a>00509     tActiveClasses::iterator it, jt;
<a name="l00510"></a>00510     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = -1e100;
<a name="l00511"></a>00511     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> = 1e100;
<a name="l00512"></a>00512     
<a name="l00513"></a>00513     <span class="keywordflow">switch</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> )
<a name="l00514"></a>00514     {
<a name="l00515"></a>00515         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a93a6273b1a8403e6c7fa8818e7e1d802">nNew</a>: 
<a name="l00516"></a>00516         {
<a name="l00517"></a>00517 <span class="comment">//          if ( cardi.sPatterns &gt; cardi.activePatterns + 1 ) throw SHARKEXCEPTION(&quot;[am ziel] .&quot;);</span>
<a name="l00518"></a>00518             p = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a>;
<a name="l00519"></a>00519             <span class="keywordflow">if</span> (<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>)
<a name="l00520"></a>00520             {
<a name="l00521"></a>00521                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(p, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>);
<a name="l00522"></a>00522                 <a class="code" href="_qp_eb_cs_decomp_8h.html#ac7f69eb35a827b4a533981f79150e021">MT_COUNT_KERNEL_LOOKUPS</a> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>; )
<a name="l00523"></a>00523             }
<a name="l00524"></a>00524                 
<a name="l00525"></a>00525             <span class="comment">// prepare variables, set first variable</span>
<a name="l00526"></a>00526             <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = 1.0;
<a name="l00527"></a>00527             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(p); <span class="comment">//all others are at upper bound. now get gradient:</span>
<a name="l00528"></a>00528             <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).begin(); <span class="comment">//mt_costly_loop_marker</span>
<a name="l00529"></a>00529                   it != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).end(); ++it )
<a name="l00530"></a>00530                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l00531"></a>00531             <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).begin(); <span class="comment">//mt_costly_loop_marker</span>
<a name="l00532"></a>00532                   it != <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).end(); ++it )
<a name="l00533"></a>00533                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l00534"></a>00534             
<a name="l00535"></a>00535             
<a name="l00536"></a>00536             <span class="comment">// calc gradient for every but actual class and get minimum</span>
<a name="l00537"></a>00537             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00538"></a>00538             {
<a name="l00539"></a>00539                 <span class="keywordflow">if</span> ( c == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> ) <span class="keywordflow">continue</span>; <span class="comment">//i should not equal j</span>
<a name="l00540"></a>00540                 g_cur = 0; <span class="comment">//get gradient:</span>
<a name="l00541"></a>00541                 <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).begin(); <span class="comment">//mt_costly_loop_marker</span>
<a name="l00542"></a>00542                       it != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).end(); ++it ) 
<a name="l00543"></a>00543                     g_cur -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l00544"></a>00544                 <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).begin(); <span class="comment">//mt_costly_loop_marker</span>
<a name="l00545"></a>00545                       it != <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).end(); ++it) 
<a name="l00546"></a>00546                     g_cur -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l00547"></a>00547                 <span class="keywordflow">if</span> ( g_cur &lt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> ) 
<a name="l00548"></a>00548                 {
<a name="l00549"></a>00549                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> = c;
<a name="l00550"></a>00550                     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> = g_cur;
<a name="l00551"></a>00551                 }
<a name="l00552"></a>00552             }
<a name="l00553"></a>00553             <span class="keywordflow">break</span>;
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a4c60bcdf45a35df21fc9d2652077e16c">nOld</a>: 
<a name="l00556"></a>00556         {
<a name="l00557"></a>00557             <span class="comment">// iterate through all classes of this sample and get extremal gradient</span>
<a name="l00558"></a>00558             <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).end(); ++it ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00559"></a>00559             {
<a name="l00560"></a>00560                 i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + *it;
<a name="l00561"></a>00561                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i) ) <span class="comment">//calc gradient</span>
<a name="l00562"></a>00562                 {
<a name="l00563"></a>00563                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> == NULL &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> ) <span class="comment">//only get kernel row if it is really needed</span>
<a name="l00564"></a>00564                     {
<a name="l00565"></a>00565                         <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(p, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>);
<a name="l00566"></a>00566                         <a class="code" href="_qp_eb_cs_decomp_8h.html#ac7f69eb35a827b4a533981f79150e021">MT_COUNT_KERNEL_LOOKUPS</a> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>; )
<a name="l00567"></a>00567                     }
<a name="l00568"></a>00568                     g_cur = ( *it == y );
<a name="l00569"></a>00569                     <span class="keywordflow">for</span> ( jt = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(*it).begin(); 
<a name="l00570"></a>00570                           jt != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(*it).end(); ++jt ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00571"></a>00571                         g_cur -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*jt/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*jt);
<a name="l00572"></a>00572                     <span class="keywordflow">for</span> ( jt = <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(*it).begin(); <span class="comment">//mt_costly_loop_marker</span>
<a name="l00573"></a>00573                           jt != <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(*it).end(); ++jt )
<a name="l00574"></a>00574                         g_cur -= <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*jt/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*jt);
<a name="l00575"></a>00575                 }
<a name="l00576"></a>00576                 <span class="keywordflow">else</span> <span class="comment">//retrieve stored gradient</span>
<a name="l00577"></a>00577                     g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l00578"></a>00578                 <span class="comment">// now that we have the gradient, test for extremal one:</span>
<a name="l00579"></a>00579                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#afdd06d5923f43547f3eef04a7d4a77ee">useClippedInReproc</a> || <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a>) <span class="comment">//this idea temporarily stores all gradients</span>
<a name="l00580"></a>00580                     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a422c07882f0cabaaf76b1a43aba984c3">reprocGradients</a>(*it) = g_cur;
<a name="l00581"></a>00581                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) &amp;&amp; g_cur &gt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> )
<a name="l00582"></a>00582                 {
<a name="l00583"></a>00583                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = *it;
<a name="l00584"></a>00584                     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = g_cur;
<a name="l00585"></a>00585                 }
<a name="l00586"></a>00586                 <span class="keywordflow">if</span> ( g_cur &lt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> ) <span class="comment">//both immediately identify the smallest gradient</span>
<a name="l00587"></a>00587                 {
<a name="l00588"></a>00588                     <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> = *it;
<a name="l00589"></a>00589                     <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> = g_cur;
<a name="l00590"></a>00590                 }
<a name="l00591"></a>00591             }
<a name="l00592"></a>00592             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#afdd06d5923f43547f3eef04a7d4a77ee">useClippedInReproc</a> ) <span class="comment">//now find the largest-gaining gPlus for our gMinus</span>
<a name="l00593"></a>00593             {
<a name="l00594"></a>00594                 <span class="keywordtype">double</span> delta_g, mu_test, cur_gain, max_gain = -1e100;
<a name="l00595"></a>00595                 <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).end(); ++it ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00596"></a>00596                 {
<a name="l00597"></a>00597                     <span class="keywordflow">if</span> ( *it == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> ) <span class="keywordflow">continue</span>;
<a name="l00598"></a>00598                     g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a422c07882f0cabaaf76b1a43aba984c3">reprocGradients</a>(*it);
<a name="l00599"></a>00599                     i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + *it;
<a name="l00600"></a>00600                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) )
<a name="l00601"></a>00601                     {
<a name="l00602"></a>00602                         delta_g = g_cur - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>;
<a name="l00603"></a>00603                         mu_test = delta_g / ( 2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p) );
<a name="l00604"></a>00604                         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i, mu_test) )
<a name="l00605"></a>00605                             mu_test = <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(i) - <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(i);
<a name="l00606"></a>00606                         cur_gain = mu_test*( delta_g - mu_test*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p) );
<a name="l00607"></a>00607                         <span class="keywordflow">if</span> ( cur_gain &gt; max_gain )
<a name="l00608"></a>00608                         {
<a name="l00609"></a>00609                             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = *it;
<a name="l00610"></a>00610                             <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = g_cur;
<a name="l00611"></a>00611                             max_gain = cur_gain;
<a name="l00612"></a>00612                         }
<a name="l00613"></a>00613                     }
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615             }
<a name="l00616"></a>00616             <span class="comment">// variable-wise shrinking here:</span>
<a name="l00617"></a>00617             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a> )
<a name="l00618"></a>00618             {
<a name="l00619"></a>00619                 <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).end(); ++it ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00620"></a>00620                 {
<a name="l00621"></a>00621                     g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a422c07882f0cabaaf76b1a43aba984c3">reprocGradients</a>(*it);
<a name="l00622"></a>00622                     <span class="keywordflow">if</span> ( *it == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> || *it == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> || g_cur &lt; 0 ) <span class="comment">//don&#39;t shrink WS or down-pointing</span>
<a name="l00623"></a>00623                         <span class="keywordflow">continue</span>; 
<a name="l00624"></a>00624                     i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + *it;
<a name="l00625"></a>00625                     <span class="comment">// shrink if no progress with this var is possible (or only up to a certain fraction of gPlus)</span>
<a name="l00626"></a>00626                     <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) )
<a name="l00627"></a>00627                     {
<a name="l00628"></a>00628                         <span class="keywordflow">if</span> ( g_cur &gt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> * <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#add9a01a68425e6fd42a42972768f5e25">shrinkCritFraction</a> )
<a name="l00629"></a>00629                         {
<a name="l00630"></a>00630                             <a class="code" href="class_qp_eb_cs_decomp.html#a2d6070c20193be14bffbb8369aa0f027" title="exclude a variable from getting its gradient updated and from being considered in wss...">deactivateVariable</a>( i, p, *it );
<a name="l00631"></a>00631                         }
<a name="l00632"></a>00632                     }
<a name="l00633"></a>00633                 }
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635             <span class="keywordflow">break</span>;
<a name="l00636"></a>00636         }
<a name="l00637"></a>00637         <span class="keywordflow">case</span> <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a1b97a887d3ad6a9f38fc3e054da24a17">nOpt</a>: 
<a name="l00638"></a>00638         {
<a name="l00639"></a>00639             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> &amp;&amp; !<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> )
<a name="l00640"></a>00640             {
<a name="l00641"></a>00641                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a>;
<a name="l00642"></a>00642                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a>;
<a name="l00643"></a>00643                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>( p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> );
<a name="l00644"></a>00644                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>( p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> );
<a name="l00645"></a>00645                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>( p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> ) ) <span class="keywordflow">return</span> 0;
<a name="l00646"></a>00646             }
<a name="l00647"></a>00647             <span class="keywordflow">else</span>
<a name="l00648"></a>00648             {
<a name="l00649"></a>00649                 <span class="comment">// iterate through all support classes of this sample and get extremal gradient</span>
<a name="l00650"></a>00650                 <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).end(); ++it ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00651"></a>00651                 {
<a name="l00652"></a>00652                     i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*it);
<a name="l00653"></a>00653                     g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l00654"></a>00654                     <span class="comment">// test for extremal gradient</span>
<a name="l00655"></a>00655                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) &amp;&amp; g_cur &gt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> )
<a name="l00656"></a>00656                     {
<a name="l00657"></a>00657                         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = (*it);
<a name="l00658"></a>00658                         <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = g_cur;
<a name="l00659"></a>00659                     }
<a name="l00660"></a>00660                     <span class="keywordflow">if</span> ( g_cur &lt; <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> )
<a name="l00661"></a>00661                     {
<a name="l00662"></a>00662                         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> = (*it);
<a name="l00663"></a>00663                         <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> = g_cur;
<a name="l00664"></a>00664                     }
<a name="l00665"></a>00665                 }
<a name="l00666"></a>00666                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#afdd06d5923f43547f3eef04a7d4a77ee">useClippedInReproc</a> ) <span class="comment">//now find the largest-gaining(!) gPlus for our gMinus</span>
<a name="l00667"></a>00667                 {
<a name="l00668"></a>00668                     <span class="keywordtype">double</span> delta_g, mu_test, cur_gain, max_gain = -1e100;
<a name="l00669"></a>00669                     <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).end(); ++it ) <span class="comment">//mt_costly_loop_marker</span>
<a name="l00670"></a>00670                     {
<a name="l00671"></a>00671                         <span class="keywordflow">if</span> ( (*it) == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> ) <span class="keywordflow">continue</span>;
<a name="l00672"></a>00672                         i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*it);
<a name="l00673"></a>00673                         g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l00674"></a>00674                         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) )
<a name="l00675"></a>00675                         {
<a name="l00676"></a>00676                             delta_g = g_cur - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>;
<a name="l00677"></a>00677                             mu_test = delta_g / ( 2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p) );
<a name="l00678"></a>00678                             <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i, mu_test) )
<a name="l00679"></a>00679                                 mu_test = <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(i) - <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(i);
<a name="l00680"></a>00680                             cur_gain = mu_test*( delta_g - mu_test*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p) );
<a name="l00681"></a>00681                             <span class="keywordflow">if</span> ( cur_gain &gt; max_gain )
<a name="l00682"></a>00682                             {
<a name="l00683"></a>00683                                 <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> = (*it);
<a name="l00684"></a>00684                                 <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> = g_cur;
<a name="l00685"></a>00685                                 max_gain = cur_gain;
<a name="l00686"></a>00686                             }
<a name="l00687"></a>00687                         }
<a name="l00688"></a>00688                     }
<a name="l00689"></a>00689                 }
<a name="l00690"></a>00690             }
<a name="l00691"></a>00691             <span class="keywordflow">break</span>;
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693         <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::selectWorkingSet] Not a valid wss mode.&quot;</span>);
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695     <span class="keywordflow">return</span> (<a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>);
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a><a class="code" href="class_qp_eb_cs_decomp.html#a9abcc449d3e12a8ccc0b4769761c05b0">00698</a> <span class="keywordtype">double</span> <a class="code" href="class_qp_eb_cs_decomp.html#a9abcc449d3e12a8ccc0b4769761c05b0" title="do the actual update on the working set, return the gain achieved">QpEbCsDecomp::performSmoStep</a>()
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700     ASSERT ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> ) 
<a name="l00701"></a>00701     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a>;
<a name="l00702"></a>00702     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nI = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>; <span class="comment">//index into arrays of length cardi.variables</span>
<a name="l00703"></a>00703     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nJ = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>;
<a name="l00704"></a>00704     
<a name="l00705"></a>00705     <span class="keywordtype">bool</span> wasSCi = <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>( nI );
<a name="l00706"></a>00706     <span class="keywordtype">bool</span> wasSCj = <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>( nJ );
<a name="l00707"></a>00707     <span class="keywordtype">double</span> mu = (<a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>) / ( 2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p) );
<a name="l00708"></a>00708     <span class="comment">// clip to upper constraint and update alpha</span>
<a name="l00709"></a>00709     <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>( nI, mu) )  
<a name="l00710"></a>00710         mu = <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>( nI ) - <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>( nI );
<a name="l00711"></a>00711     ASSERT ( mu &gt; 0 ) <span class="comment">//there shouldn&#39;t be a way to still get worse here</span>
<a name="l00712"></a>00712     <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>( nI ) += mu;
<a name="l00713"></a>00713     <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>( nJ ) -= mu;
<a name="l00714"></a>00714     
<a name="l00715"></a>00715     <span class="comment">// insert both i and j as new SC (if) or clean up non-SC (else if)</span>
<a name="l00716"></a>00716     <span class="keywordtype">bool</span> isSCi = <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>( nI );
<a name="l00717"></a>00717     <span class="keywordtype">bool</span> isSCj = <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>( nJ );
<a name="l00718"></a>00718             
<a name="l00719"></a>00719     <span class="comment">// update gradients (relies on temp.q being unchanged since selectWorkingSet), and also fill wss lists</span>
<a name="l00720"></a>00720     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> == NULL &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a> ) <span class="comment">//can be NULL if nOpt or all classes SCs for nOld</span>
<a name="l00721"></a>00721     {
<a name="l00722"></a>00722         <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(p, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>, <span class="keyword">false</span>, <span class="keyword">true</span>); <span class="comment">//try to keep dangling patterns</span>
<a name="l00723"></a>00723         <a class="code" href="_qp_eb_cs_decomp_8h.html#ac7f69eb35a827b4a533981f79150e021">MT_COUNT_KERNEL_LOOKUPS</a> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>; )
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725     
<a name="l00726"></a>00726     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> ) <span class="comment">//pick a random third class, not equal to members of last WS</span>
<a name="l00727"></a>00727     {
<a name="l00728"></a>00728         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> = Rng::discrete(0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>-1);
<a name="l00729"></a>00729         <span class="keywordflow">while</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> || <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> )
<a name="l00730"></a>00730             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> = Rng::discrete(0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>-1);
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="comment">//UPDATE J</span>
<a name="l00734"></a>00734     <span class="keywordflow">for</span> ( tActiveClasses::iterator jt = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).begin(); 
<a name="l00735"></a>00735           jt != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).end(); ++jt )
<a name="l00736"></a>00736     {
<a name="l00737"></a>00737         <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(*jt) += mu * <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*jt/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>]; <span class="comment">// e = *jt/cardi.classes</span>
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739     <span class="comment">//DO CICL-WSS</span>
<a name="l00740"></a>00740     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> )
<a name="l00741"></a>00741     {
<a name="l00742"></a>00742         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> = 0;
<a name="l00743"></a>00743         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> = 0.0;
<a name="l00744"></a>00744         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> = <span class="keyword">true</span>;
<a name="l00745"></a>00745         
<a name="l00746"></a>00746         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> ).size();
<a name="l00747"></a>00747         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac5dbe805f70b827ab99e36cece3759c5">asc_size_third</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> ).size();
<a name="l00748"></a>00748         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac5dbe805f70b827ab99e36cece3759c5">asc_size_third</a> )
<a name="l00749"></a>00749         {
<a name="l00750"></a>00750             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a> = 0;
<a name="l00751"></a>00751             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a> = 0;
<a name="l00752"></a>00752             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad5adc79c279fdad7cd60799fe88325c4">start_index</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a74d4e772c4b8542e178fddb1f70bd161">safe_discrete</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a>, 1 ); <span class="comment">//random index into ascs(strat.nextJ)</span>
<a name="l00754"></a>00754 <span class="comment"></span><span class="comment">//          // LOOP THROUGH SUBSET: a bit tricky because tr1::unordered set is not a random access iterator.</span>
<a name="l00755"></a>00755 <span class="comment">//          // (cf. http://stackoverflow.com/questions/124671/picking-a-random-element-from-a-set)</span>
<a name="l00756"></a>00756 <span class="comment">//          // first, find the bucket the start_index-th element is in, then its index in that bucket:</span>
<a name="l00757"></a>00757 <span class="comment">//          cicl.x = cicl.start_index;</span>
<a name="l00758"></a>00758 <span class="comment">//          cicl.bucket_count = activeGlobalSCs(strat.nextJ).bucket_count();</span>
<a name="l00759"></a>00759 <span class="comment">//          for ( cicl.b=0; cicl.b &lt; cicl.bucket_count; cicl.b++ ) </span>
<a name="l00760"></a>00760 <span class="comment">//          {</span>
<a name="l00761"></a>00761 <span class="comment">//              if ( cicl.x &lt; activeGlobalSCs(strat.nextJ).bucket_size(cicl.b) )</span>
<a name="l00762"></a>00762 <span class="comment">//                  break;</span>
<a name="l00763"></a>00763 <span class="comment">//              else</span>
<a name="l00764"></a>00764 <span class="comment">//                  cicl.x -= activeGlobalSCs(strat.nextJ).bucket_size(cicl.b);</span>
<a name="l00765"></a>00765 <span class="comment">//          }</span>
<a name="l00766"></a>00766 <span class="comment">//          cicl.lit = activeGlobalSCs(strat.nextJ).begin(cicl.b);</span>
<a name="l00767"></a>00767 <span class="comment">//          while ( cicl.x &gt; 0 )</span>
<a name="l00768"></a>00768 <span class="comment">//          {</span>
<a name="l00769"></a>00769 <span class="comment">//              ++cicl.lit;</span>
<a name="l00770"></a>00770 <span class="comment">//              ASSERT( cicl.lit != activeGlobalSCs(strat.nextJ).end(cicl.b) );</span>
<a name="l00771"></a>00771 <span class="comment">//              --cicl.x;</span>
<a name="l00772"></a>00772 <span class="comment">//          }</span>
<a name="l00773"></a>00773 <span class="comment">//          while ( cicl.hits_so_far &lt; cicl.desired_noof_hits &amp;&amp; cicl.counter_index &lt; cicl.asc_size_current )</span>
<a name="l00774"></a>00774 <span class="comment">//          {</span>
<a name="l00775"></a>00775 <span class="comment">//              while ( cicl.lit == activeGlobalSCs(strat.nextJ).end(cicl.b) ) //overflow to next bucket</span>
<a name="l00776"></a>00776 <span class="comment">//              {</span>
<a name="l00777"></a>00777 <span class="comment">//                  ++cicl.b;</span>
<a name="l00778"></a>00778 <span class="comment">//                  if ( cicl.b == cicl.bucket_count ) //overflow within the entire set</span>
<a name="l00779"></a>00779 <span class="comment">//                      cicl.b = 0;</span>
<a name="l00780"></a>00780 <span class="comment">//                  cicl.lit = activeGlobalSCs(strat.nextJ).begin(cicl.b);</span>
<a name="l00781"></a>00781 <span class="comment">//              }</span>
<a name="l00783"></a>00783 <span class="comment"></span>            <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).begin();
<a name="l00784"></a>00784             <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>=0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad5adc79c279fdad7cd60799fe88325c4">start_index</a>; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++ )
<a name="l00785"></a>00785                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00786"></a>00786             while ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a10c1dbecfef4fcb1e58f8c1ed2b2c86e">desired_noof_hits</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a> )
<a name="l00787"></a>00787             {
<a name="l00788"></a>00788                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).end() ) <span class="comment">//continue from beginning</span>
<a name="l00789"></a>00789                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).begin();
<a name="l00791"></a>00791                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a>;
<a name="l00792"></a>00792                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a> = *<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; <span class="comment">//current example</span>
<a name="l00793"></a>00793                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00794"></a>00794                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>) || 
<a name="l00795"></a>00795                      ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a>
<a name="l00796"></a>00796                        &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>).find( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> ) == <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>).end() ) 
<a name="l00797"></a>00797                    ) <span class="comment">//only look at samples for which both classes are active SPs</span>
<a name="l00798"></a>00798                 {
<a name="l00799"></a>00799                     ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00800"></a>00800                     <span class="keywordflow">continue</span>;
<a name="l00801"></a>00801                 }
<a name="l00802"></a>00802                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a>;
<a name="l00803"></a>00803                 <span class="comment">//actual stuff:</span>
<a name="l00804"></a>00804                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>);
<a name="l00805"></a>00805                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 0;
<a name="l00806"></a>00806                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae6fb2f952d001d9c12d18b209c5c118a">useClippedAsWitness</a> )
<a name="l00807"></a>00807                 {
<a name="l00808"></a>00808                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = (<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a>-<a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>)) / (2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>)); <span class="comment">//this is used for up-down-swap</span>
<a name="l00809"></a>00809                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> = fabs(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>); <span class="comment">//and this as criterion</span>
<a name="l00810"></a>00810                 }
<a name="l00811"></a>00811                 <span class="keywordflow">else</span>
<a name="l00812"></a>00812                 {
<a name="l00813"></a>00813                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>);
<a name="l00814"></a>00814                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> / ( 2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) );
<a name="l00815"></a>00815                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> &gt; 0 )
<a name="l00816"></a>00816                     {
<a name="l00817"></a>00817                         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>) ) <span class="comment">// j would hit its bound</span>
<a name="l00818"></a>00818                         {
<a name="l00819"></a>00819                             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>) - <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>);
<a name="l00820"></a>00820                             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ) <span class="comment">// j would be deactivated</span>
<a name="l00821"></a>00821                                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 1;
<a name="l00822"></a>00822                         }
<a name="l00823"></a>00823                     }
<a name="l00824"></a>00824                     <span class="keywordflow">else</span>
<a name="l00825"></a>00825                     {
<a name="l00826"></a>00826                         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>, -<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>) ) <span class="comment">// t would hit its bound</span>
<a name="l00827"></a>00827                         {
<a name="l00828"></a>00828                             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = -(<a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>)-<a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>));
<a name="l00829"></a>00829                             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ) <span class="comment">// t would be deactivated</span>
<a name="l00830"></a>00830                                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 1;
<a name="l00831"></a>00831                         }
<a name="l00832"></a>00832                     }
<a name="l00833"></a>00833                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>*( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> - <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ); <span class="comment">//minus sign factors out</span>
<a name="l00834"></a>00834                 }
<a name="l00835"></a>00835                 <span class="keywordflow">if</span> (      <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> &gt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> 
<a name="l00836"></a>00836                      || ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> &gt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> ) 
<a name="l00837"></a>00837                    )
<a name="l00838"></a>00838                 {
<a name="l00839"></a>00839                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7928cb2572fe8cefdfb199679e9f63dc">candidate</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>;
<a name="l00840"></a>00840                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a>;
<a name="l00841"></a>00841                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a>;
<a name="l00842"></a>00842                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> &gt; 0 )
<a name="l00843"></a>00843                     {
<a name="l00844"></a>00844                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>;
<a name="l00845"></a>00845                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00846"></a>00846                     }
<a name="l00847"></a>00847                     <span class="keywordflow">else</span>
<a name="l00848"></a>00848                     {
<a name="l00849"></a>00849                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00850"></a>00850                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>;
<a name="l00851"></a>00851                     }
<a name="l00852"></a>00852                 }
<a name="l00853"></a>00853                 <span class="comment">// finished -- set iterator to next element</span>
<a name="l00854"></a>00854                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00855"></a>00855             }
<a name="l00856"></a>00856         }
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858         
<a name="l00859"></a>00859     <span class="comment">//UPDATE I</span>
<a name="l00860"></a>00860     <span class="keywordflow">for</span> ( tActiveClasses::iterator it = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).begin(); 
<a name="l00861"></a>00861           it != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).end(); ++it )
<a name="l00862"></a>00862     {
<a name="l00863"></a>00863         <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(*it) -= mu * <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a8234626d280c78ded57e3c1c6cbe7d49">q</a>[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>]; <span class="comment">// e = *it/cardi.classes</span>
<a name="l00864"></a>00864     }
<a name="l00865"></a>00865     <span class="comment">//DO CICL-WSS</span>
<a name="l00866"></a>00866     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbb5b916776cdcccffb0f56efde553d7">wss</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a001928e55beea4a873734e92c89cea76adbea98f961958d1229ea89bdcc5fee57">wClassInversion</a> )
<a name="l00867"></a>00867     {
<a name="l00868"></a>00868         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> ).size();
<a name="l00869"></a>00869         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac5dbe805f70b827ab99e36cece3759c5">asc_size_third</a> )
<a name="l00870"></a>00870         {
<a name="l00871"></a>00871             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a> = 0;
<a name="l00872"></a>00872             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a> = 0;
<a name="l00873"></a>00873             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad5adc79c279fdad7cd60799fe88325c4">start_index</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a74d4e772c4b8542e178fddb1f70bd161">safe_discrete</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a>, 1 ); <span class="comment">//random index into ascs(strat.nextI)</span>
<a name="l00875"></a>00875 <span class="comment"></span><span class="comment">//          // LOOP THROUGH SUBSET: a bit tricky because tr1::unordered set is not a random access iterator.</span>
<a name="l00876"></a>00876 <span class="comment">//          // (cf. http://stackoverflow.com/questions/124671/picking-a-random-element-from-a-set)</span>
<a name="l00877"></a>00877 <span class="comment">//          // first, find the bucket the start_index-th element is in, then its index in that bucket:</span>
<a name="l00878"></a>00878 <span class="comment">//          cicl.x = cicl.start_index;</span>
<a name="l00879"></a>00879 <span class="comment">//          cicl.bucket_count = activeGlobalSCs(strat.nextI).bucket_count();</span>
<a name="l00880"></a>00880 <span class="comment">//          for ( cicl.b=0; cicl.b &lt; cicl.bucket_count; cicl.b++ ) </span>
<a name="l00881"></a>00881 <span class="comment">//          {</span>
<a name="l00882"></a>00882 <span class="comment">//              if ( cicl.x &lt; activeGlobalSCs(strat.nextI).bucket_size(cicl.b) )</span>
<a name="l00883"></a>00883 <span class="comment">//                  break;</span>
<a name="l00884"></a>00884 <span class="comment">//              else</span>
<a name="l00885"></a>00885 <span class="comment">//                  cicl.x -= activeGlobalSCs(strat.nextI).bucket_size(cicl.b);</span>
<a name="l00886"></a>00886 <span class="comment">//          }</span>
<a name="l00887"></a>00887 <span class="comment">//          cicl.lit = activeGlobalSCs(strat.nextI).begin(cicl.b);</span>
<a name="l00888"></a>00888 <span class="comment">//          while ( cicl.x &gt; 0 )</span>
<a name="l00889"></a>00889 <span class="comment">//          {</span>
<a name="l00890"></a>00890 <span class="comment">//              ++cicl.lit;</span>
<a name="l00891"></a>00891 <span class="comment">//              ASSERT( cicl.lit != activeGlobalSCs(strat.nextI).end(cicl.b) );</span>
<a name="l00892"></a>00892 <span class="comment">//              --cicl.x;</span>
<a name="l00893"></a>00893 <span class="comment">//          }</span>
<a name="l00894"></a>00894 <span class="comment">//          while ( cicl.hits_so_far &lt; cicl.desired_noof_hits &amp;&amp; cicl.counter_index &lt; cicl.asc_size_current )</span>
<a name="l00895"></a>00895 <span class="comment">//          {</span>
<a name="l00896"></a>00896 <span class="comment">//              while ( cicl.lit == activeGlobalSCs(strat.nextI).end(cicl.b) ) //overflow to next bucket</span>
<a name="l00897"></a>00897 <span class="comment">//              {</span>
<a name="l00898"></a>00898 <span class="comment">//                  ++cicl.b;</span>
<a name="l00899"></a>00899 <span class="comment">//                  if ( cicl.b == cicl.bucket_count ) //overflow within the entire set</span>
<a name="l00900"></a>00900 <span class="comment">//                      cicl.b = 0;</span>
<a name="l00901"></a>00901 <span class="comment">//                  cicl.lit = activeGlobalSCs(strat.nextI).begin(cicl.b);</span>
<a name="l00902"></a>00902 <span class="comment">//              }</span>
<a name="l00904"></a>00904 <span class="comment"></span>            <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).begin();
<a name="l00905"></a>00905             <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>=0; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad5adc79c279fdad7cd60799fe88325c4">start_index</a>; <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>++ )
<a name="l00906"></a>00906                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00907"></a>00907             while ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a10c1dbecfef4fcb1e58f8c1ed2b2c86e">desired_noof_hits</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ad374715101047f602feb1da8b8c24c05">asc_size_current</a> )
<a name="l00908"></a>00908             {
<a name="l00909"></a>00909                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).end() ) <span class="comment">//continue from beginning</span>
<a name="l00910"></a>00910                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).begin();
<a name="l00912"></a>00912                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#af72e942c4fc62f68a3a2a5fb9f2f6752">counter_index</a>;
<a name="l00913"></a>00913                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a> = *<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; <span class="comment">//current example</span>
<a name="l00914"></a>00914                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00915"></a>00915                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>) || 
<a name="l00916"></a>00916                      ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a>
<a name="l00917"></a>00917                        &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>).find( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> ) == <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>).end() ) 
<a name="l00918"></a>00918                    ) <span class="comment">//only look at samples for which both classes are active SPs</span>
<a name="l00919"></a>00919                 {
<a name="l00920"></a>00920                     ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00921"></a>00921                     <span class="keywordflow">continue</span>;
<a name="l00922"></a>00922                 }
<a name="l00923"></a>00923                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a099bc3323f05f225a13b094d6ed24107">hits_so_far</a>;
<a name="l00924"></a>00924                 <span class="comment">//actual stuff:</span>
<a name="l00925"></a>00925                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a> = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>);
<a name="l00926"></a>00926                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 0;
<a name="l00927"></a>00927                 <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#ae6fb2f952d001d9c12d18b209c5c118a">useClippedAsWitness</a> )
<a name="l00928"></a>00928                 {
<a name="l00929"></a>00929                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = (<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a>-<a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>)) / (2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>)); <span class="comment">//this is used for up-down-swap</span>
<a name="l00930"></a>00930                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> = fabs(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>); <span class="comment">//and this as criterion</span>
<a name="l00931"></a>00931                 }
<a name="l00932"></a>00932                 <span class="keywordflow">else</span>
<a name="l00933"></a>00933                 {
<a name="l00934"></a>00934                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#aa4ac953d31d6be5ed50d3a4333f2e979">g</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>);
<a name="l00935"></a>00935                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> / ( 2*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) );
<a name="l00936"></a>00936                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> &gt; 0 )
<a name="l00937"></a>00937                     {
<a name="l00938"></a>00938                         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>) ) <span class="comment">// j would hit its bound</span>
<a name="l00939"></a>00939                         {
<a name="l00940"></a>00940                             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>) - <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>);
<a name="l00941"></a>00941                             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ) <span class="comment">// j would be deactivated</span>
<a name="l00942"></a>00942                                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 1;
<a name="l00943"></a>00943                         }
<a name="l00944"></a>00944                     }
<a name="l00945"></a>00945                     <span class="keywordflow">else</span>
<a name="l00946"></a>00946                     {
<a name="l00947"></a>00947                         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>, -<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>) ) <span class="comment">// t would hit its bound</span>
<a name="l00948"></a>00948                         {
<a name="l00949"></a>00949                             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> = -(<a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>)-<a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3f118798032925a0910a16fb31c9aac1">t</a>));
<a name="l00950"></a>00950                             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ) <span class="comment">// t would be deactivated</span>
<a name="l00951"></a>00951                                 <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> = 1;
<a name="l00952"></a>00952                         }
<a name="l00953"></a>00953                     }
<a name="l00954"></a>00954                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>*( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a80038805b5c9fec17cdbf6487adb5ecc">delta_g</a> - <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a>*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>) ); <span class="comment">//minus sign factors out</span>
<a name="l00955"></a>00955                 }
<a name="l00956"></a>00956                 <span class="keywordflow">if</span> (      <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> &gt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> 
<a name="l00957"></a>00957                      || ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a> &gt; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> ) 
<a name="l00958"></a>00958                    )
<a name="l00959"></a>00959                 {
<a name="l00960"></a>00960                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7928cb2572fe8cefdfb199679e9f63dc">candidate</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a962b83ca644e5e5c62989446e708f357">e</a>;
<a name="l00961"></a>00961                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a9c4cfadaff027894cc4313eee8c686e8">cur_witness</a>;
<a name="l00962"></a>00962                     <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a63c186713143844416810fcf2b5cdba0">max_priority</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a745f28345a562b4a9a755f4bbe5dfdf0">cur_priority</a>;
<a name="l00963"></a>00963                     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a3a97fb98b42a279ef133ac83aef9e2fb">mu_test</a> &gt; 0 )
<a name="l00964"></a>00964                     {
<a name="l00965"></a>00965                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>;
<a name="l00966"></a>00966                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00967"></a>00967                     }
<a name="l00968"></a>00968                     <span class="keywordflow">else</span>
<a name="l00969"></a>00969                     {
<a name="l00970"></a>00970                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a549c59135f0a09975aa71327acabbb82">i</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#aeddf9c4ef49cf4b86c556f6cbfaff0ef">thirdClass</a>;
<a name="l00971"></a>00971                         <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7cde8e2d0b08a551d41c320382b03904">j</a> = <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>;
<a name="l00972"></a>00972                     }
<a name="l00973"></a>00973                 }
<a name="l00974"></a>00974                 <span class="comment">// finished -- set iterator to next element</span>
<a name="l00975"></a>00975                 ++<a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#ac9f8b9768266f4aac6b858c665b7d735">lit</a>;
<a name="l00976"></a>00976             }
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a839e0022b68062f18e116fcc5f3f3c29">max_witness</a> &gt; 0 )
<a name="l00979"></a>00979             <a class="code" href="class_qp_eb_cs_decomp.html#a28d89e9926ad9fa6453796f115b5f7b8">cicl</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1t_class_inversion_candidate_list.html#a7f38caa19adb9257ac3aeb3dea08d921">fallback_mode</a> = <span class="keyword">false</span>;
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="keywordflow">if</span> ( !wasSCi &amp;&amp; isSCi ) 
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984         <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).insert( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> );
<a name="l00985"></a>00985         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a4c60bcdf45a35df21fc9d2652077e16c">nOld</a> ) <span class="comment">//if nNew, done in flip. if nOpt, never happens</span>
<a name="l00986"></a>00986             <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).insert( nI ); <span class="comment">//update active list</span>
<a name="l00987"></a>00987         <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>( nI ) = <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> - mu*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p); <span class="comment">//if not SC, no need to assign. if formerly SC, already correct</span>
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( wasSCi &amp;&amp; !isSCi ) 
<a name="l00990"></a>00990     {
<a name="l00991"></a>00991         <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).erase( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> );
<a name="l00992"></a>00992         <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>).erase( nI ); <span class="comment">//update active list</span>
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994     <span class="keywordflow">if</span> ( !wasSCj &amp;&amp; isSCj ) 
<a name="l00995"></a>00995     {
<a name="l00996"></a>00996         <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).insert( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> );
<a name="l00997"></a>00997         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a70fe2dce69ace8259a77eb50225692b6">proc</a> == <a class="code" href="class_qp_eb_cs_decomp.html#a4a93b745ba68f4d291fb2fffa809b8a5a4c60bcdf45a35df21fc9d2652077e16c">nOld</a> ) <span class="comment">//if nNew, done in flip. if nOpt, never happens</span>
<a name="l00998"></a>00998             <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).insert( nJ ); <span class="comment">//update active list</span>
<a name="l00999"></a>00999         <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>( nJ ) = <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a> + mu*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p); <span class="comment">//if not SC, no need to assign. if formerly SC, already correct</span>
<a name="l01000"></a>01000     }
<a name="l01001"></a>01001     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( wasSCj &amp;&amp; !isSCj )
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003         <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).erase( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a> );
<a name="l01004"></a>01004         <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>).erase( nJ ); <span class="comment">//update active list</span>
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006     <span class="comment">// insert as new AP (if) or remove from SP-section (else)</span>
<a name="l01007"></a>01007     <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).empty() )
<a name="l01008"></a>01008     {
<a name="l01009"></a>01009         <span class="keywordflow">if</span> ( p &gt;= <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> ) <span class="comment">//was a new sample: move to active section</span>
<a name="l01010"></a>01010         {
<a name="l01011"></a>01011             <span class="comment">// temporarily move it to inactive section</span>
<a name="l01012"></a>01012             <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">flipAll</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>, p, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3ad080f8e8c6e3aa57ea1a0811fe473868">fInsert_first</a> ); <span class="comment">//careful here: flip inherits 1stArg &lt; 2ndArg from cachedMatrix.flip</span>
<a name="l01013"></a>01013             p = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>;
<a name="l01014"></a>01014             ++<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>;
<a name="l01015"></a>01015             <span class="comment">// then continue and move it to active section</span>
<a name="l01016"></a>01016             <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">flipAll</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>, p, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a248aa2a2fb54cb6bb8f985ce4a33f3c0">fInsert_second</a> );
<a name="l01017"></a>01017             p = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>;
<a name="l01018"></a>01018             ++<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>;
<a name="l01019"></a>01019             <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = p; <span class="comment">//keep vars intact</span>
<a name="l01020"></a>01020             nI = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>;
<a name="l01021"></a>01021             nJ = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>;
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024     <span class="keywordflow">else</span> <span class="comment">//remove from AP section (test for p&lt;cardi.activePatterns unnecessary)</span>
<a name="l01025"></a>01025     {
<a name="l01026"></a>01026         <span class="comment">// release all vars and the cache</span>
<a name="l01027"></a>01027         <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a262e15085d6057581dc41c43a9886032">CacheRowRelease</a>(p);
<a name="l01028"></a>01028         <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">flipAll</a>( p, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>-1, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a9b5edbee0697ad1a00a307020f764e47">fRemove_first</a> ); <span class="comment">//temporarily move it to inactive region</span>
<a name="l01029"></a>01029         p = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>-1;
<a name="l01030"></a>01030         --<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>;
<a name="l01031"></a>01031         <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">flipAll</a>( p, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>-1, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> ); <span class="comment">//then continue and move it to non-SP-section</span>
<a name="l01032"></a>01032         p = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>-1;
<a name="l01033"></a>01033         --<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>;
<a name="l01034"></a>01034         <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a703271dda6947e97c71d19728af3054f">nextPat</a> = p; <span class="comment">//keep vars intact</span>
<a name="l01035"></a>01035         nI = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a>;
<a name="l01036"></a>01036         nJ = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a9f471a43753f81d10a101228d23ef642">nextJ</a>;
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038     
<a name="l01039"></a>01039     <span class="comment">// see if the last update step made nextI shrinkable</span>
<a name="l01040"></a>01040     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a> &amp;&amp; !<a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).empty() ) <span class="comment">//never shrink non-SPs (important)</span>
<a name="l01041"></a>01041     {
<a name="l01042"></a>01042         <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(nI) &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(nI) &gt; 0 )
<a name="l01043"></a>01043         {
<a name="l01044"></a>01044             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
<a name="l01045"></a>01045             <span class="keywordtype">double</span> g_cur, g_max = -1e100;
<a name="l01046"></a>01046             <span class="comment">// over all increasables, get max gradient</span>
<a name="l01047"></a>01047             <span class="keywordflow">for</span> ( tActiveClasses::iterator kt = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).begin(); kt != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(p).end(); ++kt )
<a name="l01048"></a>01048             {
<a name="l01049"></a>01049                 i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*kt);
<a name="l01050"></a>01050                 <span class="keywordflow">if</span> ( *kt == <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> || !<a class="code" href="class_qp_eb_cs_decomp.html#acf5efa1de47fefae39159d962c50e167" title="one central place to account for numerical inaccuracies when determining upper-boundedness this defin...">canIncrease</a>(i) ) <span class="keywordflow">continue</span>; <span class="comment">//don&#39;t compare to self</span>
<a name="l01051"></a>01051                 g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l01052"></a>01052                 <span class="keywordflow">if</span> ( g_cur &gt; g_max )
<a name="l01053"></a>01053                     g_max = g_cur;
<a name="l01054"></a>01054             }
<a name="l01055"></a>01055             
<a name="l01056"></a>01056             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(nI) &gt; g_max * <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#add9a01a68425e6fd42a42972768f5e25">shrinkCritFraction</a> )
<a name="l01057"></a>01057             {
<a name="l01058"></a>01058                 <a class="code" href="class_qp_eb_cs_decomp.html#a2d6070c20193be14bffbb8369aa0f027" title="exclude a variable from getting its gradient updated and from being considered in wss...">deactivateVariable</a>( nI, p, <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a50e8e28388c0bf9e59584a54a87d3531">nextI</a> );
<a name="l01059"></a>01059                 <span class="comment">// now test if the whole sample can be deactivated</span>
<a name="l01060"></a>01060                 g_cur = 1e100; <span class="comment">//dummy marker value</span>
<a name="l01061"></a>01061                 <span class="keywordtype">bool</span> deactivate = <span class="keyword">false</span>;
<a name="l01062"></a>01062                 <span class="keywordflow">for</span> ( tActiveClasses::iterator kt = <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).begin(); kt != <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(p).end(); ++kt )
<a name="l01063"></a>01063                 {
<a name="l01064"></a>01064                     i = p*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*kt);
<a name="l01065"></a>01065                     <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i) ) <span class="comment">//we do not know the gradient</span>
<a name="l01066"></a>01066                     {
<a name="l01067"></a>01067                         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> &lt; <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaa9a5c142270152c4e28c8d6f0e54b0dfa">sAgressive</a> ) <span class="comment">//and non-SC usually means no deactivation anyway</span>
<a name="l01068"></a>01068                         {
<a name="l01069"></a>01069                             deactivate = <span class="keyword">false</span>;
<a name="l01070"></a>01070                             <span class="keywordflow">break</span>;
<a name="l01071"></a>01071                         }
<a name="l01072"></a>01072                     }
<a name="l01073"></a>01073                     <span class="keywordflow">else</span> <span class="comment">//we know the gradient and it should equal all other known gradients</span>
<a name="l01074"></a>01074                     {
<a name="l01075"></a>01075                         <span class="keywordflow">if</span> ( g_cur == 1e100 )
<a name="l01076"></a>01076                             g_cur = <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l01077"></a>01077                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fabs( <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i)-g_cur ) &gt; fabs(g_cur)*<a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a13f081340b6ff18d7146c50dbf5d3440">shrinkEqualFraction</a> )
<a name="l01078"></a>01078                         {
<a name="l01079"></a>01079                             deactivate = <span class="keyword">false</span>;
<a name="l01080"></a>01080                             <span class="keywordflow">break</span>;
<a name="l01081"></a>01081                         }
<a name="l01082"></a>01082                     }
<a name="l01083"></a>01083                 }
<a name="l01084"></a>01084                 <span class="keywordflow">if</span> ( deactivate )
<a name="l01085"></a>01085                 {
<a name="l01087"></a>01087                     <a class="code" href="class_qp_eb_cs_decomp.html#a88f5a69048595034f67391650f0f115c" title="freeze an entire example: exclude it from wss and all its gradients from being updated">deactivateExample</a>(p);
<a name="l01088"></a>01088                 }
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090         }
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092     <span class="comment">// increment counters</span>
<a name="l01093"></a>01093     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#a079db2c24ca7da21dd5dc694cf85cb1e">dual</a> += mu * ((<a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>) - mu*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p));
<a name="l01094"></a>01094     <span class="keywordflow">return</span> mu * ((<a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a7f6606f560b7911c6127fe0fc54a5a96">gPlus</a> - <a class="code" href="class_qp_eb_cs_decomp.html#ac306d15d1bd737cb0ec456c8b7863058" title="envelope for caching intermediate results">temp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_tmp_data.html#a32bc5142ac0b34a5ce147dc55c57f41c">gMinus</a>) - mu*<a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>(p)); <span class="comment">//copied from original paper</span>
<a name="l01095"></a>01095 }
<a name="l01096"></a>01096 
<a name="l01097"></a><a class="code" href="class_qp_eb_cs_decomp.html#af0899237b61d52c18f827435d3e8ea98">01097</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#af0899237b61d52c18f827435d3e8ea98" title="randomly reorder the lottery vector defining the iteration through the dataset">QpEbCsDecomp::shuffleSamples</a>()
<a name="l01098"></a>01098 {
<a name="l01099"></a>01099     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, j, ic = <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>;
<a name="l01100"></a>01100     <span class="keywordflow">for</span> (i=1; i&lt;ic; i++)
<a name="l01101"></a>01101     {
<a name="l01102"></a>01102         j = Rng::discrete(0, i);
<a name="l01103"></a>01103         <span class="keywordflow">if</span> (i != j) <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, <a class="code" href="class_qp_eb_cs_decomp.html#ab1f15576a09ae5f8e43f2d2f567fc546" title="In each epoch, pre-define how to traverse through the samples.">lottery</a>, i, j);
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 <span class="comment">// requires i &lt; j</span>
<a name="l01108"></a><a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7">01108</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">QpEbCsDecomp::flipAll</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3" title="List of possible configurations that can occur when flipping two examples.">eFlipVariants</a> f )
<a name="l01109"></a>01109 {
<a name="l01110"></a>01110     tActiveClasses::iterator it;
<a name="l01111"></a>01111     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l01112"></a>01112     <span class="keywordflow">if</span> ( i == j )
<a name="l01113"></a>01113     {
<a name="l01114"></a>01114         <span class="comment">// IV-a (insert new SCs as active)</span>
<a name="l01115"></a>01115         <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a248aa2a2fb54cb6bb8f985ce4a33f3c0">fInsert_second</a> ) <span class="comment">//insert active SCs from lower-index sample </span>
<a name="l01116"></a>01116             <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).end(); ++it )
<a name="l01117"></a>01117                 <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(*it).insert( i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*it) );
<a name="l01118"></a>01118         <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> )
<a name="l01119"></a>01119             <span class="keywordflow">for</span> ( c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01120"></a>01120                 <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(j).insert(c);
<a name="l01121"></a>01121         <span class="keywordflow">return</span>;
<a name="l01122"></a>01122     }
<a name="l01123"></a>01123     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &gt; j ) <span class="keywordflow">throw</span> SHARKEXCEPTION(<span class="stringliteral">&quot;[QpEbCsDecomp::flip] Invalid arguments.&quot;</span>);
<a name="l01124"></a>01124     
<a name="l01125"></a>01125     ASSERT( <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).size() == 0 ) <span class="comment">//standard safety check for all</span>
<a name="l01126"></a>01126     ASSERT( f != <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(i).size() == 0 ) <span class="comment">//treat all vars first, then the example, then flip.</span>
<a name="l01127"></a>01127     ASSERT( f != <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a248aa2a2fb54cb6bb8f985ce4a33f3c0">fInsert_second</a> || <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(j).size() == <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> ) <span class="comment">//no shrinking before insertion</span>
<a name="l01128"></a>01128     
<a name="l01129"></a>01129     <span class="comment">// vars of cardinality cardi.examples</span>
<a name="l01130"></a>01130     <a class="code" href="class_qp_eb_cs_decomp.html#a7b0fb261e3bf0fcc46de1c86ce6384cd" title="i-th element gives the current index of the originally i-th sample">curIndex</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>(i) ) = j; <span class="comment">//flip curIndex</span>
<a name="l01131"></a>01131     <a class="code" href="class_qp_eb_cs_decomp.html#a7b0fb261e3bf0fcc46de1c86ce6384cd" title="i-th element gives the current index of the originally i-th sample">curIndex</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>(j) ) = <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>;
<a name="l01132"></a>01132     <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, <a class="code" href="class_qp_eb_cs_decomp.html#a62aaba1eb0e1c23a9de6c01c7c68300e" title="i-th element gives the original index of the current i-th sample">origIndex</a>, i, j); <span class="comment">//flip OrigIndex</span>
<a name="l01133"></a>01133     <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>, i, j);
<a name="l01134"></a>01134     <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_eb_cs_decomp.html#a34bb724795cb988e84eb6e23a6768dcc" title="diagonal matrix entries">diagonal</a>, i, j);
<a name="l01135"></a>01135     
<a name="l01136"></a>01136     <span class="comment">// vars of cardinality cardi.variables: classes always maintain original order</span>
<a name="l01137"></a>01137     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bi = i * <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>;
<a name="l01138"></a>01138     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bj = j * <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>;
<a name="l01139"></a>01139     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b = (i+1) * <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>;
<a name="l01140"></a>01140     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bic, bjc;
<a name="l01141"></a>01141     for (bic=bi,bjc=bj; bic&lt;b; bic++,bjc++) <span class="comment">//two-var loop //mt_costly_loop_marker</span>
<a name="l01142"></a>01142     {
<a name="l01143"></a>01143         <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>, bic, bjc);
<a name="l01144"></a>01144         <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_eb_cs_decomp.html#a0e7773173a743416906d275923b219ff" title="box constraint upper bound, that is, maximal variable value.">boxMax</a>, bic, bjc);
<a name="l01145"></a>01145         <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<span class="keywordtype">double</span>, <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>, bic, bjc);
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147     
<a name="l01148"></a>01148     <span class="comment">// update all unordered_sets holding the current SCs (needs to happen after above swaps)</span>
<a name="l01149"></a>01149     
<a name="l01150"></a>01150     <span class="comment">//  I-d (remove unknown dormants from i)</span>
<a name="l01151"></a>01151     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a248aa2a2fb54cb6bb8f985ce4a33f3c0">fInsert_second</a> ) <span class="comment">//we do not know the dormant SCs (and all SCs are dormant)</span>
<a name="l01152"></a>01152         <span class="keywordflow">for</span> (c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01153"></a>01153             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c) )
<a name="l01154"></a>01154                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).erase( i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c );
<a name="l01155"></a>01155     <span class="comment">// II-a (remove active from j)</span>
<a name="l01156"></a>01156     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a9b5edbee0697ad1a00a307020f764e47">fRemove_first</a> )
<a name="l01157"></a>01157         <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(j).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(j).end(); ++it )
<a name="l01158"></a>01158             <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(*it).erase( j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*it) );
<a name="l01159"></a>01159     <span class="comment">// II-d-1 (remove known dormant from j) (dormant SC can only be the true-label one)</span>
<a name="l01160"></a>01160     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a9b5edbee0697ad1a00a307020f764e47">fRemove_first</a> )
<a name="l01161"></a>01161         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(j) ) )
<a name="l01162"></a>01162             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(j).find(<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(j)) == <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(j).end() )  <span class="comment">//maybe faster to always directly delete?</span>
<a name="l01163"></a>01163                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(j) ).erase( j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(j) );
<a name="l01164"></a>01164     <span class="comment">// II-d-2 (remove unknown dormants from j)</span>
<a name="l01165"></a>01165     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> ) <span class="comment">//we do not know the dormant SCs (and all SCs are dormant)</span>
<a name="l01166"></a>01166         <span class="keywordflow">for</span> (c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01167"></a>01167             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c) )
<a name="l01168"></a>01168                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).erase( j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c );
<a name="l01169"></a>01169     <span class="comment">// III (swap nina- and asClasses)</span>
<a name="l01170"></a>01170     <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a14130830228180624e99db82f5af10e7" title="Typedef for convenience.">tActiveClasses</a>, <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>, i, j); <span class="comment">//swap sample-wise sets</span>
<a name="l01171"></a>01171     <a class="code" href="_qp_eb_cs_decomp_8cpp.html#a72cc922e3996638c89697c36e8ae41c6">XCHG_A</a>(<a class="code" href="class_qp_eb_cs_decomp.html#a14130830228180624e99db82f5af10e7" title="Typedef for convenience.">tActiveClasses</a>, <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>, i, j); <span class="comment">//swap sample-wise sets</span>
<a name="l01172"></a>01172     <span class="comment">// IV-a (insert active to i from old j)</span>
<a name="l01173"></a>01173     <span class="keywordflow">if</span> ( f != <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> &amp;&amp; f != <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3ad080f8e8c6e3aa57ea1a0811fe473868">fInsert_first</a> )
<a name="l01174"></a>01174         <span class="keywordflow">for</span> ( it = <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).begin(); it != <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).end(); ++it )
<a name="l01175"></a>01175             <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(*it).insert( i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + (*it) );
<a name="l01176"></a>01176     <span class="comment">// IV-d-1 (insert known dormant to i from old j) (dormant SC can only be the true-label one)</span>
<a name="l01177"></a>01177     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a9b5edbee0697ad1a00a307020f764e47">fRemove_first</a> )
<a name="l01178"></a>01178         <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(i) ) )
<a name="l01179"></a>01179             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).find(<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(i)) == <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(i).end() ) <span class="comment">//for insertion, this check is necessary</span>
<a name="l01180"></a>01180                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>( <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(i) ).insert( i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>+<a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(i) );
<a name="l01181"></a>01181     <span class="comment">// IV-d-2 (insert unknown dormants to i from old j) we do not know the dormant SCs (and all SCs are dormant)</span>
<a name="l01182"></a>01182     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> )
<a name="l01183"></a>01183         <span class="keywordflow">for</span> (c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01184"></a>01184             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c) )
<a name="l01185"></a>01185                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).insert( i*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c );
<a name="l01186"></a>01186     <span class="comment">// V-d (insert unknown dormants to j from old i) //we do not know the dormant SCs (and all SCs are dormant)</span>
<a name="l01187"></a>01187     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> || f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a248aa2a2fb54cb6bb8f985ce4a33f3c0">fInsert_second</a> )
<a name="l01188"></a>01188         <span class="keywordflow">for</span> (c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01189"></a>01189             <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c) )
<a name="l01190"></a>01190                 <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).insert( j*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c );
<a name="l01191"></a>01191     
<a name="l01192"></a>01192     <span class="comment">// this relates to multi-epoch settings. however, a strategy (and testing/debugging) for that is still lacking</span>
<a name="l01193"></a>01193     <span class="keywordflow">if</span> ( f == <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a36c35344eb9bf54512b736ac575d08fe">fRemove_second</a> )
<a name="l01194"></a>01194         <span class="keywordflow">for</span> ( c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++)
<a name="l01195"></a>01195             <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(j).insert(c);
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="comment">// notify cache</span>
<a name="l01198"></a>01198     <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a24706a604c5b2db1c76b6a632d0aae18" title="Exchange the rows i and j and the columns i and j.">FlipColumnsAndRows</a>(i, j);
<a name="l01199"></a>01199     
<a name="l01200"></a>01200 }
<a name="l01201"></a>01201 
<a name="l01203"></a><a class="code" href="class_qp_eb_cs_decomp.html#a2d6070c20193be14bffbb8369aa0f027">01203</a> <span class="keywordtype">void</span> <a class="code" href="class_qp_eb_cs_decomp.html#a2d6070c20193be14bffbb8369aa0f027" title="exclude a variable from getting its gradient updated and from being considered in wss...">QpEbCsDecomp::deactivateVariable</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c )
<a name="l01204"></a>01204 {
<a name="l01205"></a>01205     <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(e).erase(c); <span class="comment">//always good</span>
<a name="l01206"></a>01206     <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(v) ) <span class="comment">//also treat SC-relevant containers</span>
<a name="l01207"></a>01207     {
<a name="l01208"></a>01208         <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(e).erase(c);
<a name="l01209"></a>01209         <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).insert(v); <span class="comment">//(only not necessarily implies wasSC if shrinked at the very end of smo)</span>
<a name="l01210"></a>01210         std::pair&lt;tActiveClasses::iterator, tActiveClasses::iterator&gt; mypair = 
<a name="l01211"></a>01211             <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).equal_range(v); 
<a name="l01212"></a>01212         ASSERT( mypair.first != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).end() );
<a name="l01214"></a>01214         <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).erase(mypair.first); <span class="comment">//return pointer, in case we&#39;re in a loop through activeGlobalSCs</span>
<a name="l01215"></a>01215     }
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a><a class="code" href="class_qp_eb_cs_decomp.html#a88f5a69048595034f67391650f0f115c">01220</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_qp_eb_cs_decomp.html#a88f5a69048595034f67391650f0f115c" title="freeze an entire example: exclude it from wss and all its gradients from being updated">QpEbCsDecomp::deactivateExample</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e )
<a name="l01221"></a>01221 {
<a name="l01222"></a>01222     ASSERT( <a class="code" href="class_qp_eb_cs_decomp.html#aec7ef2c9473d7032ebc6896f319c6d46" title="For each pattern, maintain a set of the corresponding support vectors.">ninaClasses</a>(e).empty() );
<a name="l01223"></a>01223     ASSERT( <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(e).empty() );
<a name="l01224"></a>01224     <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a262e15085d6057581dc41c43a9886032">CacheRowRelease</a>( e );
<a name="l01225"></a>01225     <a class="code" href="class_qp_eb_cs_decomp.html#a099459decce632b9b0a0c99fc90cc3e7" title="exchange all data corresponding to two samples, both in internal arrays and in the cachedMatrix Impor...">flipAll</a>( e, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>-1, <a class="code" href="class_qp_eb_cs_decomp.html#a4ccf9924d8a3bb354ff327267d3da0e3a680ec561307dbb22628cd50cde1142db">fDeactivate</a> );
<a name="l01226"></a>01226     --<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>;
<a name="l01227"></a>01227     <span class="keywordflow">return</span> <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ace49c93b6b0730aa923b98180ed5b2d3">activePatterns</a>; <span class="comment">//remember to keep vars intact - this return value will help you</span>
<a name="l01228"></a>01228 }
<a name="l01229"></a>01229 
<a name="l01230"></a><a class="code" href="class_qp_eb_cs_decomp.html#a01629c025d5ab13a87800662eda290ac">01230</a> <span class="keywordtype">double</span> <a class="code" href="class_qp_eb_cs_decomp.html#a01629c025d5ab13a87800662eda290ac" title="return the current value of the primal, and also store in introsp.primal">QpEbCsDecomp::calcPrimal</a>()
<a name="l01231"></a>01231 {
<a name="l01232"></a>01232     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#aff9acb6335feb1a3b6a6e4717dd14590">primal</a> = 0.0;
<a name="l01233"></a>01233     <span class="keywordtype">float</span>* krow; <span class="comment">//kernel row</span>
<a name="l01234"></a>01234     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> e, c, <a class="code" href="_b_f_g_s_8cpp.html#ac23062089f3a5a2693cbb4ce7a75f1e5" title="Initializes some internal variables used by the BFGS algorithm, calculates the current error of the m...">i</a>, true_label; <span class="comment">//helper</span>
<a name="l01235"></a>01235     <span class="keywordtype">double</span> sum_weights = 0.0; <span class="comment">//norm of weight vector</span>
<a name="l01236"></a>01236     <span class="keywordtype">double</span> sum_slacks = 0.0; <span class="comment">//sum over slack variables</span>
<a name="l01237"></a>01237     <span class="keywordtype">double</span> cur_score, true_score, max_other_scores;
<a name="l01238"></a>01238     
<a name="l01239"></a>01239     <span class="comment">// run over all examples, utilizing all known gradients:</span>
<a name="l01240"></a>01240     <span class="keywordflow">for</span> ( e=0; e&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad8e076f808b55559a40e4ac49057e188">examples</a>; e++ )
<a name="l01241"></a>01241     {
<a name="l01242"></a>01242         krow = NULL;
<a name="l01243"></a>01243         true_label = <a class="code" href="class_qp_eb_cs_decomp.html#a6baad43ed334e453fd98e0cb68a0111f" title="for each example, store the class label (between 0 and classes-1)">label</a>(e);
<a name="l01244"></a>01244         max_other_scores = -1e100;
<a name="l01245"></a>01245         <span class="comment">//GET MAXIMUM SCORE</span>
<a name="l01246"></a>01246         <span class="keywordflow">for</span> ( c=0; c&lt;<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>; c++ )
<a name="l01247"></a>01247         {
<a name="l01248"></a>01248             i = e*<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a> + c;
<a name="l01249"></a>01249             <span class="comment">// GET SCORE FOR THIS CLASS</span>
<a name="l01250"></a>01250             <span class="comment">// if it is not an SC, or not listed as active SC, we have to calculate the score:</span>
<a name="l01251"></a>01251             <span class="keywordflow">if</span> ( !<a class="code" href="class_qp_eb_cs_decomp.html#ad189e8641af3258af8677941eec4d203" title="With respect to a fixed pattern, determine whether a class is a support class This should be identica...">isSC</a>(i) || <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(e).find(c) == <a class="code" href="class_qp_eb_cs_decomp.html#a957fed5e44417135c0acde0a60bd1bf6">asClasses</a>(e).end() )
<a name="l01252"></a>01252             {
<a name="l01253"></a>01253                 <span class="keywordflow">if</span> ( krow == NULL &amp;&amp; <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a> ) <span class="comment">//get kernel row</span>
<a name="l01254"></a>01254                 {
<a name="l01255"></a>01255                     krow = <a class="code" href="class_qp_eb_cs_decomp.html#ae21cef0fade73cb9645ffd835eb71dc0" title="quadratic part, kernel matrix cache">kernelMatrix</a>.<a class="code" href="class_cached_matrix.html#a573086bf809eea24a1b4a60d752b405f" title="Return a subset of a matrix row.">Row</a>(e, 0, <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>);
<a name="l01256"></a>01256                     <a class="code" href="_qp_eb_cs_decomp_8h.html#ac7f69eb35a827b4a533981f79150e021">MT_COUNT_KERNEL_LOOKUPS</a> ( <a class="code" href="class_qp_eb_cs_decomp.html#add1f46c56b8d13b171c3130c36005907">log</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_log_vars.html#a677af1d992e544e9d6fa56e402043e4a">kernel_lookups</a> += <a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ae79458ceef2520a6e72a8d36ca2ba059">sPatterns</a>; )
<a name="l01257"></a>01257                 }
<a name="l01258"></a>01258                 cur_score = 0.0;
<a name="l01259"></a>01259                 <span class="keywordflow">for</span> ( tActiveClasses::iterator it = <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).begin(); 
<a name="l01260"></a>01260                       it != <a class="code" href="class_qp_eb_cs_decomp.html#a0afde9dccb84851ecc41000c0d9cbc0f" title="For each class, maintain a set of the corresponding support patterns.">activeGlobalSCs</a>(c).end(); ++it )
<a name="l01261"></a>01261                     cur_score += krow[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l01262"></a>01262                 <span class="keywordflow">if</span> ( <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#adbca80b5559974b69bcdfc0c0ac4ec1d">shrinkMode</a> != <a class="code" href="class_qp_eb_cs_decomp.html#a5cc0b0603d694256492f731f7e7fe3aaafdd99a3e818c6475c8f2740993bc295b">sNever</a> ) <span class="comment">//if necessary, consider inactive contributions as well</span>
<a name="l01263"></a>01263                 {
<a name="l01264"></a>01264                     <span class="keywordflow">for</span> ( tActiveClasses::iterator it = <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).begin();
<a name="l01265"></a>01265                           it != <a class="code" href="class_qp_eb_cs_decomp.html#a2609d1eaf1688a1de5650058913d03e6">dormantGlobalSCs</a>(c).end(); ++it )
<a name="l01266"></a>01266                         cur_score += krow[*it/<a class="code" href="class_qp_eb_cs_decomp.html#a0959e801790a692c209ffc1a12e16a09" title="envelope for convenience cardinalities of important sets">cardi</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_cardinalities.html#ad5eea6ed54693dc7621f507c6a6b5b98">classes</a>] * <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(*it);
<a name="l01267"></a>01267                 }
<a name="l01268"></a>01268             }
<a name="l01269"></a>01269             <span class="keywordflow">else</span> <span class="comment">//we are an sc, and we are active: simply retreive</span>
<a name="l01270"></a>01270             {
<a name="l01271"></a>01271                 cur_score = (c==true_label) - <a class="code" href="class_qp_eb_cs_decomp.html#ab30805cc0287c9b71a99e776ada2e5c4" title="gradient">gradient</a>(i);
<a name="l01272"></a>01272             }
<a name="l01273"></a>01273             <span class="keywordflow">if</span> ( cur_score &gt; max_other_scores &amp;&amp; c != true_label )
<a name="l01274"></a>01274                 max_other_scores = cur_score;
<a name="l01275"></a>01275             <span class="keywordflow">if</span> ( c == true_label )
<a name="l01276"></a>01276                 true_score = cur_score;
<a name="l01277"></a>01277             <span class="comment">// also treat the weight vector:</span>
<a name="l01278"></a>01278             sum_weights += <a class="code" href="class_qp_eb_cs_decomp.html#adf29671f707a0e2d68ace9d155ef22fc" title="solution candidate">alpha</a>(i)*cur_score;
<a name="l01279"></a>01279         }
<a name="l01280"></a>01280         <span class="comment">//if there is some slack, add it to sum_slacks</span>
<a name="l01281"></a>01281         <span class="keywordflow">if</span> ( true_score-1 &lt; max_other_scores ) <span class="comment">//slack var is &gt; 0</span>
<a name="l01282"></a>01282             sum_slacks += max_other_scores - true_score + 1;
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284     <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#aff9acb6335feb1a3b6a6e4717dd14590">primal</a> = 0.5*sum_weights + <a class="code" href="class_qp_eb_cs_decomp.html#a44c8ab1eb407c6771e7e5bf2049f019a" title="envelope for overall strategy">strat</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_strategy.html#a6fac95732a5d4af771498b2914865d08">creg</a>*sum_slacks;
<a name="l01285"></a>01285     <span class="keywordflow">return</span> <a class="code" href="class_qp_eb_cs_decomp.html#a9d95b3a3ad628bcd53d62833eba7c15a" title="envelope for variables about the current state of the solver">introsp</a>.<a class="code" href="struct_qp_eb_cs_decomp_1_1s_introspection.html#aff9acb6335feb1a3b6a6e4717dd14590">primal</a>;
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 
</pre></div></div>
</div>
</div>
</div>
</body></html>
